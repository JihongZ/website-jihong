<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.23">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Jihong Zhang">
<meta name="dcterms.date" content="2023-06-10">
<title>Jihong Z. - Play Harder and Learn Harder – Latent Class Model: Batch Mplus using R on Mac</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/icon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-149871707-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script><script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script><link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<script src="https://cdn.jsdelivr.net/npm/@xiee/utils/js/key-buttons.min.js" defer=""></script><link href="https://cdn.jsdelivr.net/npm/@xiee/utils/css/key-buttons.min.css" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&amp;display=swap" rel="stylesheet">
<link rel="stylesheet" href="../../assets/rwds.css">
<meta property="og:title" content="Jihong Z. - Play Harder and Learn Harder - Latent Class Model: Batch Mplus using R on Mac">
<meta property="og:description" content="Technical and Statistical but Fun">
<meta property="og:site_name" content="Jihong Z. - Play Harder and Learn Harder">
<meta name="twitter:title" content="Jihong Z. - Play Harder and Learn Harder - Latent Class Model: Batch Mplus using R on Mac">
<meta name="twitter:description" content="Technical and Statistical but Fun">
<meta name="twitter:creator" content="@jihongzgamma">
<meta name="twitter:card" content="summary">
</head>
<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title"><span class="icon-line"></span>JZ<span class="icon-line"></span></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link active" href="../../index.html" aria-current="page"> <i class="bi bi-bi bi-house" role="img">
</i> 
<span class="menu-text"><span class="menutext-home">Home</span><span class="text-line"></span></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> <i class="bi bi-bi bi-pencil-square" role="img">
</i> 
<span class="menu-text"><span class="menutext-blog">Blog</span><span class="text-line-blog"></span></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../dashboards/template.html"> <i class="bi bi-bi bi-speedometer2" role="img">
</i> 
<span class="menu-text"><span class="menutext-db">Dashboard</span><span class="text-line-db"></span></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../uploads/Curriculum_Vitae.pdf"> <i class="bi bi-bi bi-person" role="img">
</i> 
<span class="menu-text"><span class="menutext-cv">C.V.</span><span class="text-line-cv"></span></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> <i class="bi bi-bi bi-three-dots" role="img">
</i> 
<span class="menu-text"><span class="menutext-pj">Projects</span><span class="text-line-pj"></span></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Latent Class Model: Batch Mplus using R on Mac</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../images/jihonglogo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none"></a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">ESRM6553-Adv.Multivariate</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/2024-01-12-syllabus-adv-multivariate-esrm-6553/Lecture01/Lecture01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 01</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/2024-01-12-syllabus-adv-multivariate-esrm-6553/Lecture02/Lecture02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 02</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/2024-01-12-syllabus-adv-multivariate-esrm-6553/Lecture03/Lecture03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 03</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/2024-01-12-syllabus-adv-multivariate-esrm-6553/Lecture04/Lecture04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 04</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/2024-01-12-syllabus-adv-multivariate-esrm-6553/Lecture05/Lecture05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 05</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/2024-01-12-syllabus-adv-multivariate-esrm-6553/Lecture06/Lecture06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 06</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#requirement" id="toc-requirement" class="nav-link active" data-scroll-target="#requirement"><span class="header-section-number">1</span> Requirement</a></li>
  <li>
<a href="#latent-class-analysis" id="toc-latent-class-analysis" class="nav-link" data-scroll-target="#latent-class-analysis"><span class="header-section-number">2</span> Latent Class Analysis</a>
  <ul class="collapse">
<li><a href="#an-example" id="toc-an-example" class="nav-link" data-scroll-target="#an-example"><span class="header-section-number">2.1</span> An example</a></li>
  <li><a href="#batch-lca-in-r-select-number-of-latent-classes" id="toc-batch-lca-in-r-select-number-of-latent-classes" class="nav-link" data-scroll-target="#batch-lca-in-r-select-number-of-latent-classes"><span class="header-section-number">2.2</span> Batch LCA in R: select number of latent classes</a></li>
  </ul>
</li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">3</span> Conclusion</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Latent Class Model: Batch Mplus using R on Mac</h1>
  <div class="quarto-categories">
    <div class="quarto-category">blog</div>
    <div class="quarto-category">LCM</div>
    <div class="quarto-category">R</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jihong Zhang </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 10, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header><div class="cell">

</div>
<blockquote class="blockquote">
<p><a href="https://www.statmodel.com/glance.shtml">Mplus</a> is a very popular program for varied latent varaible modeling: (1) Structural equation modeling (2) multilevel analysis (3) mixture modeling (latent class model). R, in the other hand, is a general statistical programming language which not limits to certain statistical models. However, there are scarcely online resources illustrate how to run Mplus using R on Mac.</p>
</blockquote>
<section id="requirement" class="level2" data-number="1"><h2 data-number="1" class="anchored" data-anchor-id="requirement">
<span class="header-section-number">1</span> Requirement</h2>
<p>To make sure Mplus can been successfully called in R, the very first thing is checking whether your MacOS can use command-line version of Mplus. Simply type <code>Mplus</code> command in your terminal app on Mac, if you see “Mplus VERSION (Mac)”, then Mplus on MacOS should work and can be called within R. Otherwise, you should check whether you install Mplus software successfully beforehand.</p>
<p><a href="figures/fig1-terminal-mplus.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="figures/fig1-terminal-mplus.png" class="img-fluid"></a></p>
<p>Second, you should install R + Rstudio (Optional). Rstudio is optional but strongly recommended.</p>
<p>Third, <code>MplusAutomation</code> package should also been installed in R:</p>
<div class="cell">
<details class="code-fold"><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(MplusAutomation)) <span class="fu">install.packages</span>(<span class="st">"MplusAutomation"</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(purrr) <span class="co"># for map functions</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(furrr) <span class="co"># for parallel map</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>If everything looks good, we are ready to go.</p>
</section><section id="latent-class-analysis" class="level2" data-number="2"><h2 data-number="2" class="anchored" data-anchor-id="latent-class-analysis">
<span class="header-section-number">2</span> Latent Class Analysis</h2>
<p>A vanilla Mplus input file for latent class model look like followings:</p>
<div class="cell">
<details class="code-fold"><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource mplus number-lines code-with-copy"><code class="sourceCode"><span id="cb2-1"><a href="#cb2-1"></a>TITLE:</span>
<span id="cb2-2"><a href="#cb2-2"></a>Batch Analysis of Latent Class Models;</span>
<span id="cb2-3"><a href="#cb2-3"></a>DATA:</span>
<span id="cb2-4"><a href="#cb2-4"></a>FILE = "Code/Mplus/datFile.dat";</span>
<span id="cb2-5"><a href="#cb2-5"></a> </span>
<span id="cb2-6"><a href="#cb2-6"></a>VARIABLE:</span>
<span id="cb2-7"><a href="#cb2-7"></a>NAMES = Male Age Chinese EduF_Med EduF_High EduM_Med EduM_High EduS_Med EduS_High YM</span>
<span id="cb2-8"><a href="#cb2-8"></a>     HY SD PSD YASB YRCS YO YCR SEN Subgroup CE1 SC1 SI1 YCDC1 CLDH1; </span>
<span id="cb2-9"><a href="#cb2-9"></a> MISSING=.;</span>
<span id="cb2-10"><a href="#cb2-10"></a> </span>
<span id="cb2-11"><a href="#cb2-11"></a>      CATEGORICAL = Male-SEN;</span>
<span id="cb2-12"><a href="#cb2-12"></a>      CLASSES = c(10);</span>
<span id="cb2-13"><a href="#cb2-13"></a>      AUXILIARY = CE1-CLDH1 (R3STEP);</span>
<span id="cb2-14"><a href="#cb2-14"></a>      </span>
<span id="cb2-15"><a href="#cb2-15"></a>ANALYSIS:</span>
<span id="cb2-16"><a href="#cb2-16"></a></span>
<span id="cb2-17"><a href="#cb2-17"></a>      TYPE = MIXTURE;</span>
<span id="cb2-18"><a href="#cb2-18"></a>      </span>
<span id="cb2-19"><a href="#cb2-19"></a>OUTPUT:</span>
<span id="cb2-20"><a href="#cb2-20"></a>TECH1 TECH8 TECH11;</span>
<span id="cb2-21"><a href="#cb2-21"></a>SAVEDATA:</span>
<span id="cb2-22"><a href="#cb2-22"></a></span>
<span id="cb2-23"><a href="#cb2-23"></a>      FILE IS model1_savedata.txt;</span>
<span id="cb2-24"><a href="#cb2-24"></a>      SAVE IS cprob;</span>
<span id="cb2-25"><a href="#cb2-25"></a>      FORMAT IS free;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>It looks very cumbersome to write one by one line by hand. For example, <code>VARIABLE &gt; NAMES</code> in Mplus input file contains all indicators and auxiliary variables used for latent class modeling. Any typos may give rise to Mplus throwing out error messages in the estimation.</p>
<p>Thankfully, there’s no need to write the Mplus syntax manually in text editor. Instead, you can write R code to automatically compile Mplus input files for you. In the following sections, I will illustrate how to do that using a real example.</p>
<section id="an-example" class="level3" data-number="2.1"><h3 data-number="2.1" class="anchored" data-anchor-id="an-example">
<span class="header-section-number">2.1</span> An example</h3>
<p>The example makes use of a data set including nine variables of demographic variables of youth, such as gender, age, ethnicity, education levels for father, mother and self etc. The goal is to cluster youth into multiple latent classes based on their demographic characteristics.</p>
<div class="cell">
<details class="code-fold"><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"exampleDat.csv"</span>, <span class="at">row.names =</span> <span class="st">"X"</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">glimpse</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,175
Columns: 9
$ Male      &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 1, 1, 0, …
$ Age       &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ Chinese   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ EduF_Med  &lt;int&gt; 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, …
$ EduF_High &lt;int&gt; 1, 1, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, …
$ EduM_Med  &lt;int&gt; 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, …
$ EduM_High &lt;int&gt; 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, …
$ EduS_Med  &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ EduS_High &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …</code></pre>
</div>
</div>
<p>Using <code>mplusObject</code> function, we can create a R object (or a Mplus model object stored in R), which holds all necessary sections for Mplus input syntax of latent class modeling. As shown in the code chunk below, users specify each Mplus section by assigning text strings to arguments. The only difference is that we don’t have to put variables’ names into a text file, instead, we can assign a R dataframe - <code>dat</code> to this model object directly. Then, it can be read by <code>mplusModeler</code> function later to run a latent class model with 2 latent classes.</p>
<p>In other words, we assigned text strings to three arguments -<code>VARIABLE</code>, <code>ANALYSIS</code>, <code>SAVEDATA</code> in mplusObject, which correspond to the sections in Mplus input file. Moreover, the most convenient part of MplusAutomation is allowing users to input variables’ names directly (<code>usevariables = colnames(dat)</code>). That is, <code>rdata</code> and <code>usevariables</code> arguments can be used to specify the variables’ names used for LCA in Mplus, which is equal to <code>NAMES =</code> in vanilla mplus input file.</p>
<p>After we run and extract Mplus results using <code>mplusModeler</code> function, the next step is to parse and extract results from another Mplus model object with results - <code>res_m1</code>. Here, I’m interested in model fit indices of the model, then I can use <code>get_summaries</code> function in R to extract those information of this 2-class latent class model. Pretty neat, right?</p>
<div class="cell">
<details class="code-fold"><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co">#------------#</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co"># 2-class model</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">#------------#</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>m1 <span class="ot">&lt;-</span> <span class="fu">mplusObject</span>(</span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="at">TITLE =</span> <span class="st">"Latent Class Models using R;"</span>,</span>
<span id="cb5-6"><a href="#cb5-6"></a>  <span class="at">VARIABLE =</span> <span class="st">"</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="st">  CATEGORICAL = Male-EduS_High;</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="st">  CLASSES = c(2);"</span>,</span>
<span id="cb5-9"><a href="#cb5-9"></a>  <span class="at">ANALYSIS =</span> <span class="st">"</span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="st">    TYPE = MIXTURE;</span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="st">    ALGORITHM = INTEGRATION;</span></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="st">    STARTS = 500 20;</span></span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="st">  "</span>,</span>
<span id="cb5-14"><a href="#cb5-14"></a>  <span class="at">SAVEDATA =</span> <span class="st">"</span></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="st">    FILE IS LCA_M1_save.txt;</span></span>
<span id="cb5-16"><a href="#cb5-16"></a><span class="st">    SAVE IS cprob;</span></span>
<span id="cb5-17"><a href="#cb5-17"></a><span class="st">    FORMAT IS free;</span></span>
<span id="cb5-18"><a href="#cb5-18"></a><span class="st">  "</span>,</span>
<span id="cb5-19"><a href="#cb5-19"></a>  <span class="at">OUTPUT =</span> <span class="st">"TECH1 TECH8;"</span>,</span>
<span id="cb5-20"><a href="#cb5-20"></a>  <span class="at">rdata =</span> dat,</span>
<span id="cb5-21"><a href="#cb5-21"></a>  <span class="at">usevariables =</span> <span class="fu">colnames</span>(dat),</span>
<span id="cb5-22"><a href="#cb5-22"></a>  <span class="at">autov =</span> <span class="cn">TRUE</span></span>
<span id="cb5-23"><a href="#cb5-23"></a>)</span>
<span id="cb5-24"><a href="#cb5-24"></a><span class="fu">suppressWarnings</span>(res_m1 <span class="ot">&lt;-</span> <span class="fu">mplusModeler</span>(m1, <span class="at">modelout =</span> <span class="st">"Mplus/model.inp"</span>, <span class="at">run =</span> <span class="dv">1</span>L))</span>
<span id="cb5-25"><a href="#cb5-25"></a>summary_m1 <span class="ot">&lt;-</span> <span class="fu">get_summaries</span>(res_m1, <span class="at">simplify =</span> T)</span>
<span id="cb5-26"><a href="#cb5-26"></a><span class="fu">kbl</span>(summary_m1, <span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-27"><a href="#cb5-27"></a>  <span class="fu">kable_material_dark</span>(<span class="at">full_width =</span> F, <span class="at">html_font =</span> <span class="st">"Maven Pro"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-28"><a href="#cb5-28"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"condensed"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<table class="lightable-material-dark table table-condensed table-hover table-sm table-striped small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Model_1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Mplus.version</td>
<td style="text-align: left;">8.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">Title</td>
<td style="text-align: left;">Latent Class Models using R;</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AnalysisType</td>
<td style="text-align: left;">MIXTURE</td>
</tr>
<tr class="even">
<td style="text-align: left;">DataType</td>
<td style="text-align: left;">INDIVIDUAL</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Estimator</td>
<td style="text-align: left;">MLR</td>
</tr>
<tr class="even">
<td style="text-align: left;">Observations</td>
<td style="text-align: left;">2175</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NGroups</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">NDependentVars</td>
<td style="text-align: left;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NIndependentVars</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">NContinuousLatentVars</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NCategoricalLatentVars</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parameters</td>
<td style="text-align: left;">19</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ChiSqCategoricalPearson_Value</td>
<td style="text-align: left;">2255.894</td>
</tr>
<tr class="even">
<td style="text-align: left;">ChiSqCategoricalPearson_DF</td>
<td style="text-align: left;">491</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ChiSqCategoricalPearson_PValue</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">ChiSqCategoricalLRT_Value</td>
<td style="text-align: left;">1669.323</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ChiSqCategoricalLRT_DF</td>
<td style="text-align: left;">491</td>
</tr>
<tr class="even">
<td style="text-align: left;">ChiSqCategoricalLRT_PValue</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ChiSqMCARUnrestrictedPearson_Value</td>
<td style="text-align: left;">54.839</td>
</tr>
<tr class="even">
<td style="text-align: left;">ChiSqMCARUnrestrictedPearson_DF</td>
<td style="text-align: left;">637</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ChiSqMCARUnrestrictedPearson_PValue</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">ChiSqMCARUnrestrictedLRT_Value</td>
<td style="text-align: left;">26.06</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ChiSqMCARUnrestrictedLRT_DF</td>
<td style="text-align: left;">637</td>
</tr>
<tr class="even">
<td style="text-align: left;">ChiSqMCARUnrestrictedLRT_PValue</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LL</td>
<td style="text-align: left;">-8527.781</td>
</tr>
<tr class="even">
<td style="text-align: left;">LLCorrectionFactor</td>
<td style="text-align: left;">1.0086</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AIC</td>
<td style="text-align: left;">17093.562</td>
</tr>
<tr class="even">
<td style="text-align: left;">BIC</td>
<td style="text-align: left;">17201.573</td>
</tr>
<tr class="odd">
<td style="text-align: left;">aBIC</td>
<td style="text-align: left;">17141.207</td>
</tr>
<tr class="even">
<td style="text-align: left;">Entropy</td>
<td style="text-align: left;">0.936</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AICC</td>
<td style="text-align: left;">17093.9146682135</td>
</tr>
<tr class="even">
<td style="text-align: left;">Filename</td>
<td style="text-align: left;">model.out</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NLatentClasses</td>
<td style="text-align: left;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>This is a simplistic procedure for one model. What about a bunch of models?</p>
</section><section id="batch-lca-in-r-select-number-of-latent-classes" class="level3" data-number="2.2"><h3 data-number="2.2" class="anchored" data-anchor-id="batch-lca-in-r-select-number-of-latent-classes">
<span class="header-section-number">2.2</span> Batch LCA in R: select number of latent classes</h3>
<p>One most important step of latent class analysis is to select the number of latent classes, which best summarize the data. This research question can be translated to “when we have multiple alternative latent class models with different number of latent class (C), which one has optimal model fit”. The general rule of model selection is using information criterion such as AIC, BIC. Alternatively, model comparison method such as likelihood ratio test can be used to compare nested models. Here, I created a function to batch run multiple LCA across different number of classes to select the optimal models.</p>
<div class="cell" data-hl_lines="[1,3]" data-linenos="[&quot;function (..., exclude = if (useNA == &quot;no&quot;) c(NA, NaN), useNA = c(&quot;no&quot;, &quot;,&quot;    &quot;ifany&quot;, &quot;always&quot;), dnn = list.names(...), deparse.level = 1) &quot;,&quot;{&quot;,&quot;    list.names <- function(...) {&quot;,&quot;        l <- as.list(substitute(list(...)))[-1L]&quot;,&quot;        if (length(l) == 1L &amp;&amp; is.list(..1) &amp;&amp; !is.null(nm <- names(..1))) &quot;,&quot;            return(nm)&quot;,&quot;        nm <- names(l)&quot;,&quot;        fixup <- if (is.null(nm)) &quot;,&quot;            seq_along(l)&quot;,&quot;        else nm == &quot;&quot;&quot;,&quot;        dep <- vapply(l[fixup], function(x) switch(deparse.level + &quot;,&quot;            1, &quot;&quot;, if (is.symbol(x)) as.character(x) else &quot;&quot;, &quot;,&quot;            deparse(x, nlines = 1)[1L]), &quot;&quot;)&quot;,&quot;        if (is.null(nm)) &quot;,&quot;            dep&quot;,&quot;        else {&quot;,&quot;            nm[fixup] <- dep&quot;,&quot;            nm&quot;,&quot;        }&quot;,&quot;    }&quot;,&quot;    miss.use <- missing(useNA)&quot;,&quot;    miss.exc <- missing(exclude)&quot;,&quot;    useNA <- if (miss.use &amp;&amp; !miss.exc &amp;&amp; !match(NA, exclude, &quot;,&quot;        nomatch = 0L)) &quot;,&quot;        &quot;ifany&quot;&quot;,&quot;    else match.arg(useNA)&quot;,&quot;    doNA <- useNA != &quot;no&quot;&quot;,&quot;    if (!miss.use &amp;&amp; !miss.exc &amp;&amp; doNA &amp;&amp; match(NA, exclude, &quot;,&quot;        nomatch = 0L)) &quot;,&quot;        warning(&quot;'exclude' containing NA and 'useNA' != \&quot;no\&quot;' are a bit contradicting&quot;)&quot;,&quot;    args <- list(...)&quot;,&quot;    if (length(args) == 1L &amp;&amp; is.list(args[[1L]])) {&quot;,&quot;        args <- args[[1L]]&quot;,&quot;        if (length(dnn) != length(args)) &quot;,&quot;            dnn <- paste(dnn[1L], seq_along(args), sep = &quot;.&quot;)&quot;,&quot;    }&quot;,&quot;    if (!length(args)) &quot;,&quot;        stop(&quot;nothing to tabulate&quot;)&quot;,&quot;    bin <- 0L&quot;,&quot;    lens <- NULL&quot;,&quot;    dims <- integer()&quot;,&quot;    pd <- 1L&quot;,&quot;    dn <- NULL&quot;,&quot;    for (a in args) {&quot;,&quot;        if (is.null(lens)) &quot;,&quot;            lens <- length(a)&quot;,&quot;        else if (length(a) != lens) &quot;,&quot;            stop(&quot;all arguments must have the same length&quot;)&quot;,&quot;        fact.a <- is.factor(a)&quot;,&quot;        if (doNA) &quot;,&quot;            aNA <- anyNA(a)&quot;,&quot;        if (!fact.a) {&quot;,&quot;            a0 <- a&quot;,&quot;            op <- options(warn = 2)&quot;,&quot;            a <- factor(a, exclude = exclude)&quot;,&quot;            options(op)&quot;,&quot;        }&quot;,&quot;        add.na <- doNA&quot;,&quot;        if (add.na) {&quot;,&quot;            ifany <- (useNA == &quot;ifany&quot;)&quot;,&quot;            anNAc <- anyNA(a)&quot;,&quot;            add.na <- if (!ifany || anNAc) {&quot;,&quot;                ll <- levels(a)&quot;,&quot;                if (add.ll <- !anyNA(ll)) {&quot;,&quot;                  ll <- c(ll, NA)&quot;,&quot;                  TRUE&quot;,&quot;                }&quot;,&quot;                else if (!ifany &amp;&amp; !anNAc) &quot;,&quot;                  FALSE&quot;,&quot;                else TRUE&quot;,&quot;            }&quot;,&quot;            else FALSE&quot;,&quot;        }&quot;,&quot;        if (add.na) &quot;,&quot;            a <- factor(a, levels = ll, exclude = NULL)&quot;,&quot;        else ll <- levels(a)&quot;,&quot;        a <- as.integer(a)&quot;,&quot;        if (fact.a &amp;&amp; !miss.exc) {&quot;,&quot;            ll <- ll[keep <- which(match(ll, exclude, nomatch = 0L) == &quot;,&quot;                0L)]&quot;,&quot;            a <- match(a, keep)&quot;,&quot;        }&quot;,&quot;        else if (!fact.a &amp;&amp; add.na) {&quot;,&quot;            if (ifany &amp;&amp; !aNA &amp;&amp; add.ll) {&quot;,&quot;                ll <- ll[!is.na(ll)]&quot;,&quot;                is.na(a) <- match(a0, c(exclude, NA), nomatch = 0L) > &quot;,&quot;                  0L&quot;,&quot;            }&quot;,&quot;            else {&quot;,&quot;                is.na(a) <- match(a0, exclude, nomatch = 0L) > &quot;,&quot;                  0L&quot;,&quot;            }&quot;,&quot;        }&quot;,&quot;        nl <- length(ll)&quot;,&quot;        dims <- c(dims, nl)&quot;,&quot;        if (prod(dims) > .Machine$integer.max) &quot;,&quot;            stop(&quot;attempt to make a table with >= 2^31 elements&quot;)&quot;,&quot;        dn <- c(dn, list(ll))&quot;,&quot;        bin <- bin + pd * (a - 1L)&quot;,&quot;        pd <- pd * nl&quot;,&quot;    }&quot;,&quot;    names(dn) <- dnn&quot;,&quot;    bin <- bin[!is.na(bin)]&quot;,&quot;    if (length(bin)) &quot;,&quot;        bin <- bin + 1L&quot;,&quot;    y <- array(tabulate(bin, pd), dims, dimnames = dn)&quot;,&quot;    class(y) <- &quot;table&quot;&quot;,&quot;    y&quot;,&quot;}&quot;]">
<details class="code-fold"><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>fitMplus <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data =</span> dat, class, </span>
<span id="cb6-2"><a href="#cb6-2"></a>                     <span class="at">uvars =</span> <span class="st">"Male-EduS_High"</span>, <span class="at">auxvars=</span> <span class="cn">NULL</span>, </span>
<span id="cb6-3"><a href="#cb6-3"></a>                     <span class="at">modelout =</span> <span class="cn">NULL</span>, <span class="at">savedata =</span> <span class="cn">NULL</span> ) {</span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="do">## specify the used variables</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>  fitIndices <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"LL"</span>, <span class="st">"AIC"</span>, <span class="st">"BIC"</span>, <span class="st">"aBIC"</span>, <span class="st">"Entropy"</span>, <span class="st">"T11_LMR_PValue"</span>)</span>
<span id="cb6-6"><a href="#cb6-6"></a>  </span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(savedata)) {</span>
<span id="cb6-8"><a href="#cb6-8"></a>    savedata <span class="ot">=</span> <span class="st">"Mplus/model_Temp_save.txt"</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>  }</span>
<span id="cb6-10"><a href="#cb6-10"></a>  </span>
<span id="cb6-11"><a href="#cb6-11"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(auxvars)) {</span>
<span id="cb6-12"><a href="#cb6-12"></a>    start_index <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">colnames</span>(data) <span class="sc">==</span> <span class="fu">str_split</span>(uvars, <span class="st">"-"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>])</span>
<span id="cb6-13"><a href="#cb6-13"></a>    end_index <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">colnames</span>(data) <span class="sc">==</span> <span class="fu">str_split</span>(auxvars, <span class="st">"-"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>])</span>
<span id="cb6-14"><a href="#cb6-14"></a>    modelTEMP <span class="ot">&lt;-</span> <span class="fu">mplusObject</span>(</span>
<span id="cb6-15"><a href="#cb6-15"></a>      <span class="at">TITLE =</span> <span class="st">"Batch Analysis of Latent Class Models;"</span>,</span>
<span id="cb6-16"><a href="#cb6-16"></a>      <span class="at">VARIABLE =</span> <span class="fu">paste0</span>(<span class="st">"</span></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="st">      CATEGORICAL = "</span>, uvars, <span class="st">";</span></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="st">      CLASSES = c("</span>, class, <span class="st">");</span></span>
<span id="cb6-19"><a href="#cb6-19"></a><span class="st">      AUXILIARY = "</span>, auxvars,<span class="st">" (R3STEP);</span></span>
<span id="cb6-20"><a href="#cb6-20"></a><span class="st">      "</span>),</span>
<span id="cb6-21"><a href="#cb6-21"></a>      <span class="at">ANALYSIS =</span> <span class="st">"</span></span>
<span id="cb6-22"><a href="#cb6-22"></a><span class="st">      TYPE = MIXTURE;</span></span>
<span id="cb6-23"><a href="#cb6-23"></a><span class="st">      "</span>,</span>
<span id="cb6-24"><a href="#cb6-24"></a>      <span class="at">SAVEDATA =</span> </span>
<span id="cb6-25"><a href="#cb6-25"></a>      <span class="fu">paste0</span>(<span class="st">"</span></span>
<span id="cb6-26"><a href="#cb6-26"></a><span class="st">      FILE IS "</span>, savedata,<span class="st">";</span></span>
<span id="cb6-27"><a href="#cb6-27"></a><span class="st">      SAVE IS cprob;</span></span>
<span id="cb6-28"><a href="#cb6-28"></a><span class="st">      FORMAT IS free;</span></span>
<span id="cb6-29"><a href="#cb6-29"></a><span class="st">      "</span>),</span>
<span id="cb6-30"><a href="#cb6-30"></a>      <span class="at">OUTPUT =</span> <span class="st">"TECH1 TECH8 TECH11;"</span>,</span>
<span id="cb6-31"><a href="#cb6-31"></a>      <span class="at">rdata =</span> data,</span>
<span id="cb6-32"><a href="#cb6-32"></a>      <span class="at">usevariables =</span> <span class="fu">colnames</span>(data[start_index<span class="sc">:</span>end_index]),</span>
<span id="cb6-33"><a href="#cb6-33"></a>      <span class="at">autov =</span> <span class="cn">TRUE</span></span>
<span id="cb6-34"><a href="#cb6-34"></a>    )</span>
<span id="cb6-35"><a href="#cb6-35"></a>  }<span class="cf">else</span>{</span>
<span id="cb6-36"><a href="#cb6-36"></a>    start_index <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">colnames</span>(data) <span class="sc">==</span> <span class="fu">str_split</span>(uvars, <span class="st">"-"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>])</span>
<span id="cb6-37"><a href="#cb6-37"></a>    end_index <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">colnames</span>(data) <span class="sc">==</span> <span class="fu">str_split</span>(uvars, <span class="st">"-"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>])</span>
<span id="cb6-38"><a href="#cb6-38"></a>    modelTEMP <span class="ot">&lt;-</span> <span class="fu">mplusObject</span>(</span>
<span id="cb6-39"><a href="#cb6-39"></a>      <span class="at">TITLE =</span> <span class="st">"Batch Analysis of Latent Class Models;"</span>,</span>
<span id="cb6-40"><a href="#cb6-40"></a>      <span class="at">VARIABLE =</span> <span class="fu">paste0</span>(<span class="st">"</span></span>
<span id="cb6-41"><a href="#cb6-41"></a><span class="st">      CATEGORICAL = "</span>, uvars, <span class="st">";</span></span>
<span id="cb6-42"><a href="#cb6-42"></a><span class="st">      CLASSES = c("</span>, class, <span class="st">");</span></span>
<span id="cb6-43"><a href="#cb6-43"></a><span class="st">      "</span>),</span>
<span id="cb6-44"><a href="#cb6-44"></a>      <span class="at">ANALYSIS =</span> <span class="st">"</span></span>
<span id="cb6-45"><a href="#cb6-45"></a><span class="st">      TYPE = MIXTURE;</span></span>
<span id="cb6-46"><a href="#cb6-46"></a><span class="st">      "</span>,</span>
<span id="cb6-47"><a href="#cb6-47"></a>      <span class="at">SAVEDATA =</span> </span>
<span id="cb6-48"><a href="#cb6-48"></a>      <span class="fu">paste0</span>(<span class="st">"</span></span>
<span id="cb6-49"><a href="#cb6-49"></a><span class="st">      FILE IS "</span>, savedata,<span class="st">";</span></span>
<span id="cb6-50"><a href="#cb6-50"></a><span class="st">      SAVE IS cprob;</span></span>
<span id="cb6-51"><a href="#cb6-51"></a><span class="st">      FORMAT IS free;</span></span>
<span id="cb6-52"><a href="#cb6-52"></a><span class="st">      "</span>),</span>
<span id="cb6-53"><a href="#cb6-53"></a>      <span class="at">OUTPUT =</span> <span class="st">"TECH1 TECH8 TECH11;"</span>,</span>
<span id="cb6-54"><a href="#cb6-54"></a>      <span class="at">rdata =</span> data,</span>
<span id="cb6-55"><a href="#cb6-55"></a>      <span class="at">usevariables =</span> <span class="fu">colnames</span>(data[start_index<span class="sc">:</span>end_index]),</span>
<span id="cb6-56"><a href="#cb6-56"></a>      <span class="at">autov =</span> <span class="cn">TRUE</span></span>
<span id="cb6-57"><a href="#cb6-57"></a>    )</span>
<span id="cb6-58"><a href="#cb6-58"></a>  }</span>
<span id="cb6-59"><a href="#cb6-59"></a>  </span>
<span id="cb6-60"><a href="#cb6-60"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(modelout)) {</span>
<span id="cb6-61"><a href="#cb6-61"></a>    <span class="fu">suppressMessages</span>(resTEMP <span class="ot">&lt;-</span> <span class="fu">mplusModeler</span>(modelTEMP, <span class="at">modelout =</span> modelout, <span class="at">run =</span> <span class="dv">1</span>L))</span>
<span id="cb6-62"><a href="#cb6-62"></a>  }<span class="cf">else</span>{</span>
<span id="cb6-63"><a href="#cb6-63"></a>    <span class="fu">suppressMessages</span>(resTEMP <span class="ot">&lt;-</span> <span class="fu">mplusModeler</span>(modelTEMP, <span class="at">modelout =</span> <span class="st">"Mplus/modelTEMP.inp"</span>, <span class="at">run =</span> <span class="dv">1</span>L))</span>
<span id="cb6-64"><a href="#cb6-64"></a>  }</span>
<span id="cb6-65"><a href="#cb6-65"></a>  </span>
<span id="cb6-66"><a href="#cb6-66"></a>  summaryTEMP <span class="ot">&lt;-</span> <span class="fu">get_summaries</span>(resTEMP, <span class="at">simplify =</span> T)</span>
<span id="cb6-67"><a href="#cb6-67"></a>  summaryTEMP <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">X =</span> <span class="fu">unlist</span>(summaryTEMP[<span class="fu">rownames</span>(summaryTEMP) <span class="sc">%in%</span> fitIndices, ]))</span>
<span id="cb6-68"><a href="#cb6-68"></a>  <span class="fu">colnames</span>(summaryTEMP) <span class="ot">=</span> <span class="fu">paste0</span>(class, <span class="st">"-class Model"</span>)</span>
<span id="cb6-69"><a href="#cb6-69"></a>  </span>
<span id="cb6-70"><a href="#cb6-70"></a>  <span class="co"># return</span></span>
<span id="cb6-71"><a href="#cb6-71"></a>  <span class="fu">list</span>(</span>
<span id="cb6-72"><a href="#cb6-72"></a>    <span class="at">model =</span> resTEMP,</span>
<span id="cb6-73"><a href="#cb6-73"></a>    <span class="at">summary =</span> <span class="fu">t</span>(summaryTEMP)  </span>
<span id="cb6-74"><a href="#cb6-74"></a>  )</span>
<span id="cb6-75"><a href="#cb6-75"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then, I ran a series of latent class models with different number of classes (from 2 to 7 latent classes):</p>
<div class="cell">
<details class="code-fold"><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>lcmFit <span class="ot">=</span> <span class="fu">as.data.frame</span>(<span class="fu">Reduce</span>(rbind, <span class="fu">future_map</span>(</span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>, \(x) <span class="fu">fitMplus</span>(<span class="at">data =</span> dat, <span class="at">class =</span> x, </span>
<span id="cb7-3"><a href="#cb7-3"></a>                     <span class="at">uvars =</span> <span class="st">"Male-EduS_High"</span>,</span>
<span id="cb7-4"><a href="#cb7-4"></a>                     <span class="at">modelout =</span> <span class="st">"Mplus/model1fit.inp"</span>,</span>
<span id="cb7-5"><a href="#cb7-5"></a>                     <span class="at">savedata =</span> <span class="st">"Mplus/model_Temp_save.txt"</span>)<span class="sc">$</span>summary</span>
<span id="cb7-6"><a href="#cb7-6"></a>)))</span>
<span id="cb7-7"><a href="#cb7-7"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(lcmFit, <span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-8"><a href="#cb7-8"></a>  <span class="fu">kable_material_dark</span>(<span class="at">full_width =</span> F, <span class="at">html_font =</span> <span class="st">"Maven Pro"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-9"><a href="#cb7-9"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"condensed"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<table class="lightable-material-dark table table-condensed table-hover table-sm table-striped small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LL</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">AIC</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BIC</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">aBIC</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Entropy</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">T11_LMR_PValue</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2-class Model</td>
<td style="text-align: right;">-8527.781</td>
<td style="text-align: right;">17093.56</td>
<td style="text-align: right;">17201.57</td>
<td style="text-align: right;">17141.21</td>
<td style="text-align: right;">0.936</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">3-class Model</td>
<td style="text-align: right;">-8240.625</td>
<td style="text-align: right;">16539.25</td>
<td style="text-align: right;">16704.11</td>
<td style="text-align: right;">16611.97</td>
<td style="text-align: right;">0.952</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4-class Model</td>
<td style="text-align: right;">-8049.198</td>
<td style="text-align: right;">16176.40</td>
<td style="text-align: right;">16398.10</td>
<td style="text-align: right;">16274.19</td>
<td style="text-align: right;">0.969</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">5-class Model</td>
<td style="text-align: right;">-7978.962</td>
<td style="text-align: right;">16055.92</td>
<td style="text-align: right;">16334.48</td>
<td style="text-align: right;">16178.80</td>
<td style="text-align: right;">0.951</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6-class Model</td>
<td style="text-align: right;">-7917.136</td>
<td style="text-align: right;">15952.27</td>
<td style="text-align: right;">16287.67</td>
<td style="text-align: right;">16100.22</td>
<td style="text-align: right;">0.990</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">7-class Model</td>
<td style="text-align: right;">-7849.506</td>
<td style="text-align: right;">15837.01</td>
<td style="text-align: right;">16229.26</td>
<td style="text-align: right;">16010.04</td>
<td style="text-align: right;">0.934</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>As the table shown, 7-class model appears to have the best model fit among 6 alternative models (lowest AIC/BIC/aBIC).</p>
</section></section><section id="conclusion" class="level2" data-number="3"><h2 data-number="3" class="anchored" data-anchor-id="conclusion">
<span class="header-section-number">3</span> Conclusion</h2>
<p><code>MplusAutomation</code> + R could be good tools for LCA. However, extracting information from Mplus output file is not so easy. For example, when there are auxiliary variables exists, the regression coefficients regressed on latent classes needed to be parsed and extract manually. For example, following functions can be used to extract the regression coefficients of latent class model using the 3-step approach.</p>
<div class="cell">
<details class="code-fold"><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co">#------------#</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co"># Extract output regression table from R3Step LCA</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co">#------------#</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>extract_r3step <span class="ot">&lt;-</span> <span class="cf">function</span>(model_path){</span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="co"># browser()</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>  <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">read_lines</span>(model_path)) <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>    <span class="fu">mutate</span>(<span class="at">row1 =</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())[<span class="fu">str_detect</span>(x, <span class="st">'NUMBER OF OBSERVATIONS USED'</span>)],</span>
<span id="cb8-8"><a href="#cb8-8"></a>           <span class="at">row2 =</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())[<span class="fu">str_detect</span>(x, </span>
<span id="cb8-9"><a href="#cb8-9"></a>                                     <span class="st">'^ODDS RATIOS FOR TESTS OF CATEGORICAL LATENT VARIABLE'</span>)]) <span class="sc">%&gt;%</span></span>
<span id="cb8-10"><a href="#cb8-10"></a>    <span class="fu">slice</span>((.<span class="sc">$</span>row1[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">2</span>)<span class="sc">:</span>(.<span class="sc">$</span>row2[<span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-11"><a href="#cb8-11"></a>    <span class="fu">mutate</span>(<span class="at">type_comparison =</span> <span class="fu">str_detect</span>(x, <span class="st">'Parameterization using Reference'</span>),</span>
<span id="cb8-12"><a href="#cb8-12"></a>           <span class="at">type_colname =</span> <span class="fu">str_detect</span>(x, <span class="st">'Estimate'</span>),</span>
<span id="cb8-13"><a href="#cb8-13"></a>           <span class="at">type_classnum =</span> <span class="fu">str_detect</span>(x, <span class="st">'C#[0-9]+'</span>),</span>
<span id="cb8-14"><a href="#cb8-14"></a>           <span class="at">type_predictor =</span> <span class="fu">str_detect</span>(x, <span class="st">'[</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">-0-9]+[</span><span class="sc">\\</span><span class="st">s]+[</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">-0-9]+'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-15"><a href="#cb8-15"></a>    <span class="fu">mutate</span>(<span class="at">class =</span> <span class="fu">ifelse</span>(type_classnum, <span class="fu">parse_number</span>(x), <span class="cn">NA</span>),</span>
<span id="cb8-16"><a href="#cb8-16"></a>           <span class="at">predictors =</span> <span class="fu">ifelse</span>(type_predictor, <span class="fu">map</span>(x, parse_predictors), <span class="fu">list</span>()),</span>
<span id="cb8-17"><a href="#cb8-17"></a>           <span class="at">comparison_group =</span> <span class="fu">cumsum</span>(type_comparison)) <span class="sc">%&gt;%</span></span>
<span id="cb8-18"><a href="#cb8-18"></a>    <span class="fu">group_by</span>(comparison_group) <span class="sc">%&gt;%</span></span>
<span id="cb8-19"><a href="#cb8-19"></a>    <span class="fu">mutate</span>(<span class="at">class_group =</span> <span class="fu">cumsum</span>(type_classnum)) <span class="sc">%&gt;%</span></span>
<span id="cb8-20"><a href="#cb8-20"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-21"><a href="#cb8-21"></a>    <span class="fu">mutate</span>(<span class="at">comparison_group =</span> <span class="fu">ifelse</span>(comparison_group <span class="sc">==</span> <span class="dv">0</span>, </span>
<span id="cb8-22"><a href="#cb8-22"></a>                                     <span class="fu">max</span>(class, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), comparison_group)) <span class="sc">%&gt;%</span></span>
<span id="cb8-23"><a href="#cb8-23"></a>    <span class="fu">group_by</span>(comparison_group, class_group) <span class="sc">%&gt;%</span></span>
<span id="cb8-24"><a href="#cb8-24"></a>    <span class="fu">filter</span>(class_group <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-25"><a href="#cb8-25"></a>    <span class="fu">mutate</span>(<span class="at">class_group2 =</span> class[<span class="sc">!</span><span class="fu">is.na</span>(class)]) <span class="sc">%&gt;%</span></span>
<span id="cb8-26"><a href="#cb8-26"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-27"><a href="#cb8-27"></a>    <span class="fu">filter</span>(type_predictor) <span class="sc">%&gt;%</span></span>
<span id="cb8-28"><a href="#cb8-28"></a>    <span class="fu">select</span>(comparison_group, class_group2, predictors) <span class="sc">%&gt;%</span></span>
<span id="cb8-29"><a href="#cb8-29"></a>    <span class="fu">unnest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-30"><a href="#cb8-30"></a>    <span class="fu">rename</span>(<span class="at">comparison_class =</span> comparison_group,</span>
<span id="cb8-31"><a href="#cb8-31"></a>           <span class="at">class =</span> class_group2) <span class="sc">%&gt;%</span></span>
<span id="cb8-32"><a href="#cb8-32"></a>    <span class="fu">mutate</span>(<span class="at">estimate =</span> <span class="fu">as.numeric</span>(estimate),</span>
<span id="cb8-33"><a href="#cb8-33"></a>           <span class="at">se =</span> <span class="fu">as.numeric</span>(se),</span>
<span id="cb8-34"><a href="#cb8-34"></a>           <span class="at">tval =</span> <span class="fu">as.numeric</span>(tval),</span>
<span id="cb8-35"><a href="#cb8-35"></a>           <span class="at">pval =</span> <span class="fu">as.numeric</span>(pval)) </span>
<span id="cb8-36"><a href="#cb8-36"></a>}</span>
<span id="cb8-37"><a href="#cb8-37"></a>  </span>
<span id="cb8-38"><a href="#cb8-38"></a><span class="co">#------------#</span></span>
<span id="cb8-39"><a href="#cb8-39"></a><span class="co"># Read in save data from Mplus</span></span>
<span id="cb8-40"><a href="#cb8-40"></a><span class="co">#------------#</span></span>
<span id="cb8-41"><a href="#cb8-41"></a>read_saveddata <span class="ot">&lt;-</span> <span class="cf">function</span>(path_output, path_savedata, ...) {</span>
<span id="cb8-42"><a href="#cb8-42"></a>  <span class="do">## extract data and latent classes</span></span>
<span id="cb8-43"><a href="#cb8-43"></a>  mplusOuput <span class="ot">&lt;-</span> <span class="fu">readLines</span>(path_output)</span>
<span id="cb8-44"><a href="#cb8-44"></a>  top <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">str_detect</span>(mplusOuput, <span class="st">"Order of variables"</span>)) <span class="co"># start linenumber</span></span>
<span id="cb8-45"><a href="#cb8-45"></a>  bottom <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">str_detect</span>(mplusOuput, <span class="st">"Save file format"</span>)) <span class="co"># end linenumber</span></span>
<span id="cb8-46"><a href="#cb8-46"></a>  rawVars <span class="ot">&lt;-</span> mplusOuput[(top<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(bottom<span class="dv">-1</span>)]</span>
<span id="cb8-47"><a href="#cb8-47"></a>  savevarnames <span class="ot">&lt;-</span> <span class="fu">trimws</span>(rawVars[rawVars <span class="sc">!=</span> <span class="st">""</span>])</span>
<span id="cb8-48"><a href="#cb8-48"></a>  </span>
<span id="cb8-49"><a href="#cb8-49"></a>  <span class="do">## read saved data from Mplus output</span></span>
<span id="cb8-50"><a href="#cb8-50"></a>  savedDat <span class="ot">&lt;-</span> <span class="fu">read.table</span>(path_savedata, <span class="at">na.strings =</span> <span class="st">"*"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>, </span>
<span id="cb8-51"><a href="#cb8-51"></a>                         <span class="at">col.names =</span> savevarnames, ...)</span>
<span id="cb8-52"><a href="#cb8-52"></a>  savedDat</span>
<span id="cb8-53"><a href="#cb8-53"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Hope this is helpful.</p>


</section><a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.jihongzhang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://giscus.app/client.js" data-repo="JihongZ/quarto-academic-jihong" data-repo-id="R_kgDOJz3gyg" data-category="General" data-category-id="DIC_kwDOJz3gys4CXdYE" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><input type="hidden" id="giscus-base-theme" value="light"><input type="hidden" id="giscus-alt-theme" value="dark">
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2015-2024, JihongZhang</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer><script>var lightboxQuarto = GLightbox({"openEffect":"zoom","loop":false,"selector":".lightbox","closeEffect":"zoom","descPosition":"bottom"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>


</body></html>