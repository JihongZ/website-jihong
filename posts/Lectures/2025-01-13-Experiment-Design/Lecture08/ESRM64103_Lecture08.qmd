---
title: "Lecture 08: Block Design (2)"
subtitle: "Experimental Design in Education"
date: "2025-03-07"
date-modified: "`{r} Sys.Date()`"
execute: 
  eval: true
  echo: true
  warning: false
  message: false
format: 
  html:
    code-tools: true
    code-line-numbers: false
    code-fold: false
    number-offset: 1
    fig.width: 10
    fig-align: center
    message: false
    grid:
      sidebar-width: 350px
  uark-revealjs:
    chalkboard: true
    embed-resources: false
    code-fold: false
    number-sections: true
    number-depth: 1
    footer: "ESRM 64503"
    slide-number: c/t
    tbl-colwidths: auto
    scrollable: true
    output-file: slides-index.html
    mermaid:
      theme: forest    
---

::: objectives
## Overview {.unnumbered}

1.  Review Block Design
2.  Randomized Block Design with R Programming[^1]
3.  Completely Randomized Block Design with R Programming[^2]
:::

[^1]: Please check [here](https://www.geeksforgeeks.org/randomized-block-design-with-r-programming/) for the original post

[^2]: Please check [here](https://www.geeksforgeeks.org/completely-randomized-design-with-r-programming/?ref=ml_lbp) for the original post

```{r setup, include=FALSE}
library(tidyverse)
library(gt)
```

## Features of RCBD

::: discussion
Think about our example of the effects of teaching methods (M1, M2, M3, M4) and measurement forms (F1, F2, F3, F4) to math performance.
:::

1.  In a **randomized complete block design (RCBD)**, each block size is the same and is equal to the number of treatments (i.e. factor levels or factor level combinations).
    -   For those who using saming form (same block), they will be randomly assigned to 4 teaching methods.
2.  Each treatment will be randomly assigned to exactly one experimental unit (students) within every block.
3.  The assignments of treatment levels (teaching methods) to the experimental units (students) have to be done within each block separately.

## Random Effects of RCBD

1.  It is important to mention that blocks are usually (but not always) treated as random effects as they typically represent the population of all possible blocks.
2.  In other words, the mean comparison among specific blocks is not of interest.
3.  However, the variation between blocks must be incorporated into the model.

## Example 1: Tutoring session

:::::: columns
::: {.column width="60%"}
-   Let’s look at a simple example:
-   Research question: **What is the effect of time of day of** **tutoring session on midterm grades?**
-   The Primary Investigator (PI) of the study wants to control for tutor, believing some tutors may be better in the subject matter than others. Thus, they design a completely randomized block design.
-   Each tutor works with students in the morning and afternoon.
    -   In this example, student select their favorite tutor, but are then randomly assigned to either a morning (AM) or afternoon (PM) session.
    -   200 total students: 91 in the morning, 109 in the afternoon
:::

:::: {.column width="40%"}
![](images/clipboard-3708810514.png)

::: callout-note
DV: Midterm Score (in cells)
:::
::::
::::::

------------------------------------------------------------------------

### Example 1: Variables and Null Hypothesis

:::::: columns
::: {.column width="60%"}
-   IV: Time (𝑎= 2 )
    -   [2 levels]{style="color: orange"}: AM and PM
-   Nuisance factor: Tutor (𝑏= 4 )
    -   [4 levels]{style="color: purple"}: Booby, Julia, Monique, and Ned
-   DV: Midterm Score
-   Null hypothesis pertaining to the IV of interest:
    -   $H_0:\mu_{𝐴𝑀} = \mu_{𝑃𝑀} → a= 2$
-   We will also have a null hypothesis pertaining to the blocking factor:
    -   $H_0:\mu_{Bobby} = \mu_{Julia} = \mu_{Monique} =\mu_{Ned} → b=4$
    
-   Two nulls = two values of $F_{obs}$, two values of $F_{crit}$, two decisions
:::

:::: {.column width="40%"}
![](images/clipboard-3708810514.png)

::: callout-note
DV: Midterm Score (in cells)
:::
::::
::::::

------------------------------------------------------------------------

### Example 1: Sum of Squares 

::::: columns
::: {.column width="70%"}
-   IV: Time (𝑎= 2 )

-   Nuisance factor: Tutor (𝑏= 4 )

-   DV: Midterm Score

-   Now:

    -   $𝑆𝑆_{Total} =\color{red}{𝑆𝑆_{𝑀𝑜𝑑𝑒𝑙}}+\color{purple}{𝑆𝑆_{𝐵𝑙𝑜𝑐𝑘}}+\color{blue}{𝑆𝑆_{𝐸𝑟𝑟𝑜𝑟}}$

-   Thus, we can partition the effects into three parts:

    -   Sum of squares due to [treatments (IV = Time)]{style="color: red"},

    -   Sum of squares due to the [blocking factor]{style="color: purple"},

    -   and Sum of squares due to [error]{style="color: blue"}.

-   We **do not** model an **interaction** with blocked designs. (we will talk about it later.)
:::

::: {.column width="30%"}
![](images/clipboard-624916915.png)
:::
:::::

------------------------------------------------------------------------

### Example 1: Mean of Squares and F-statistics

-   IV: Time (𝑎= 2 )
-   Nuisance factor: Tutor (𝑏= 4 )
-   DV: Midterm Score
-   Model: $𝑆𝑆_{Total} =\color{red}{𝑆𝑆_{𝑀𝑜𝑑𝑒𝑙}}+\color{purple}{𝑆𝑆_{𝐵𝑙𝑜𝑐𝑘}}+\color{blue}{𝑆𝑆_{𝐸𝑟𝑟𝑜𝑟}}$
-   ANOVA table:

![](images/clipboard-505786804.png)

------------------------------------------------------------------------

### Example 1: Sum of Square Formula

$$
SS_{Total}=\sum_{i=1}^{n}(y_{ij}-\bar{y}_{..})^2
$$

-   This is the same as before: take each individual score ($y_{ij}$), subtract the grand mean ($\bar{y}$), and square it $(y_{ij}-\bar{y}_{..})^2$

-   Do this for everyone and then sum over all people $\sum_{i=1}^{n}(y_{ij}-\bar{y}_{..})^2$

-   However, when calculating IV: $SS_{Model}$, $SS_{Block}$, $SS_{error}$, we need to compute "**marginal means**"

    -   A **marginal mean** is the mean for one level of the variable, ignoring the other variable

------------------------------------------------------------------------

### Example 1: Marginal Means

-   A **marginal mean** is the mean for one level of the variable, ignoring the other variable

::::: columns
::: {.column width="50%"}
For example:

-   The AM marginal mean is the average of all students’ midterm scores in the morning, ignoring who they have as a tutor $$
    \bar{y}_{AM.} = 22.95
    $$
-   The Bobby marginal mean is the average of all students’ midterm scores who had Bobby as a tutor, ignoring time of day $$
    \bar{y}_{.Bobby} = 11.91
    $$
:::

::: {.column width="50%"}
![](images/clipboard-560146152.png)
:::
:::::

------------------------------------------------------------------------

### Example 1: SS for Total and Model

$$
SS_{Total} = \sum_{i=1}^{n}(y_{ij}-\bar{y}_{..})^2=15060.48
$$

$$
SS_{Model(time)} = \sum_{a=1}^{a}n_a(\bar{y}_{a.}-\bar{y}_{..})^2=4489.02
$$

-   where $n_a$ is the group size for AM/PM and $\bar{y}_{a.}$ are the marginal means for AM and PM {22.95, 13.43}

-   This is similar to how we computed $𝑆𝑆_{𝑀𝑜𝑑𝑒𝑙}$ before: marginal group mean subtract off the grand mean and square it. Sum over all groups.

$$
SS_{Block} = \sum_{b=1}^{b}n_{b}(\bar{y}_{.b}-\bar{y}_{..})^2=3239.43
$$

-   Technically, the blocking factor is just another IV (but we are not interested in or is not within the scope of research question).

    -   $𝑆𝑆_{𝐸𝑟𝑟𝑜𝑟} = 𝑆𝑆_{𝑇𝑜𝑡𝑎𝑙}− 𝑆𝑆_{𝑀𝑜𝑑𝑒𝑙} +𝑆𝑆_{𝐵𝑙𝑜𝑐𝑘}$ = 7332. 03

------------------------------------------------------------------------

### Example 1: Details of ANOVA Table

-   Then, we can fill out the ANOVA table:

![](images/clipboard-122981133.png)

::: callout-note
Under $\alpha=.05$, for "Model" factor – Time, we have $df_{Model}$ = 1, $df_{error} = 195$: $F_{crit}=3.89$ so sig.

Similarly, for "Blocking" - Tutor, we have $df_{block}$ = 3, $df_{error} = 195$: $F_{crit}=2.65$ so sig.
:::

------------------------------------------------------------------------

### Interpretation

-   A randomized block design was used to test the effect of tutoring time on midterm scores. For each tutor, participants were randomly assigned to either morning (𝑛 = 91 ) or afternoon (𝑛= 109 ) tutoring sessions.
-   The effect of tutoring time was significant $(𝐹(1,195) = 119. 39, 𝑝<. 001 ,\eta^2_{𝑇𝑖𝑚𝑒} =. 298$) with a large effect. Using a Tukey’s test, morning is significantly higher than afternoon sessions (𝑝 \<. 05 ).
-   The effect of the blocking factor, tutor, was significant ($𝐹(3 , 195) = 28. 72 ,𝑝< . 001 ,\eta^2_{𝑇𝑢𝑡𝑜𝑟} =. 215$) with a large effect. Using a Tukey’s test, Monique’s students were significantly higher than other students, and Bobby’s students were significantly lower than other students in the midterm scores (𝑝\<. 05 ).

## Exercises

:::: discussion
-   A poultry experiment was run to investigate the effect of **diet** and **antibiotics** on egg production. They evaluated 2 diets of interest and 2 specific antibiotics that are on the market. The feed and antibiotic were combined and used to fill the feeding trays in barns. They chose 3 poultry farms at random and randomly assigned the combinations of diet and antibiotic to 4 barns within each farm. Total egg production by the chickens was recorded after 4 weeks.
    1.  What is the experimental design (hint: think about the randomization process)?
    2.  Identify which factors are treatment and block.

::: {.callout-note .mohu}
## Answer

a.  RCBD.
b.  treatment: combination of Diet and Antibiotic; block: Farms.
:::
::::

## Experiment 2: Plan Fertilizer[^3]

[^3]: Please check the original post here: [STAT 502 Analysis of Variance and Design of Experiments](https://online.stat.psu.edu/stat502/lesson/7/7.3)

::::: columns
::: column
1.  In a greenhouse experiment, there was a single factor (fertilizer) with 4 levels (i.e. 4 treatments), six replications, and a total of 24 experimental units (potted plants). Suppose the image below is the greenhouse bench (viewed from above) that was used for the experiment.

2.  To use CBD, we need to randomly assign each of the treatment levels to 6 potted plants. To do this, we first assign numbers to the physical position of the pots on the bench. Each column of plants will be use one Fertilizer.

3.  To further expand it to RCBD, we need to put them into different farms (say we have six farms). Each farms will have 4 plans with each will use one type of fertilizer.
:::

::: column
![](images/clipboard-1929254708.png){width="100%"}
:::
:::::

------------------------------------------------------------------------

### Read in R Data

-   After saving the **exp1_data.csv** into the same directory of your R file. You should be able to import dataset from Files Panel in Rstudio:

![](images/clipboard-1848460327.png)

![](images/clipboard-1116098669.png)

------------------------------------------------------------------------

### Block Design

```{r}
#| include: false
library(tidyverse)
dat <- tribble(
  ~Block, ~Fertilizer, ~Height,
"Block1", "Control", 19.5,
"Block2", "Control", 20.5,
"Block3", "Control", 21,
"Block4", "Control", 21,
"Block5", "Control", 21.5,
"Block6", "Control", 22.5,
"Block1", "F1", 25,
"Block2", "F1", 27.5,
"Block3", "F1", 28,
"Block4", "F1", 28.6,
"Block5", "F1", 30.5,
"Block6", "F1", 32,
"Block1", "F2", 22.5,
"Block2", "F2", 25.2,
"Block3", "F2", 26,
"Block4", "F2", 26.5,
"Block5", "F2", 27,
"Block6", "F2", 28,
"Block1", "F3", 27.5,
"Block2", "F3", 28,
"Block3", "F3", 29.2,
"Block4", "F3", 29.5,
"Block5", "F3", 30,
"Block6", "F3", 31
)
dat$Plant <- 1:nrow(dat)
# write.csv(dat, "exp1_data.csv")
```

```{r}
#| echo: true
gt(dat, 
   rownames_to_stub = TRUE, 
   groupname_col = "Block", 
   row_group_as_column = TRUE) |> 
   tab_options(table.width = px(300))
```

------------------------------------------------------------------------

### ANOVA Results

:::::: columns
::: column
-   Let us obtain the ANOVA table for the **RCBD**. To run the model with Block Design in R we can use the `aov()` function with the formula:

`<Outcome>~<Treatment>+<Block>`.

```{r}
fit_rcbd <- aov(Height ~ Fertilizer + Block, data = dat)				 
summary(fit_rcbd)
```
:::

::: column
-   For comparison, let us obtain the ANOVA table for the **CRD** for the same data. We use the following R code with the formula:

`<Outcome>~<Treatment>`

```{r}
fit_cbd <- aov(Height ~ Fertilizer, data = dat)				 
summary(fit_cbd)
```
:::

::: discussion
## Interpretation {.unnumbered}

Comparing the two ANOVA tables, we see that the MSE in RCBD has decreased considerably in comparison to the CRD. This reduction in MSE can be viewed as the partition in SSE for the CRD (61.033) into SSBlock (53.32) + SSE (7.715). The potential reduction in SSE by blocking is offset to some degree by losing degrees of freedom for the blocks. But more often than not, is worth it in terms of the improvement in the calculated *F*-statistic. In our example, we observe that the *F*-statistic for the treatment has increased considerably for RCBD in comparison to CRD. It is reasonable to assume that the result from the RCBD is more valid than that from the CRD as the MSE value obtained after accounting for the block to block variability is a more accurate representation of the random error variance.
:::
::::::

## Experiment 2

-   **Background**: Testing new fertilizers in different types of crops.
-   **Design**: Crops are divided into 3 different types (blocks). These blocks are again divided into 3 fertilizers (F1, F2, and NF) that are used on those crops. The figure of study design can be visualized as follows:

![](https://media.geeksforgeeks.org/wp-content/uploads/20201014082316/RCBDexample.PNG)

```{r}
corn <- factor(rep(c("corn", "rice", "wheat"), each = 3)) 
fert <- factor(rep(c("f1", "f2", "nf"), times = 3)) 
corn
fert
```

------------------------------------------------------------------------

```{r}
y <- c(6, 5, 6, 
       4, 4.2, 5, 
       5, 4.4, 5.5) 

# y is the months the crops were healthy 
results <- data.frame(y, corn, fert) 
gt(results)
```

------------------------------------------------------------------------

```{r}
fit <- aov(y ~ fert+corn, data = results)				 
summary(fit)
```

-   **Explanation:** The value of *Mean Sq* shows is blocking really necessary for the experiment. Here *Mean Sq for residuals* `0.1078 << 0.7011`, thus blocking is necessary will give precise values for the experiment. Though this method is a little debatable yet useful. The significance value of every experiment is given by the person taking the experiment. Here lets consider significance has 5% i.e 0.05. The Pr(\>F) value is `0.0553>0.05`. Thus the hypothesis is accepted for the crops experiment. Let’s consider one more experiment.

## Experiment 2

-   **Background:** Comparing the performances of students (male and female) blocks in different environments (at home and at college). To represent this experiment in the figure will be as follows:

![](https://media.geeksforgeeks.org/wp-content/uploads/20201015122147/RCBDexample2.PNG)

-   Where *AC*: At College, *AH*: At Home

```{r}
stud <- factor(rep(c("male", "female"), each = 2)) 
perf <- factor(rep(c("ah", "ac" ), times = 2)) 
perf
```

```{r}
y <- c(5.5, 5, 
	4, 6.2) 

# y is the hours students 
# studied in specific places 
results <- data.frame(y, stud, perf) 

fit <- aov(y ~ perf+stud, data = results)				 
summary(fit)
```

-   **Explanation**: The value of Mean Sq is `0.7225<<1.8225`,i.e, here blocking wasn’t necessary. And as Pr value is 0.642 \> 0.05 (5% significance) and the hypothesis is accepted - there is no sufficient evidence suggesting females and males have significant differences in performance.

## Example: 3 Blocking Factors?

-   Researchers are interested in comparing the effectiveness of three health promotion programs with nursing students.
-   The researcher has the following research question: [Which of the three health promotion programs are most effective at reducing unhealthy coping behaviors?]{.underline}
    -   Unhealthy coping behavior is measured as a composite score from the “Poor Coping Behavior” survey (PCB). High scores on the PCB indicate higher levels of unhealthy coping behaviors. Low scores indicate low levels of unhealthy coping behaviors. PCB scores can range from 0 (no unhealthy behaviors) to 100 (multiple unhealthy behaviors at high frequency and high intensity).
    -   The researcher thinks that the health promotion programs for nursing students may have an effect on academic and well-being outcomes.
    -   However, gender and status (traditional vs. non-traditional student) differences may influence the effectiveness of health promotion programs.

------------------------------------------------------------------------

### Example 3: Blocking Factors?

-   The researcher has a sample of 200 nursing students from the state of Arkansas. 50 students are assigned to each program: Program A, Program B, and Program C. In addition, 50 students are assigned to a control group that receives the status quo educational model.
    -   What is the dependent variable? → PCB SCORES
    -   What is the independent variable of interest? → HEALTH PROGRAM (4 LEVELS)
    -   What is (are) the blocking variable(s), aka the confounding variables, that the researcher might statistically control for? → GENDER, STATUS

------------------------------------------------------------------------

### Example 3: Blocking Factors?

::: panel-tabset
## Visualization

![](images/clipboard-1200507560.png)

## Table

![](images/clipboard-2055304403.png)
:::
