{
  "hash": "f3b32e525ff89f2bc629d475bd076b36",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"使用R网页抓取：凡人修仙传剧集\"\nauthor: \"学徒\"\ndate: \"2025-03-22\"\ndraft: false\ncategories: \n  - R\n  - rvest\nexecute: \n  warning: false\n  message: false\nformat: \n  html:\n    code-tools: false\n    code-fold: true\n---\n\n\n\n用[黑桐谷歌【最终幻想7重制版】视频攻略](https://www.bilibili.com/video/BV1iK411L7G5/?vd_source=84566f3ffd99685e26f9d41b7c8dff53)为例。在Inspect中找到视频选集的对应element---`div.title`。这还不够具体，\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rvest)\nlibrary(stringr)\n\n# 查看合集: 黑桐谷歌【最终幻想7重制版】视频攻略 \nurl = \"https://www.bilibili.com/video/BV1iK411L7G5\"\nhtml <- read_html(url);\nhtml_extract <- html_elements(html, css = \"div.simple-base-item > div.title > div.title-txt\")\nhtml_extract |> \n  html_text2() \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"流程攻略 第一章 壹号魔晄炉引爆作战\" \"流程攻略 第二章 第捌区的邂逅\"      \n [3] \"流程攻略 第三章 第七天堂\"           \"流程攻略 第四章 深夜追逐战\"        \n [5] \"流程攻略 第五章 迷宫之犬\"           \"流程攻略 第六章 贫民窟的太阳\"      \n [7] \"流程攻略 第七章 伍号魔晄炉的陷阱\"   \"流程攻略 第八章 重逢之花 上\"       \n [9] \"流程攻略 第八章 重逢之花 下\"        \"流程攻略 第九章 欲望之地 上\"       \n[11] \"流程攻略 第九章 欲望之地 中\"        \"流程攻略 第九章 欲望之地 下\"       \n[13] \"流程攻略 第十章 令人焦急的水路\"     \"流程攻略 第十一章 亡灵的恶作剧\"    \n[15] \"流程攻略 第十二章 雪崩的殊死战斗\"   \"流程攻略 第十三章 毁灭的世界\"      \n[17] \"流程攻略 第十四章 寻求希望 上\"      \"流程攻略 第十四章 寻求希望 下\"     \n[19] \"流程攻略 第十五章 落日之城\"         \"流程攻略 第十六章 潜入神罗大厦 上\" \n[21] \"早期实况P1\"                         \"早期实况P2\"                        \n[23] \"早期实况P3\"                         \"早期实况P4\"                        \n[25] \"早期实况P5\"                         \"早期实况P6\"                        \n[27] \"P7\"                                 \"P8\"                                \n[29] \"P9\"                                 \"P10\"                               \n[31] \"P11\"                                \"P12\"                               \n[33] \"P13\"                                \"P14\"                               \n[35] \"P15\"                                \"P16\"                               \n[37] \"P17\"                                \"P18\"                               \n[39] \"P19\"                                \"P20\"                               \n[41] \"P21\"                                \"P22\"                               \n[43] \"P23\"                                \"P24\"                               \n[45] \"P25\"                                \"P26\"                               \n[47] \"P27完\"                             \n```\n\n\n:::\n:::\n\n\n\n## 豆瓣剧集\n\n从豆瓣网抓取凡人修仙传的简介和每一季的集数。先找到第一到第六以及特别篇的豆瓣网址。\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 第一季《凡人修仙传：风起天南》\ndouban_url <- \"https://movie.douban.com/subject/\"\nurl_s1 = \"34925294/\" # 第一季《凡人修仙传：风起天南》\nurl_s1_2 = \"35259437/\" # 特别篇《燕家堡之战》          \nurl_s2 = \"35640039/\" # 第二季《凡人修仙传：魔道争锋》\nurl_s3 = \"35882624/\" # 第三季《凡人修仙传：再别天南》\nurl_s4 = \"36017435/\" # 第四季《凡人修仙传：初入星海》\nurl_s5 = \"36139980/\" # 第五季《凡人修仙传：星海飞驰》\nurl_s6 = \"36923479/\" # 第六季《凡人修仙传：外海风云》\nurl_all <- c(url_s1, url_s1_2, url_s2, url_s3, url_s4, url_s5, url_s6)\n\nread_html_fanren <- function(douban_url = \"https://movie.douban.com/subject/\",\n                             url) {\n  html <- read_html(paste0(douban_url, url))\n  return(html)\n}\n\n\n## 简介\nget_info <- function(html) {\n  html_info <- html_elements(html, css = \"div.article > div.related-info\")\n  info <- html_info |>  \n    html_text2() |> \n    str_replace_all(\"\\n\", \"\") |> \n    str_replace_all(\" \", \"\")\n  return(info)\n}\n## 集数\nget_ep <- function(html) {\n  html_ep <- html_elements(html, css = \"div.article > div.episode_list\")\n  remove_na <- \\(x) {x[x != \"\"]} \n  ep <- html_ep |> \n    html_text2() |> \n    str_split(\"集\", simplify = FALSE) |> \n    unlist() |> \n    remove_na() |> \n    as.numeric()\n  return(ep)\n}\n\n\nall_ep <- list(NA)\nlength(all_ep) <- length(url_all)\nall_info <- rep(NA, length(url_all))\nfor (i in seq(url_all)) {\n  html <- read_html_fanren(url = url_all[i]) \n  all_ep[[i]] =  get_ep(html)\n  all_info[i] =  get_info(html)\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncumulative_ep <- all_ep\nfor (i in 1:length(all_ep)) {\n  if (i == 1) {\n    cumulative_ep[[i]] = as.numeric(all_ep[[i]])\n  }else{\n    cumulative_ep[[i]] = as.numeric(all_ep[[i]]) + max(as.numeric(cumulative_ep[[i-1]]))\n  }\n}\ncumulative_ep_col <- sapply(cumulative_ep, \\(x) paste0(min(x), \"-\", max(x)))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nfanren <- tbl <- tribble(\n  ~系列, ~首播,\n\"第一季《凡人修仙传：风起天南》\", \"2020-07-25\",\n\"特别篇《凡人修仙传: 燕家堡之战》\", \"2021-01-31\",\n\"第二季《凡人修仙传：魔道争锋》\", \"2021-11-14\",\n\"第三季《凡人修仙传：再别天南》\", \"2022-04-24\",\n\"第四季《凡人修仙传：初入星海》\", \"2022-07-31\",\n\"第五季《凡人修仙传：星海飞驰》\", \"2023-07-30\",\n\"第六季《凡人修仙传：外海风云》\", \"2025-01-18\"\n)\nfanren$`剧集` <- cumulative_ep_col\nkableExtra::kable(fanren)\n```\n\n::: {.cell-output-display}\n\n\n|系列                             |首播       |剧集    |\n|:--------------------------------|:----------|:-------|\n|第一季《凡人修仙传：风起天南》   |2020-07-25 |1-17    |\n|特别篇《凡人修仙传: 燕家堡之战》 |2021-01-31 |18-21   |\n|第二季《凡人修仙传：魔道争锋》   |2021-11-14 |22-46   |\n|第三季《凡人修仙传：再别天南》   |2022-04-24 |47-60   |\n|第四季《凡人修仙传：初入星海》   |2022-07-31 |61-72   |\n|第五季《凡人修仙传：星海飞驰》   |2023-07-30 |73-126  |\n|第六季《凡人修仙传：外海风云》   |2025-01-18 |127-154 |\n\n\n:::\n:::\n\n\n## 豆瓣简介\n\n用Markdown来罗列简介\n\n::: macwindow\n\n\n\n```{.r .cell-code}\nn_ep_per_s <- sapply(cumulative_ep, length)\nshow_info_fanren <- glue::glue(\"### {fanren$系列}（共{n_ep_per_s}集）\\n\\n \n                               **首播：{fanren$首播}** \\n\\n\n                               {all_info}  \\n\\n\")\nshow_info_fanren\n```\n\n### 第一季《凡人修仙传：风起天南》（共17集）\n\n \n**首播：2020-07-25** \n\n\n凡人修仙传的剧情简介······　　平凡少年韩立出生贫困，为了让家人过上更好的生活，自愿前去七玄门参加入门考核，最终被墨大夫收入门下。　　墨大夫一开始对韩立悉心培养、传授医术，让韩立对他非常感激，但随着一同入门的弟子张铁失踪，韩立才发现了墨大夫的真面目。　　墨大夫试图夺舍韩立，最终却被韩立反杀。通过墨大夫的遗书韩立得知了一个全新世界：修仙界的存在。　　在帮助七玄门抵御外敌之后，韩立离开了七玄门，前去墨大夫的家中寻找暖阳宝玉解毒，并帮助墨家人打败了敌人。　　通过墨大夫之女墨彩环的口中得知太南小会地址，韩立为追寻修仙人的足迹决定前往太南小会，拜别家人后……  \n\n### 特别篇《凡人修仙传: 燕家堡之战》（共4集）\n\n \n**首播：2021-01-31** \n\n\n凡人修仙传：燕家堡之战的剧情简介······　　平凡少年韩立出生贫困，为了让家人过上更好的生活，自愿前去七玄门参加入门考核，最终被墨大夫收入门下。墨大夫一开始对韩立悉心培养、传授医术，让韩立对他非常感激，但随着一同入门的弟子张铁失踪，韩立才发现了墨大夫的真面目。墨大夫试图夺舍韩立，最终却被韩立反杀。通过墨大夫的遗书韩立得知了一个全新世界：修仙界的存在。在帮助七玄门抵御外敌之后，韩立离开了七玄门，前去墨大夫的家中寻找暖阳宝玉解毒，并帮助墨家人打败了敌人。通过墨大夫之女墨彩环的口中得知太南小会地址，韩立为追寻修仙人的足迹决定前往太南小会，拜别家人后，韩立来到太南谷，结识了一众修仙人士，正式展开了自己的修仙之旅。  \n\n### 第二季《凡人修仙传：魔道争锋》（共25集）\n\n \n**首播：2021-11-14** \n\n\n凡人修仙传：魔道争锋的剧情简介······　　国民级IP《凡人修仙传》动画年番来了！看机智的凡人小子韩立如何稳健发展、步步为营，战魔道、夺至宝、驰骋星海、快意恩仇，成为纵横三界的强者。他日仙界重相逢，一声道友尽沧桑，尽在《凡人》动画年番。  \n\n### 第三季《凡人修仙传：再别天南》（共14集）\n\n \n**首播：2022-04-24** \n\n\n凡人修仙传：再别天南的剧情简介······　　看机智的凡人小子韩立如何稳健发展、步步为营，战魔道、夺至宝、驰骋星海、快意恩仇，成为纵横三界的强者。他日仙界重相逢，一声道友尽沧桑。  \n\n### 第四季《凡人修仙传：初入星海》（共12集）\n\n \n**首播：2022-07-31** \n\n\n凡人修仙传：初入星海的剧情简介······　　看机智的凡人小子韩立如何稳健发展、步步为营，战魔道、夺至宝、驰骋星海、快意恩仇，成为纵横三界的强者。他日仙界重相逢，一声道友尽沧桑。  \n\n### 第五季《凡人修仙传：星海飞驰》（共54集）\n\n \n**首播：2023-07-30** \n\n\n凡人修仙传：星海飞驰篇的剧情简介······　　看机智的凡人小子韩立如何稳健发展、步步为营，战魔道、夺至宝、驰骋星海、快意恩仇，成为纵横三界的强者。他日仙界重相逢，一声道友尽沧桑。  \n\n### 第六季《凡人修仙传：外海风云》（共28集）\n\n \n**首播：2025-01-18** \n\n\n凡人修仙传：外海风云‎的剧情简介······　　看机智的凡人小子韩立如何稳健发展、步步为营，战魔道、夺至宝、驰骋星海、快意恩仇，成为纵横三界的强者。他日仙界重相逢，一声道友尽沧桑。  \n\n\n:::\n\n## Resource\n\n1.  My previous Bilibili Danmu extraction project ([Github](https://github.com/JihongZ/Danmu_Cloud_mobile/blob/master/bilibili_api.R))\n2.  Previous Blog: [Web Scraping Academia Institute's Grant Fundings using R](https://jihongzhang.org/posts/2022/2022-05-12-web-scrapping-grant-fundings-in-r/index.html)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}