{
  "hash": "4a28df442d508f2eb1ec7ac8eb0cf389",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"使用R网页抓取：凡人修仙传剧集\"\nauthor: \"学徒\"\ndate: \"2025-03-22\"\ndraft: false\ncategories: \n  - R\n  - rvest\nexecute: \n  warning: false\n  message: false\nformat: \n  html:\n    code-tools: false\n    code-fold: true\n---\n\n\n\n用[黑桐谷歌【最终幻想7重制版】视频攻略](https://www.bilibili.com/video/BV1iK411L7G5/?vd_source=84566f3ffd99685e26f9d41b7c8dff53)为例。在Inspect中找到视频选集的对应element---`div.title`。这还不够具体，\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rvest)\nlibrary(stringr)\n\n# 查看合集: 黑桐谷歌【最终幻想7重制版】视频攻略 \nurl = \"https://www.bilibili.com/video/BV1iK411L7G5\"\nhtml <- read_html(url);\nhtml_extract <- html_elements(html, css = \"div.simple-base-item > div.title > div.title-txt\")\nhtml_extract |> \n  html_text2() \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"流程攻略 第一章 壹号魔晄炉引爆作战\" \"流程攻略 第二章 第捌区的邂逅\"      \n [3] \"流程攻略 第三章 第七天堂\"           \"流程攻略 第四章 深夜追逐战\"        \n [5] \"流程攻略 第五章 迷宫之犬\"           \"流程攻略 第六章 贫民窟的太阳\"      \n [7] \"流程攻略 第七章 伍号魔晄炉的陷阱\"   \"流程攻略 第八章 重逢之花 上\"       \n [9] \"流程攻略 第八章 重逢之花 下\"        \"流程攻略 第九章 欲望之地 上\"       \n[11] \"流程攻略 第九章 欲望之地 中\"        \"流程攻略 第九章 欲望之地 下\"       \n[13] \"流程攻略 第十章 令人焦急的水路\"     \"流程攻略 第十一章 亡灵的恶作剧\"    \n[15] \"流程攻略 第十二章 雪崩的殊死战斗\"   \"流程攻略 第十三章 毁灭的世界\"      \n[17] \"流程攻略 第十四章 寻求希望 上\"      \"流程攻略 第十四章 寻求希望 下\"     \n[19] \"流程攻略 第十五章 落日之城\"         \"流程攻略 第十六章 潜入神罗大厦 上\" \n[21] \"早期实况P1\"                         \"早期实况P2\"                        \n[23] \"早期实况P3\"                         \"早期实况P4\"                        \n[25] \"早期实况P5\"                         \"早期实况P6\"                        \n[27] \"P7\"                                 \"P8\"                                \n[29] \"P9\"                                 \"P10\"                               \n[31] \"P11\"                                \"P12\"                               \n[33] \"P13\"                                \"P14\"                               \n[35] \"P15\"                                \"P16\"                               \n[37] \"P17\"                                \"P18\"                               \n[39] \"P19\"                                \"P20\"                               \n[41] \"P21\"                                \"P22\"                               \n[43] \"P23\"                                \"P24\"                               \n[45] \"P25\"                                \"P26\"                               \n[47] \"P27完\"                             \n```\n\n\n:::\n:::\n\n\n\n## 豆瓣剧集\n\n从豆瓣网抓取凡人修仙传的简介和每一季的集数。先找到第一到第六以及特别篇的豆瓣网址。\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 第一季《凡人修仙传：风起天南》\ndouban_url <- \"https://movie.douban.com/subject/\"\nurl_s1 = \"34925294/\" # 第一季《凡人修仙传：风起天南》\nurl_s1_2 = \"35259437/\" # 特别篇《燕家堡之战》          \nurl_s2 = \"35640039/\" # 第二季《凡人修仙传：魔道争锋》\nurl_s3 = \"35882624/\" # 第三季《凡人修仙传：再别天南》\nurl_s4 = \"36017435/\" # 第四季《凡人修仙传：初入星海》\nurl_s5 = \"36139980/\" # 第五季《凡人修仙传：星海飞驰》\nurl_s6 = \"36923479/\" # 第六季《凡人修仙传：外海风云》\nurl_all <- c(url_s1, url_s1_2, url_s2, url_s3, url_s4, url_s5, url_s6)\n\nread_html_fanren <- function(douban_url = \"https://movie.douban.com/subject/\",\n                             url) {\n  html <- read_html(paste0(douban_url, url))\n  return(html)\n}\n\n\n## 简介\nget_info <- function(html) {\n  html_info <- html_elements(html, css = \"div.article > div.related-info\")\n  info <- html_info |>  \n    html_text2() |> \n    str_replace_all(\"\\n\", \"\") |> \n    str_replace_all(\" \", \"\")\n  return(info)\n}\n## 集数\nget_ep <- function(html) {\n  html_ep <- html_elements(html, css = \"div.article > div.episode_list\")\n  remove_na <- \\(x) {x[x != \"\"]} \n  ep <- html_ep |> \n    html_text2() |> \n    str_split(\"集\", simplify = FALSE) |> \n    unlist() |> \n    remove_na() |> \n    as.numeric()\n  return(ep)\n}\n\n\nall_ep <- list(NA)\nlength(all_ep) <- length(url_all)\nall_info <- rep(NA, length(url_all))\nfor (i in seq(url_all)) {\n  html <- read_html_fanren(url = url_all[i]) \n  all_ep[[i]] =  get_ep(html)\n  all_info[i] =  get_info(html)\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"分季剧集整理\"}\ncumulative_ep <- all_ep\nfor (i in 1:length(all_ep)) {\n  if (i == 1) {\n    cumulative_ep[[i]] = as.numeric(all_ep[[i]])\n  }else{\n    cumulative_ep[[i]] = as.numeric(all_ep[[i]]) + max(as.numeric(cumulative_ep[[i-1]]))\n  }\n}\ncumulative_ep_col <- sapply(cumulative_ep, \\(x) paste0(min(x), \"-\", max(x)))\n\n## 每一季的起始和结束集数\nseason_start_end_ep <- data.frame(\n  season = seq_along(cumulative_ep),\n  ep_start = sapply(cumulative_ep, min),\n  ep_end = sapply(cumulative_ep, max)\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"分季剧集汇总\"}\nlibrary(tidyverse)\nfanren <- tbl <- tribble(\n  ~系列, ~首播,\n\"第一季《凡人修仙传：风起天南》\", \"2020-07-25\",\n\"特别篇《凡人修仙传: 燕家堡之战》\", \"2021-01-31\",\n\"第二季《凡人修仙传：魔道争锋》\", \"2021-11-14\",\n\"第三季《凡人修仙传：再别天南》\", \"2022-04-24\",\n\"第四季《凡人修仙传：初入星海》\", \"2022-07-31\",\n\"第五季《凡人修仙传：星海飞驰》\", \"2023-07-30\",\n\"第六季《凡人修仙传：外海风云》\", \"2025-01-18\"\n)\nfanren$`剧集` <- cumulative_ep_col\nkableExtra::kable(fanren)\n```\n\n::: {.cell-output-display}\n\n\n|系列                             |首播       |剧集    |\n|:--------------------------------|:----------|:-------|\n|第一季《凡人修仙传：风起天南》   |2020-07-25 |1-17    |\n|特别篇《凡人修仙传: 燕家堡之战》 |2021-01-31 |18-21   |\n|第二季《凡人修仙传：魔道争锋》   |2021-11-14 |22-46   |\n|第三季《凡人修仙传：再别天南》   |2022-04-24 |47-60   |\n|第四季《凡人修仙传：初入星海》   |2022-07-31 |61-72   |\n|第五季《凡人修仙传：星海飞驰》   |2023-07-30 |73-126  |\n|第六季《凡人修仙传：外海风云》   |2025-01-18 |127-154 |\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"白马侯子的解析视频标题抓取\"}\nlibrary(tidyverse)\n## 白马侯子的解析视频\nbaima_html <- read_html(\"https://www.bilibili.com/video/BV1jPX4Y6Euz\")\nbaima_titles <- baima_extract <- html_elements(baima_html, css = \"div.simple-base-item > div.title > div.title-txt\") |> \n  html_text2() \n\nep_num <- as.numeric(str_replace(str_extract(baima_titles, \"\\\\d+集\"), \"集\", \"\"))\nep_num <- ifelse(ep_num > 200, NA, ep_num)\nep_num_title <- ifelse(is.na(ep_num), \"综合点评\", paste0(\"第\", ep_num, \"集简介\"))\n\nbaima_ep_info <- baima_titles |> \n  str_replace_all(\"解析|解读|逐帧\", \"\") |> \n  str_replace_all(\"《\", \"\") |> \n  str_replace_all(\"》\", \"\") |> \n  str_replace_all(\"【\", \"\") |> \n  str_replace_all(\"】\", \"\") |> \n  str_replace_all(\"凡人修仙传\", \"\") |> \n  str_replace_all(\"第\", \"\") |> \n  str_replace_all(\"\\\\d+集\", \"\") |> \n  str_replace_all(\"\\\\d+-\", \"\") |> \n  str_replace_all(\"\\\\d+/\", \"\") |> \n  str_replace_all(\"（）\", \"\") |> \n  str_replace_all(\"\\\\+\", \"\") |> \n  str_replace_all(\"逻辑梳理\", \"\") |> \n  str_replace_all(\" \", \"\")\n\n\nseason_num <- sapply(ep_num, \\(x) \n       ifelse(is.na(x), x,\n       season_start_end_ep$season[(x >= season_start_end_ep$ep_start) & (x <= season_start_end_ep$ep_end)]))\n\n## 将白马侯子的视频简介按季整理成数据框\nseason_info_all <- data.frame(\n  ep_num,\n  ep_info = paste0(ep_num_title, \"：\", baima_ep_info),\n  season_num = factor(season_num, levels = 1:length(url_all) )\n) |>\n  complete(season_num) |> #填充空白的季\n  dplyr::filter(!is.na(season_num)) |> \n  arrange(ep_num) |> \n  group_by( season_num) |>\n  summarise(ep_info_all = paste0(\"-  \", ep_info, collapse = \"\\n\\n\")) |> \n  mutate(ep_info_all = ifelse(ep_info_all == \"-  NA\", \"\", ep_info_all) )\n```\n:::\n\n\n\n## 豆瓣简介\n\n用Markdown来罗列简介\n\n::: macwindow\n\n\n\n```{.r .cell-code}\nn_ep_per_s <- sapply(cumulative_ep, length)\nshow_info_fanren <- glue::glue(\"### {fanren$系列}（共{n_ep_per_s}集）\\n\\n \n                               **首播：{fanren$`首播`}** \\n\\n\n                               **剧集：{fanren$`剧集`}** \\n\\n\n                               {all_info}  \\n\\n\n                               {season_info_all$ep_info_all} \\n\\n\"\n                               )\n\nshow_info_fanren\n```\n\n### 第一季《凡人修仙传：风起天南》（共17集）\n\n \n**首播：2020-07-25** \n\n\n**剧集：1-17** \n\n\n凡人修仙传的剧情简介······　　平凡少年韩立出生贫困，为了让家人过上更好的生活，自愿前去七玄门参加入门考核，最终被墨大夫收入门下。　　墨大夫一开始对韩立悉心培养、传授医术，让韩立对他非常感激，但随着一同入门的弟子张铁失踪，韩立才发现了墨大夫的真面目。　　墨大夫试图夺舍韩立，最终却被韩立反杀。通过墨大夫的遗书韩立得知了一个全新世界：修仙界的存在。　　在帮助七玄门抵御外敌之后，韩立离开了七玄门，前去墨大夫的家中寻找暖阳宝玉解毒，并帮助墨家人打败了敌人。　　通过墨大夫之女墨彩环的口中得知太南小会地址，韩立为追寻修仙人的足迹决定前往太南小会，拜别家人后……  \n\n\n \n\n### 特别篇《凡人修仙传: 燕家堡之战》（共4集）\n\n \n**首播：2021-01-31** \n\n\n**剧集：18-21** \n\n\n凡人修仙传：燕家堡之战的剧情简介······　　平凡少年韩立出生贫困，为了让家人过上更好的生活，自愿前去七玄门参加入门考核，最终被墨大夫收入门下。墨大夫一开始对韩立悉心培养、传授医术，让韩立对他非常感激，但随着一同入门的弟子张铁失踪，韩立才发现了墨大夫的真面目。墨大夫试图夺舍韩立，最终却被韩立反杀。通过墨大夫的遗书韩立得知了一个全新世界：修仙界的存在。在帮助七玄门抵御外敌之后，韩立离开了七玄门，前去墨大夫的家中寻找暖阳宝玉解毒，并帮助墨家人打败了敌人。通过墨大夫之女墨彩环的口中得知太南小会地址，韩立为追寻修仙人的足迹决定前往太南小会，拜别家人后，韩立来到太南谷，结识了一众修仙人士，正式展开了自己的修仙之旅。  \n\n\n \n\n### 第二季《凡人修仙传：魔道争锋》（共25集）\n\n \n**首播：2021-11-14** \n\n\n**剧集：22-46** \n\n\n凡人修仙传：魔道争锋的剧情简介······　　国民级IP《凡人修仙传》动画年番来了！看机智的凡人小子韩立如何稳健发展、步步为营，战魔道、夺至宝、驰骋星海、快意恩仇，成为纵横三界的强者。他日仙界重相逢，一声道友尽沧桑，尽在《凡人》动画年番。  \n\n\n-  第26集简介：7000字的斗法逻辑还原最真实最残酷的修仙世界\n\n-  第26集简介：细致入微分析陈巧倩的内心世界这演技简直超越真人文戏\n\n-  第27集简介：有梗更有细节！忘语或为最强的隐藏大佬\n\n-  第28集简介：全新角度解构剧情！绝对让你念头通达！！\n\n-  第29集简介：论修仙界微妙的世故人情！看韩立师徒间的极限拉扯！\n\n-  第30集简介：显微镜级别！绝对让你念头通达！！\n\n-  第31集简介：节奏最完美的一集！！\n\n-  第32集简介：究竟是“水”还是短？绝对让你念头通达的！\n\n-  第33集简介：从墨彩环易容看仙凡差别！她是凡人，最体面的凡人！这改编简直神了！！\n\n-  第34集简介：为何真实？蒙山五友便可说明一切！动画原著还原真实的蒙山五友\n\n-  第35集简介：超燃的斗法归来绝对念头通达的视角\n\n-  第36集简介：卧槽！这才是真正的神仙打架！！\n\n-  第37集简介：播放破5亿的国产动画究竟能细到什么程度！！\n\n-  第38集简介：看心机boy韩立是如何把人忽悠瘸的！韩立转变韩老魔！！\n\n-  第39集简介：墨彩环退场陈巧倩上线七集连打即将开始！\n\n-  第41集简介：的斗法逻辑斗心逻辑绝对颠覆你对动画的认知！\n\n-  第42集简介：直接燃爆！最炫酷的斗法场面诞生！！\n\n-  第43集简介：决战前的危机又是细节爆炸的一集！\n\n-  第44集简介：真君子陨落！mei国胥皇真实嘴脸显露！-白马带你看懂剧情逻辑\n\n-  第44集简介：韩立成为了“韩老魔”？京城篇完结后总评为何会出问题详细分析\n\n-  第45集简介：白马带你看懂韩立的千层套路 \n\n### 第三季《凡人修仙传：再别天南》（共14集）\n\n \n**首播：2022-04-24** \n\n\n**剧集：47-60** \n\n\n凡人修仙传：再别天南的剧情简介······　　看机智的凡人小子韩立如何稳健发展、步步为营，战魔道、夺至宝、驰骋星海、快意恩仇，成为纵横三界的强者。他日仙界重相逢，一声道友尽沧桑。  \n\n\n-  第47集简介：看懂韩立与张铁的顶级博弈！张铁的城府超乎想象\n\n-  第48集简介：凡人的斗法为什么精彩？逻辑清晰！\n\n-  第49集简介：真正顶级的挖坑与填坑能力！七派叛变的宗门身份大揭秘！\n\n-  第50集简介：目之所及皆为弃子！李化元或将就此陨落！\n\n-  第51集简介：最让人意难平的陈师姐！结合原著深入分析陈巧倩的改编优劣\n\n-  第52集简介：令狐老祖真的不在乎黄枫谷存亡吗？带你看懂令狐的千层套路\n\n-  第53集简介：人命贱如蝼蚁！韩立究竟是怎样被卖的！令狐老祖的弃子计划大揭秘\n\n-  第54集简介：神仙大战？与我无缘！溜了溜了\n\n-  第57集简介：关于的争议问题评点建议\n\n-  第58集简介：韩立换个活法李化元压根不想活评点\n\n-  第59集简介：韩立的套路辛如音的钟情南宫婉的蓄势待吸！ \n\n### 第四季《凡人修仙传：初入星海》（共12集）\n\n \n**首播：2022-07-31** \n\n\n**剧集：61-72** \n\n\n凡人修仙传：初入星海的剧情简介······　　看机智的凡人小子韩立如何稳健发展、步步为营，战魔道、夺至宝、驰骋星海、快意恩仇，成为纵横三界的强者。他日仙界重相逢，一声道友尽沧桑。  \n\n\n-  第61集简介：韩立反向突破练气瓶颈南宫婉的戏份远没结束OPED\n\n-  第62集简介：韩立跟“小姨子”洞内吃粥王蝉洞外啃手动画这次的糖甜吗\n\n-  第64集简介：错综复杂的乱星海形势韩立即将遭劫难\n\n-  第65集简介：久违的凡人味道终于回来了！动画\n\n-  第66集简介：心病难治绝望无医！墨彩环离世元瑶惊艳登场\n\n-  第69集简介：你可以永远相信凡人的斗法！\n\n-  第71集简介：雷鹏送翅紫灵源起！白马讲凡人\n\n-  第72集简介：年番完结！终极一战的斗法 \n\n### 第五季《凡人修仙传：星海飞驰》（共54集）\n\n \n**首播：2023-07-30** \n\n\n**剧集：73-126** \n\n\n凡人修仙传：星海飞驰篇的剧情简介······　　看机智的凡人小子韩立如何稳健发展、步步为营，战魔道、夺至宝、驰骋星海、快意恩仇，成为纵横三界的强者。他日仙界重相逢，一声道友尽沧桑。  \n\n\n-  第73集简介：韩立闭关归来！！细节白马\n\n-  第75集简介：国漫最稳男主诞生！细节\n\n-  第77集简介：王者归来！韩立结丹年番继续动画\n\n-  第78集简介：堪称艺术的语言博弈文戏巅峰！动画\n\n-  第79集简介：竟然还能这么改？全面揭秘紫灵的复仇计划！\n\n-  第82集简介：神仙打架！斗法细节与逻辑\n\n-  第87集简介：天南一剑修有剑了七十二炳！青竹蜂云剑成！\n\n-  第89集简介：在玄骨头上征服小师妹剧情\n\n-  第90集简介：凡人的斗法究竟有多精彩？一个视频带让你看明白！\n\n-  第91集简介：玄骨“动手”石碟仙子没被毁容结合小说看\n\n-  第92集简介：百岁如流富贵冷灰是修仙更是修险！剧情\n\n-  第93集简介：逼格拉满的玄骨究竟为何恐怖？细节原著对比\n\n-  第94集简介：玄骨VS韩立初次交锋谁输谁赢？细节\n\n-  第95集简介：0斗法却是最精彩的一集！结合小说科普动画\n\n-  第96集简介：金魁要灭杀的人是谁？猴中钟馗啼魂兽震撼登场！\n\n-  第98集简介：一剑灭杀三头鬼王！灭鬼之战细节\n\n-  第99集简介：闯到虚天殿的哪一关离开性价比最高？\n\n-  第101集简介：玄骨为何看戏也不救队友？细节带你了解不一样的千年老鬼-玄骨！\n\n-  第102集简介：惜命的韩立为什么不把蜘蛛交给极阴？细节带你了解复杂的人心博弈\n\n-  第104集简介：改编极度优秀的一集细节\n\n-  第106集简介：元瑶只会影响他套猴的速度！吾辈楷模之韩天尊\n\n-  第107集简介：韩立遭“长辈”填鸭式送宝韩跑跑原地过年！\n\n-  第108集简介：韩立卡bug得两件宝物“硬”闯极妙幻境！\n\n-  第109集简介：韩立修仙为何叫“凡人修仙”？极妙幻境见证凡心\n\n-  第111集简介：双修功法好韩立捡到宝！\n\n-  第113集简介：元婴修士大混战特效拉到最满的一集！银月初登场！\n\n-  第114集简介：补天出小白卒！混战源头竟然是营销号？\n\n-  第115集简介：元婴建模不太“婴”乌丑名副其实真小丑！\n\n-  第116集简介：大战虚天殿的最终BOSS-玄骨！狡诈近乎妖孽\n\n-  第117集简介：一生如履薄冰！玄骨究竟是败给韩立还是败给命运？玄骨坚持下线不下岗\n\n-  第118集简介：年番最丰满的一集！元瑶出浴元婴过度盘逻辑\n\n-  第119集简介：逆星盟未打先赢恐怖的六道极圣！剧情\n\n-  第120集简介：一结丹修士温天仁出场！风希剧情或有重大改编剧情片头片尾\n\n-  第121集简介：烂完了！外部战事吃紧内部护法紧吃剧情\n\n-  第122集简介：风希养鱼计划通！三界一善妖开始发力！剧情\n\n-  第123集简介：闭关遇化形雷劫韩立躺枪继续开溜！\n\n-  第124集简介：韩立的终极应对之法-埋头闭关！凡人年番最后一集！ \n\n### 第六季《凡人修仙传：外海风云》（共28集）\n\n \n**首播：2025-01-18** \n\n\n**剧集：127-154** \n\n\n凡人修仙传：外海风云‎的剧情简介······　　看机智的凡人小子韩立如何稳健发展、步步为营，战魔道、夺至宝、驰骋星海、快意恩仇，成为纵横三界的强者。他日仙界重相逢，一声道友尽沧桑。  \n\n\n-  第127集简介：一见韩立误终身！与风大善人的世纪性会面细节\n\n-  第129集简介：天南一剑修将成型公孙杏改编引争议\n\n-  第131集简介：跨越120多集的伏笔！小绿瓶直接翻盘！\n\n-  第132集简介：风雷翅到手！新年番最爽的一集凡人修仙者\n\n-  第133集简介：妙音门究竟有何秘密？六道的谋划和紫灵仙子的飞升之谜！\n\n-  第134集简介：妙鹤不妙风希悲伤到让人心疼\n\n-  第135集简介：最强结丹一战将开启！百变魔女拿捏我与你！ \n\n\n:::\n\n## Resource\n\n1.  My previous Bilibili Danmu extraction project ([Github](https://github.com/JihongZ/Danmu_Cloud_mobile/blob/master/bilibili_api.R))\n2.  Previous Blog: [Web Scraping Academia Institute's Grant Fundings using R](https://jihongzhang.org/posts/2022/2022-05-12-web-scrapping-grant-fundings-in-r/index.html)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}