{
  "hash": "aa7101d3e730d28ae86d530ba6f7973b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Lecture 13: Mixed ANCOVA\"\nsubtitle: \"Experimental Design in Education\"\ndate: \"2025-04-28\"\ndate-modified: \"2025-04-28\"\nexecute:\n  eval: true\n  echo: true\n  warning: false\n  message: false\nwebr:\n  editor-font-scale: 1.2\nformat:\n  html:\n    toc-expand: 3\n    code-tools: false\n    code-line-numbers: false\n    code-fold: true\n    code-summary: \"Click to see R code\"\n    number-sections: true\n    fig.width: 10\n    fig-align: center\n    message: false\n    grid:\n      sidebar-width: 350px\n  uark-revealjs:\n    chalkboard: true\n    embed-resources: false\n    code-fold: false\n    number-sections: true\n    number-depth: 1\n    footer: \"ESRM 64103\"\n    slide-number: c/t\n    tbl-colwidths: auto\n    scrollable: true\n    output-file: slides-index.html\n    mermaid:\n      theme: forest\n---\n\n\n\n\n::: objectives\n## Overview of Lecture 13 {.unnumbered}\n\n1.  What is Mixed ANCOVA?\n2.  Why use Mixed ANCOVA?\n3.  How to use Mixed ANCOVA (assumptions, hypothesis setup)?\n4.  Potential issues of using Mixed ANCOVA.\n:::\n\n# Introduction\n\n## Recall: Repeated Measurement ANOVA\n\n::::: columns\n::: column\n#### 1-way ANOVA\n\n| Student | No Tutor | Once per Week | Daily |\n|---------|----------|---------------|-------|\n| Sally   |          |               |       |\n| Bob     |          |               |       |\n| Martes  |          |               |       |\n| ...     | ...      | ...           | ...   |\n| Omar    |          |               |       |\n\n-   With factorial ANOVA, we put each student in only one condition.\n-   Then, we look at their grades at the end of the intervention.\n:::\n\n::: column\n#### RM ANOVA\n\n| Student | No Tutor | Once per Week | Daily |\n|---------|----------|---------------|-------|\n| Sally   |          |               |       |\n| Bob     |          |               |       |\n| Martes  | ...      | ...           | ...   |\n| ...     | ...      | ...           | ...   |\n| Omar    |          |               |       |\n\n-   With repeated measures ANOVA, we put each student in each of the three conditions.\n-   Then, we look at their grades at the end of each intervention.\n-   OR, we can think of following students over time: baseline, 6-weeks into the intervention, follow-up.\n:::\n:::::\n\n## Sphericity check of RM ANOVA\n\n-   Check Sphericity!\n\n![](images/clipboard-2225424405.png)\n\n## RM ANOVA Table\n\n-   Repeated Measure ANOVA\n\n![](images/clipboard-7928177.png)\n\n## Mixed ANOVA\n\n➤ **Recall: Example #1 of repeated measure ANOVA** - \\[Example #1\\] - **Researchers are interested in the effect of drug on blood concentration of histamine at 0, 1, 3, and 5 minutes after injection of the drug.** - DV: blood concentration of histamine - Within-subject factor: time (4 levels: 0, 1, 3, and 5 minutes)\n\n-   Six dogs, four time points\n\n-   **Now we want to know if the changes in histamine concentration over time are impacted by drug type**\n\n    -   Adding a between-subjects variable\n    -   Dogs in each group receive either carprofen (Novox or Rimadyl), deracoxib (Deramaxx), firocoxib (Previcox), and meloxicam (Metacam) as a treatment for arthritis.\n    -   **Between-subject factor: drug (4 levels)**\n\n-   We are interested primarily in the **interaction of drug and time**. ➔ **\"Mixed\" ANOVA!**\n\n# Example of Mixed ANOVA\n\n## Data overview\n\n-   First, let’s check if the two measures change over time\n    -   → Unconditional because no between-subjects factor\n    -   Significant impact of measure; and significant impact of time.\n    -   → there are significant differences in two outcomes and three time points.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create the data frame\ndf <- data.frame(\n  dog = 1:12,\n  time1 = c(10, 12, 13, 12, 11, 10, 10, 12, 13, 20, 21, 21),\n  time2 = c(16, 19, 20, 18, 20, 22, 22, 23, 22, 30, 31, 32),\n  time3 = c(25, 27, 28, 25, 26, 27, 31, 34, 33, 24, 25, 25),\n  time4 = c(26, 25, 28, 15, 18, 19, 11, 14, 13, 21, 24, 23),\n  drug = c(\"A\", \"A\", \"A\", \"B\", \"B\", \"B\", \"C\", \"C\", \"C\", \"D\", \"D\", \"D\")\n)\n\n# View the data frame\ndf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   dog time1 time2 time3 time4 drug\n1    1    10    16    25    26    A\n2    2    12    19    27    25    A\n3    3    13    20    28    28    A\n4    4    12    18    25    15    B\n5    5    11    20    26    18    B\n6    6    10    22    27    19    B\n7    7    10    22    31    11    C\n8    8    12    23    34    14    C\n9    9    13    22    33    13    C\n10  10    20    30    24    21    D\n11  11    21    31    25    24    D\n12  12    21    32    25    23    D\n```\n\n\n:::\n:::\n\n\n\n\n-   We know there is a **significant interaction** between time and drug\n\n    -   We can examine drug differences at each time point!\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\ndf |> \n  pivot_longer(starts_with(\"time\"), names_to = \"Time\", values_to = \"Value\") |> \n  mutate(Time = factor(Time, levels = paste0(\"time\", 1:4))) |> \n  ggplot(aes(x = Time, y = Value, color = drug, group = dog)) +\n  geom_path() +\n  geom_point() +\n  theme_classic()\n```\n\n::: {.cell-output-display}\n![](ESRM64103_Lecture13_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\n\nBelow is a full formal, academic-style write-up and corresponding **R code** for conducting a **mixed ANOVA** on the dataset you provided:\n\n---\n\n### Study Setup\n\n**Outcome Variable:**  \n- Dog performance scores at four different times: `time1`, `time2`, `time3`, and `time4`.\n\n**Independent Variables (IVs):**  \n- **Within-Subjects IV:** *Time* (four repeated measures: time1, time2, time3, time4)  \n- **Between-Subjects IV:** *Drug* (four levels: A, B, C, D)\n\n**Research Question:**  \n- **Main Effects:**  \n  - Does *time* influence the dog's performance?  \n  - Does the *drug type* influence the dog's performance?\n- **Interaction Effect:**  \n  - Does the effect of *time* on performance differ depending on *drug type*?\n\n---\n\n### R Code: Data Preparation and Mixed ANOVA\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load necessary libraries\nlibrary(tidyverse)\nlibrary(ez)\n\n# Reshape the data from wide to long format\ndf_long <- df %>%\n  pivot_longer(\n    cols = time1:time4,\n    names_to = \"time\",\n    values_to = \"performance\"\n  )\n\n# Ensure factors are properly coded\ndf_long$dog <- factor(df_long$dog)\ndf_long$time <- factor(df_long$time, levels = c(\"time1\", \"time2\", \"time3\", \"time4\"))\ndf_long$drug <- factor(df_long$drug)\n\n# Perform the mixed ANOVA\nanova_result <- ezANOVA(\n  data = df_long,\n  dv = performance,\n  wid = dog,\n  within = time,\n  between = drug,\n  type = 3,\n  detailed = TRUE\n)\n\n# Print ANOVA results\nprint(anova_result)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$ANOVA\n       Effect DFn DFd        SSn      SSd          F            p p<.05\n1 (Intercept)   1   8 21126.0208 43.33333 3900.18846 4.804763e-12     *\n2        drug   3   8   255.8958 43.33333   15.74744 1.017647e-03     *\n3        time   3  24  1200.5625 22.66667  423.72794 6.547316e-21     *\n4   drug:time   9  24   658.5208 22.66667   77.47304 1.538964e-15     *\n        ges\n1 0.9968856\n2 0.7949647\n3 0.9478905\n4 0.9089053\n\n$`Mauchly's Test for Sphericity`\n     Effect         W          p p<.05\n3      time 0.1921751 0.05196908      \n4 drug:time 0.1921751 0.05196908      \n\n$`Sphericity Corrections`\n     Effect       GGe        p[GG] p[GG]<.05       HFe        p[HF] p[HF]<.05\n3      time 0.6306601 6.734691e-14         * 0.8201143 1.687143e-17         *\n4 drug:time 0.6306601 2.018604e-10         * 0.8201143 4.729484e-13         *\n```\n\n\n:::\n:::\n\n\n\n\n---\n\n### Assumption Checking\n\n#### Sphericity (for within-subjects factor Time)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Mauchly’s Test for Sphericity is included in ezANOVA output\nanova_result$`Mauchly's Test for Sphericity`\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     Effect         W          p p<.05\n3      time 0.1921751 0.05196908      \n4 drug:time 0.1921751 0.05196908      \n```\n\n\n:::\n:::\n\n\n\n- If **p < .05**, sphericity is violated, and corrections (Greenhouse-Geisser or Huynh-Feldt) must be applied.\n\n---\n\n### Results\n\nSuppose the output from `ezANOVA` indicates the following hypothetical results (you would replace with actual output):\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanova_result$ANOVA\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       Effect DFn DFd        SSn      SSd          F            p p<.05\n1 (Intercept)   1   8 21126.0208 43.33333 3900.18846 4.804763e-12     *\n2        drug   3   8   255.8958 43.33333   15.74744 1.017647e-03     *\n3        time   3  24  1200.5625 22.66667  423.72794 6.547316e-21     *\n4   drug:time   9  24   658.5208 22.66667   77.47304 1.538964e-15     *\n        ges\n1 0.9968856\n2 0.7949647\n3 0.9478905\n4 0.9089053\n```\n\n\n:::\n:::\n\n\n\n\n---\n\n### Interpretation\n\n- **Main Effect of Time:**  \n  There is a significant effect of time on dog performance, \\( F(3, 24) = 423.72, p < .001, \\eta_p^2 = 0.94 \\). Dogs' scores changed significantly across the four time points.\n\n- **Main Effect of Drug:**  \n  There is a significant main effect of drug, \\( F(3, 8) = 15.74, p < .001, \\eta_p^2 = 0.79 \\). Dogs receiving different drug treatments showed different overall levels of performance.\n\n- **Interaction between Time and Drug:**  \n  A significant interaction between time and drug was found, \\( F(9, 24) = 77.47, p < .001, \\eta_p^2 = 0.90 \\), suggesting that the pattern of change over time differed depending on the drug administered.\n\n---\n\n### Post-Hoc and Follow-Up Analyses\n\n- Given significant interaction, post-hoc comparisons would be necessary to explore:\n\n  - Which time points differ within each drug.\n  - How the drugs differ at each time point.\n\nThis can be done using pairwise comparisons with Bonferroni correction.\n\nExample in R:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Post-hoc analysis\nlibrary(emmeans)\n\nmodel2 <- aov(performance ~ drug * time + Error(dog/time), data = df_long)\nemmeans(model2, pairwise ~ drug | time, adjust = \"bonferroni\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$emmeans\ntime = time1:\n drug emmean    SE df lower.CL upper.CL\n A      11.7 0.829 17     9.92     13.4\n B      11.0 0.829 17     9.25     12.7\n C      11.7 0.829 17     9.92     13.4\n D      20.7 0.829 17    18.92     22.4\n\ntime = time2:\n drug emmean    SE df lower.CL upper.CL\n A      18.3 0.829 17    16.58     20.1\n B      20.0 0.829 17    18.25     21.7\n C      22.3 0.829 17    20.58     24.1\n D      31.0 0.829 17    29.25     32.7\n\ntime = time3:\n drug emmean    SE df lower.CL upper.CL\n A      26.7 0.829 17    24.92     28.4\n B      26.0 0.829 17    24.25     27.7\n C      32.7 0.829 17    30.92     34.4\n D      24.7 0.829 17    22.92     26.4\n\ntime = time4:\n drug emmean    SE df lower.CL upper.CL\n A      26.3 0.829 17    24.58     28.1\n B      17.3 0.829 17    15.58     19.1\n C      12.7 0.829 17    10.92     14.4\n D      22.7 0.829 17    20.92     24.4\n\nWarning: EMMs are biased unless design is perfectly balanced \nConfidence level used: 0.95 \n\n$contrasts\ntime = time1:\n contrast estimate   SE df t.ratio p.value\n A - B       0.667 1.17 17   0.569  1.0000\n A - C       0.000 1.17 17   0.000  1.0000\n A - D      -9.000 1.17 17  -7.675  <.0001\n B - C      -0.667 1.17 17  -0.569  1.0000\n B - D      -9.667 1.17 17  -8.244  <.0001\n C - D      -9.000 1.17 17  -7.675  <.0001\n\ntime = time2:\n contrast estimate   SE df t.ratio p.value\n A - B      -1.667 1.17 17  -1.421  1.0000\n A - C      -4.000 1.17 17  -3.411  0.0199\n A - D     -12.667 1.17 17 -10.802  <.0001\n B - C      -2.333 1.17 17  -1.990  0.3776\n B - D     -11.000 1.17 17  -9.381  <.0001\n C - D      -8.667 1.17 17  -7.391  <.0001\n\ntime = time3:\n contrast estimate   SE df t.ratio p.value\n A - B       0.667 1.17 17   0.569  1.0000\n A - C      -6.000 1.17 17  -5.117  0.0005\n A - D       2.000 1.17 17   1.706  0.6377\n B - C      -6.667 1.17 17  -5.685  0.0002\n B - D       1.333 1.17 17   1.137  1.0000\n C - D       8.000 1.17 17   6.822  <.0001\n\ntime = time4:\n contrast estimate   SE df t.ratio p.value\n A - B       9.000 1.17 17   7.675  <.0001\n A - C      13.667 1.17 17  11.655  <.0001\n A - D       3.667 1.17 17   3.127  0.0368\n B - C       4.667 1.17 17   3.980  0.0058\n B - D      -5.333 1.17 17  -4.548  0.0017\n C - D     -10.000 1.17 17  -8.528  <.0001\n\nP value adjustment: bonferroni method for 6 tests \n```\n\n\n:::\n\n```{.r .cell-code}\nemmeans(model2, pairwise ~ time | drug, adjust = \"bonferroni\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$emmeans\ndrug = A:\n time  emmean    SE df lower.CL upper.CL\n time1   11.7 0.829 17     9.92     13.4\n time2   18.3 0.829 17    16.58     20.1\n time3   26.7 0.829 17    24.92     28.4\n time4   26.3 0.829 17    24.58     28.1\n\ndrug = B:\n time  emmean    SE df lower.CL upper.CL\n time1   11.0 0.829 17     9.25     12.7\n time2   20.0 0.829 17    18.25     21.7\n time3   26.0 0.829 17    24.25     27.7\n time4   17.3 0.829 17    15.58     19.1\n\ndrug = C:\n time  emmean    SE df lower.CL upper.CL\n time1   11.7 0.829 17     9.92     13.4\n time2   22.3 0.829 17    20.58     24.1\n time3   32.7 0.829 17    30.92     34.4\n time4   12.7 0.829 17    10.92     14.4\n\ndrug = D:\n time  emmean    SE df lower.CL upper.CL\n time1   20.7 0.829 17    18.92     22.4\n time2   31.0 0.829 17    29.25     32.7\n time3   24.7 0.829 17    22.92     26.4\n time4   22.7 0.829 17    20.92     24.4\n\nWarning: EMMs are biased unless design is perfectly balanced \nConfidence level used: 0.95 \n\n$contrasts\ndrug = A:\n contrast      estimate    SE df t.ratio p.value\n time1 - time2   -6.667 0.793 24  -8.402  <.0001\n time1 - time3  -15.000 0.793 24 -18.904  <.0001\n time1 - time4  -14.667 0.793 24 -18.484  <.0001\n time2 - time3   -8.333 0.793 24 -10.502  <.0001\n time2 - time4   -8.000 0.793 24 -10.082  <.0001\n time3 - time4    0.333 0.793 24   0.420  1.0000\n\ndrug = B:\n contrast      estimate    SE df t.ratio p.value\n time1 - time2   -9.000 0.793 24 -11.342  <.0001\n time1 - time3  -15.000 0.793 24 -18.904  <.0001\n time1 - time4   -6.333 0.793 24  -7.982  <.0001\n time2 - time3   -6.000 0.793 24  -7.562  <.0001\n time2 - time4    2.667 0.793 24   3.361  0.0156\n time3 - time4    8.667 0.793 24  10.922  <.0001\n\ndrug = C:\n contrast      estimate    SE df t.ratio p.value\n time1 - time2  -10.667 0.793 24 -13.443  <.0001\n time1 - time3  -21.000 0.793 24 -26.465  <.0001\n time1 - time4   -1.000 0.793 24  -1.260  1.0000\n time2 - time3  -10.333 0.793 24 -13.023  <.0001\n time2 - time4    9.667 0.793 24  12.182  <.0001\n time3 - time4   20.000 0.793 24  25.205  <.0001\n\ndrug = D:\n contrast      estimate    SE df t.ratio p.value\n time1 - time2  -10.333 0.793 24 -13.023  <.0001\n time1 - time3   -4.000 0.793 24  -5.041  0.0002\n time1 - time4   -2.000 0.793 24  -2.521  0.1127\n time2 - time3    6.333 0.793 24   7.982  <.0001\n time2 - time4    8.333 0.793 24  10.502  <.0001\n time3 - time4    2.000 0.793 24   2.521  0.1127\n\nP value adjustment: bonferroni method for 6 tests \n```\n\n\n:::\n:::\n\n\n\n\n---\n\n### Visualization of Interaction\n\nTo better understand the interaction effect, an interaction plot is highly recommended:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Interaction Plot\nlibrary(ggplot2)\n\nggplot(df_long, aes(x = time, y = performance, group = drug, color = drug)) +\n  stat_summary(fun = mean, geom = \"line\") +\n  stat_summary(fun = mean, geom = \"point\") +\n  labs(\n    title = \"Dog Performance Across Time by Drug Type\",\n    x = \"Time\",\n    y = \"Mean Performance\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](ESRM64103_Lecture13_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n### Summary\n\n| Aspect                 | Summary |\n|-------------------------|---------|\n| Outcome                 | Dog performance scores at four time points |\n| Within-Subjects IV      | Time (4 levels: time1 to time4) |\n| Between-Subjects IV     | Drug (4 levels: A, B, C, D) |\n| Main Effects            | Significant for both Time and Drug |\n| Interaction Effect      | Significant Time × Drug Interaction |\n| Assumptions             | Normality and Sphericity were assessed |\n| Post-Hoc Analysis       | Recommended for interpreting interaction effects |\n| Visualization           | Interaction plot recommended |\n\n\n# Issues of Mixed ANOVA\n\n## Potential probelms to be considered\n1.  **Missing Data on the Outcome**\n\n-   One of the biggest problems with traditional repeated measures ANOVA is missing data on the response variable.\n\n-   The problem is that repeated measures ANOVA treats each measurement as a separate variable.\n\n-   RMANOVA uses **listwise deletion**: if one measurement is missing, the entire case gets dropped.\n\n2.  **Unbalanced number of repeats across individuals**\n\n-   A related problem is imbalance in the number of repeated responses from each individual.\n\n-   This is common in observed data, where the number of repeats is uncontrollable.\\\n    You measure a response each time some occurrence happens.\n\n    -   Ex: Students using the tutoring lab. Some students come in once/week, others daily, some others come multiple times/day.\n    -   We measure their satisfaction at each lab session.\n    -   Problem: I have 10 measurements for some people, 2 for other people, etc.\n\n-   This causes two problems:\n\n    -   Different number of response variables for each individual. If some have missing data in the last few responses, they’ll get dropped. *(That dropping/deletion problem again! Ugh!)*\n    -   ANOVA will compare the responses to each other, assuming that each one represents a different condition (time point).\\\n        There is no way to turn off that comparison.\n\n-   In clinical trials, even though there may be a planned number of repeated measurements, participants don’t always come back:\n\n    -   They may not be seeing results and give up\n    -   They may pass away or be too sick to return\n    -   Participation may be too burdensome\n\n➤ **Survival analysis** is one approach to handling this type of **censored** data.\n\n3.  **When time is continuous**\n\n-   In some studies, the amount of time that has passed between repeated measurements is important.\n    -   ➤ In other words, you want to treat the within-subjects effect of time as a continuous, quantitative variable.\n    -   ➤ Ex: After each mile someone runs in a half-marathon, you take their pulse.\n    -   ➤ There will be 14-time measurements (including baseline).\n    -   ➤ But not everyone runs the miles at the same pace\n        -    Some will take 8 minutes, some 11, others 6.45 minutes, etc.\n        -    So, time between measurements matters, and is continuous.\n-   Repeated measures ANOVA can only account for categorical repeated measurements (e.g., after mile 1, mile 2, etc.).\n\n4.  **Time-varying covariates**\n\n-   In some studies, important predictor variables are measured on each repeat, right along with the response.\n    -    \\[ex.\\] Weight and wingspan may be measured as predictors of athlete endurance, but weight changes at each measurement\\\n        (it is not held constant throughout the experiment), whereas wingspan probably will not change over the course of the experiment.\n-   RMANOVA assumes our covariates are the same the entire time.\n\n5.  **Three (or more) level models**\n\n-   If the subjects themselves are not only measured multiple times, but also clustered into some other groups, you have a three-level model.\n\n    -   For example, you may have students measured over time, but students are also clustered within classrooms.\n    -   Patients measured over time are also clustered into medical centers.\n\n-   In all these cases, the repeated measures ANOVA can account for the repeats over time, but not the clustering.\n\n-   **Multilevel** or **hierarchical models** are other names for **mixed models**.\n\n    -   We offer a course in this: ESRM 6513. Hierarchical Linear Modeling. 3 Hours.\n    -   This course covers the theory and applications of hierarchical linear modeling (HLM), also known as multilevel modeling.\\\n        Both the conceptual and methodological issues for analyses of nested (clustered) data in using HLM will be reviewed,\\\n        including linear models, non-linear models, growth models, and some alternative designs.\\\n        Prerequisite: ESRM 6413 and ESRM 6423. *(Typically offered: Fall Even Years)*\n\n6.  **Repeated measures across people *and* items**\n\n-   There is a repeated measures design that occurs in specific experimental studies, common in linguistics and psychology.\n    -    Each subject is repeatedly measured across many trials.\n    -    Each trial contains one item, and there are multiple items for each condition.\n        -    Ex: Measure of reaction time of 50 participants to each of 20 high-frequency and 20 low-frequency words.\n    -    40 reaction times are repeated across each participant.\n    -    Each **word** also has 50 repeated measurements (one per participant), and those are also likely to be correlated.\\\n        Some words will elicit faster times than others, even within the same condition.\n-   Repeated measures ANOVA can only account for the repeat across **one type** of subject (trials or words, not both).\n\n7.  **Non-continuous outcomes**\n\n-   If your outcome is categorical or a count outcome, RMANOVA is not going to work.\n    -    Neither will a mixed model in this case.\n-   Luckily, there are other options: logistic regression and Poisson regression are two common approaches for yes/no and count outcomes, respectively.\n\n# Fin {.unnumbered}\n",
    "supporting": [
      "ESRM64103_Lecture13_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}