{
  "hash": "40f47fd95158589f3b9df733a5e92c72",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Lecture 10: Two-way ANOVA II\"\nsubtitle: \"Statistics in 2-way ANOVA\"\ndate: \"2025-03-07\"\ndate-modified: \"2025-10-29\"\nexecute: \n  eval: true\n  echo: true\n  warning: false\n  message: false\nwebr:\n  editor-font-scale: 1.2\nformat: \n  html:\n    toc-expand: 3\n    code-tools: true\n    code-line-numbers: false\n    code-fold: false\n    code-summary: \"Click to see R code\"\n    number-offset: 1\n    fig.width: 10\n    fig-align: center\n    message: false\n    grid:\n      sidebar-width: 350px\n  uark-revealjs:\n    chalkboard: true\n    embed-resources: false\n    code-fold: false\n    number-sections: true\n    number-depth: 1\n    footer: \"ESRM 64503\"\n    slide-number: c/t\n    tbl-colwidths: auto\n    scrollable: true\n    output-file: slides-index.html\n    mermaid:\n      theme: forest    \n---\n\n::: objectives\n## Overview of Lecture 09 & Lecture 10 {.unnumbered}\n\n1.  The rest of the semester\n2.  Advantage of Factorial Design\n3.  Two-way ANOVA:\n    -   Steps for conducting 2-way ANOVA\n    -   Hypothesis testing\n    -   Assumptions for 2-way ANOVA\n    -   Visualization\n    -   Difference between 1-way and 2-way ANOVA\n\n**Question**: How about the research scenario when more than two independent variables?\n:::\n\n# Hypothesis testing for two-way ANOVA\n\n## Hypothesis testing for two-way ANOVA (I)\n\n-   For two-way ANOVA, there are three distinct hypothesis tests :\n    -   Main effect of Factor A\n    -   Main effect of Factor B\n    -   Interaction of A and B\n\n::: callout-note\n### Definition\n\nF-test\n\n:   Three separate F-tests are conducted for each!\n\nMain effect\n\n:   Occurs when there is a difference between levels for one factor\n\nInteraction\n\n:   Occurs when the effect of one factor on the DV depends on the particular level of the other factor\n\n:   Said another way, when the difference in one factor is moderated by the other\n\n:   Said a third way, if the difference between levels of one factor is different, depending on the other factor\n:::\n\n## Hypothesis testing for two-way ANOVA (II)\n\n1.  Hypothesis test for the main effect with more than 2 levels\n\n    -   Mean differences among levels of one factor:\n\n        i)  Differences are tested for statistical significance\n        ii) Each factor is evaluated independently of the other factor(s) in the study\n\n    -   Factor A’s Main effect: “Controlling Factor B, are there differences in the DV across Factor A?”\n\n        $H_0$: $\\mu_{A_1}=\\mu_{A_2}=\\cdots=\\mu_{A_k}$\n\n        $H_1$: At least one $\\mu_{A_i}$ is different from the control group in Factor A\n\n    -   Factor B’s Main effect : “Controlling Factor A, are there differences in the DV across Factor B?”\n\n        $H_0$: $\\mu_{B_1}=\\mu_{B_2}=\\cdots=\\mu_{B_k}$\n\n        $H_1$: At least one $\\mu_{B_i}$ is different from the control group in Factor A\n\n    -   Interaction effect between A and B:\n\n        $H_0:\\mu_{A_1B_2}-\\mu_{A_1B_1}=\\mu_{A_2B_2}-\\mu_{A_2B_1}$\n\n        or $H_0: \\mu_{A_1B_1}-\\mu_{A_2B_1}=\\mu_{A_1B_2}-\\mu_{A_2B_2}$\n\n    ::: rmdnote\n    B's group differences do not change at different levels of A. OR A's group differences do not change at different levels of B.\n    :::\n\n## Hypothesis testing for two-way ANOVA (III)\n\n::: callout-important\n## Example\n\n**Background**: A researcher is investigating how study method (Factor A: Lecture vs. Interactive) and test format (Factor B: Multiple-Choice vs. Open-Ended) affect student performance (dependent variable: test scores). The study involves randomly assigning students to one of the two study methods and then assessing their performance on one of the two test formats.\n\n-   **Main Effect of Study Method (Factor A):**\n    -   [H0:]{style=\"color:royalblue; font-weight:bold\"} There is no difference in test scores between students who used the Lecture method and those who used the Interactive method.\n    -   [H1:]{style=\"color:tomato; font-weight:bold\"} There is a significant difference in test scores between the two study methods.\n-   **Main Effect of Test Format (Factor B):**\n    -   [H0:]{style=\"color:royalblue; font-weight:bold\"} There is no difference in test scores between students taking a Multiple-Choice test and those taking an Open-Ended test.\n    -   [H1:]{style=\"color:tomato; font-weight:bold\"} There is a significant difference in test scores between the two test formats.\n-   **Interaction Effect (Study Method × Test Format):**\n    -   [H0:]{style=\"color:royalblue; font-weight:bold\"} The effect of study method on test scores is the same regardless of test format.\n    -   [H1:]{style=\"color:tomato; font-weight:bold\"} The effect of study method on test scores depends on the test format (i.e., there is an interaction).\n:::\n\n## Hypothesis testing for two-way ANOVA (IV)\n\n::: callout-note\n### Example: Tutoring Program and Types of Schools on Grades\n\n-   **IVs**:\n    1.  Tutoring Programs: (1) No tutor; (2) Once a week; (3) Daily\n    2.  Types of schools: (1) Public (2) Private-secular (3) Private-religious\n-   **Research purpose**: to examine the effect of tutoring program (no tutor, once a week, and daily) AND types of school (e.g., public, private-secular, and private-religious) on the students’ grades\n-   **Question**: What are the null and alternative hypotheses for the main effects in the example?:\n    -   Factor A’s Main effect: “[Controlling school types, are there differences in the students’ grade across three tutoring programs?]{.mohu}”\n\n        $H_0$: $\\mu_{\\mathrm{no\\ tutor}}=\\mu_{\\mathrm{once\\ a\\ week}}=\\mu_{\\mathrm{daily}}$\n\n    -   Factor B’s Main effect : “[Controlling tutoring programs, are there differences in the students’ grades across three school types?]{.mohu}”\n\n        $H_0$: $\\mu_{\\mathrm{public}}=\\mu_{\\mathrm{private-religious}}=\\mu_{\\mathrm{private-secular}}$\n:::\n\n## Model 1: Two-Way ANOVA without interaction\n\n-   The main-effect only ANOVA with no interaction has a following statistical form:\n\n$$\n\\mathrm{Grade} = \\beta_0 + \\beta_1 \\mathrm{Toturing_{Once}} + \\beta_2 \\mathrm{Toturing_{Daily}} \\\\ + \\beta_3 \\mathrm{SchoolType_{PvtS}} + \\beta_4 \\mathrm{SchoolType_{PvtR}}\n$$\n\n```{webr-r}\n#| context: setup\nlibrary(tidyverse)\n# Set seed for reproducibility\nset.seed(123)\n\n# Define sample size per group\nn <- 30  \n\n# Define factor levels\ntutoring <- rep(c(\"No Tutor\", \"Once a Week\", \"Daily\"), each = 3 * n)\nschool <- rep(c(\"Public\", \"Private-Secular\", \"Private-Religious\"), times = n * 3)\n\n# Simulate student grades with assumed effects\ngrades <- c(\n  rnorm(n, mean = 75, sd = 5),  # No tutor, Public\n  rnorm(n, mean = 78, sd = 5),  # No tutor, Private-Secular\n  rnorm(n, mean = 76, sd = 5),  # No tutor, Private-Religious\n  rnorm(n, mean = 80, sd = 5),  # Once a week, Public\n  rnorm(n, mean = 83, sd = 5),  # Once a week, Private-Secular\n  rnorm(n, mean = 81, sd = 5),  # Once a week, Private-Religious\n  rnorm(n, mean = 85, sd = 5),  # Daily, Public\n  rnorm(n, mean = 88, sd = 5),  # Daily, Private-Secular\n  rnorm(n, mean = 86, sd = 5)   # Daily, Private-Religious\n)\n# Create a data_frame\ndata <- data.frame(\n  Tutoring = factor(tutoring, levels = c(\"No Tutor\", \"Once a Week\", \"Daily\")),\n  School = factor(school, levels = c(\"Public\", \"Private-Secular\", \"Private-Religious\")),\n  Grades = grades\n)\n```\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Data Generation\"}\nlibrary(tidyverse)\n# Set seed for reproducibility\nset.seed(123)\n\n# Define sample size per group\nn <- 30  \n\n# Define factor levels\ntutoring <- rep(c(\"No Tutor\", \"Once a Week\", \"Daily\"), each = 3 * n)\nschool <- rep(c(\"Public\", \"Private-Secular\", \"Private-Religious\"), times = n * 3)\n\n# Simulate student grades with assumed effects\ngrades <- c(\n  rnorm(n, mean = 75, sd = 5),  # No tutor, Public\n  rnorm(n, mean = 78, sd = 5),  # No tutor, Private-Secular\n  rnorm(n, mean = 76, sd = 5),  # No tutor, Private-Religious\n  rnorm(n, mean = 80, sd = 5),  # Once a week, Public\n  rnorm(n, mean = 83, sd = 5),  # Once a week, Private-Secular\n  rnorm(n, mean = 81, sd = 5),  # Once a week, Private-Religious\n  rnorm(n, mean = 85, sd = 5),  # Daily, Public\n  rnorm(n, mean = 88, sd = 5),  # Daily, Private-Secular\n  rnorm(n, mean = 86, sd = 5)   # Daily, Private-Religious\n)\n# Create a dataframe\ndata <- data.frame(\n  Tutoring = factor(tutoring, levels = c(\"No Tutor\", \"Once a Week\", \"Daily\")),\n  School = factor(school, levels = c(\"Public\", \"Private-Secular\", \"Private-Religious\")),\n  Grades = grades\n)\n```\n:::\n\n\n-   Main effect of Tutoring Programs\n    -   Collapsing across School Type\n    -   Ignoring the difference levels of School Type\n    -   Averaging DV regarding Tutoring Programs across the levels of School Type\n-   Main effect of School Type\n    -   Collapsing across Tutoring Program\n    -   Ignoring the difference levels of Tutoring Program\n    -   Averaging DV regarding School Type across the levels of Tutoring Programs\n\n------------------------------------------------------------------------\n\n::: panel-tabset\n### R Plot\n\nIgnoring the effect of school types, we can tell the main effect of tutor programs on students' grades (Daily tutoring has the highest grade, followed by *once a week*).\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# Compute mean and standard error for each tutoring group\ntutoring_summary <- data |>\n  group_by(Tutoring) |>\n  summarise(\n    Mean_Grade_byTutor = mean(Grades),\n    School = factor(c(\"Public\",\"Private-Secular\", \"Private-Religious\"), \n                    levels = c(\"Public\",\"Private-Secular\", \"Private-Religious\"))\n  ) \n\nschool_summary <- data |>\n  group_by(School) |>\n  summarise(\n    Mean_Grade_bySchool = mean(Grades)\n  ) \n\ntotal_summary <- tutoring_summary |> \n  left_join(school_summary, by = \"School\")\n\n# Plot main effect of tutoring\nggplot(total_summary, aes(x = School)) +\n  geom_point(aes(y = Mean_Grade_byTutor, color = Tutoring), size = 5) +\n  geom_hline(aes(yintercept = Mean_Grade_byTutor, color = Tutoring), linewidth = 1.3) +\n  scale_y_continuous(limits = c(70, 90), breaks = seq(70, 90, 5)) +\n  labs(title = \"Main Effect of Tutoring on Student Grades\",\n       x = \"School Types\",\n       y = \"Mean Grade\") +\n  theme_minimal() \n```\n\n::: {.cell-output-display}\n![](ESRM64103_Lecture10_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n### Summary Statistics\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndistinct(tutoring_summary[, c(\"Tutoring\", \"Mean_Grade_byTutor\")])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 2\n# Groups:   Tutoring [3]\n  Tutoring    Mean_Grade_byTutor\n  <fct>                    <dbl>\n1 No Tutor                  76.6\n2 Once a Week               81.1\n3 Daily                     86.3\n```\n\n\n:::\n:::\n\n\n### Interpretation of the Plot\n\n-   The x-axis represents three school types.\n-   The y-axis represents the mean student grades for the different tutoring programs: No Tutor, Once a Week, and Daily.\n-   If the main effect of tutoring is significant, we expect to see noticeable differences in mean grades across tutoring conditions.\n:::\n\n## You turn: Visualize Main Effect of School Type\n\n::: panel-tabset\n### Marginal Means for each tutoring / school type group\n\n```{webr-r}\nSchool_Levels <- c(\"Public\",\n                   \"Private-Secular\", \n                   \"Private-Religious\")\n\n## Calculate marginal means for tutoring\ntutoring_summary <- data |>\n  group_by(Tutoring) |>\n  summarise(\n    Mean_Grade_byTutor = mean(Grades),\n    School = factor(School_Levels, \n                    levels = School_Levels)\n  ) \n\n## Calculate marginal means for school types\nschool_summary <- data |>\n  group_by(School) |>\n  summarise(\n    Mean_Grade_bySchool = mean(Grades)\n  ) \n\n## Combine them into one table\ntotal_summary <- tutoring_summary |> \n  left_join(school_summary, by = \"School\")\n```\n\n### Plot main effect of School Type\n\n```{webr-r}\nggplot(total_summary, aes(x = Tutoring)) +\n  geom_point(aes(y = Mean_Grade_bySchool, color = School)) +\n  geom_hline(aes(yintercept = Mean_Grade_bySchool, color = School), linewidth = 1.3) +\n  scale_y_continuous(limits = c(70, 90), breaks = seq(70, 90, 5)) +\n  labs(title = \"Main Effect of School Type on Student Grades\",\n       x = \"Tutoring Type\",\n       y = \"Mean Grade\") +\n  theme_minimal() +\n  theme(legend.position = \"none\")  # Remove legend for cleaner visualization\n```\n:::\n\n## Combined Visualization for no-interaction model\n\n::: panel-tabset\n### R Plot\n\n```{webr-r}\nfit <- lm(Grades ~ Tutoring + School, data = data)\nLine_No_Tutor <- c(fit$coefficients[1], fit$coefficients[1] + c(fit$coefficients[4], fit$coefficients[5]))\nLine_Once_A_Week <- Line_No_Tutor + fit$coefficients[2]\nLine_Daily <- Line_No_Tutor + fit$coefficients[3]\nSchool_Levels <- c(\"Public\",\"Private-Secular\", \"Private-Religious\")\ncombined_vis_data <- data.frame(\n  School_Levels,\n  Line_No_Tutor,\n  Line_Once_A_Week,\n  Line_Daily\n)\nggplot(data = combined_vis_data, aes(x = School_Levels)) +\n  geom_path(aes(y = as.numeric(Line_No_Tutor)), group = 1, color = \"red\", linewidth = 1.4) +\n  geom_path(aes(y = as.numeric(Line_Once_A_Week)), group = 1, color = \"green\", linewidth = 1.4) +\n  geom_path(aes(y = as.numeric(Line_Daily)), group = 1, color = \"blue\", linewidth = 1.4) +\n  geom_point(aes(y = as.numeric(Line_No_Tutor))) +\n  geom_point(aes(y = as.numeric(Line_Once_A_Week))) +\n  geom_point(aes(y = as.numeric(Line_Daily)))  +\n  labs(title = \"Main Effect of Tutoring and School Type on Student Grades\",\n       x = \"Tutoring Type\",\n       y = \"Mean Grade\") +\n  theme_minimal() +\n  theme(legend.position = \"none\") \n```\n\n### In the graph\n\n-   There is the LARGE effect of Factor [Tutoring]{.mohu} and very small effect of [School Type]{.mohu}:\n    -   Effect of Factor [Tutoring]{.mohu}: the LARGE vertical distance\n    -   Effect of Factor [School Type]{.mohu}: the very small horizontal distance\n:::\n\n## Real-World Examples of Interaction Effects\n\n::: panel-tabset\n#### Example 1: Medication & Age\n\n**Research Question**: Does the effectiveness of a new pain medication depend on patient age?\n\n**Factors:**\n\n- Factor A: Medication Type (Drug A vs. Placebo)\n- Factor B: Age Group (Young Adults vs. Elderly)\n\n**Observed Pattern (Interaction Present):**\n\n- **Young Adults**: Drug A shows moderate improvement over placebo (Δ = 15 points)\n- **Elderly**: Drug A shows LARGE improvement over placebo (Δ = 40 points)\n\n**Why the interaction?**\n\n- Elderly patients may have different metabolism rates\n- Age-related changes in pain receptors may make them more responsive to the drug\n- Elderly may have more severe baseline pain, allowing more room for improvement\n\n**Implication**: You cannot simply say \"Drug A works\" - you must specify \"Drug A works **especially well** for elderly patients\"\n\n**Visualization:**\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](ESRM64103_Lecture10_files/figure-html/unnamed-chunk-4-1.png){width=768}\n:::\n:::\n\n\n#### Example 2: Teaching Method & Learning Style\n\n**Research Question**: Does the best teaching method depend on students' learning style?\n\n**Factors:**\n\n- Factor A: Teaching Method (Lecture-Based vs. Problem-Based Learning)\n- Factor B: Learning Style (Visual vs. Auditory Learners)\n\n**Observed Pattern (Interaction Present):**\n\n- **Visual Learners**: Problem-Based Learning >> Lecture-Based (80 vs. 65)\n- **Auditory Learners**: Lecture-Based >> Problem-Based Learning (85 vs. 70)\n\n**Why the interaction?**\n\n- Visual learners benefit from hands-on activities with diagrams and visual aids in PBL\n- Auditory learners benefit from verbal explanations and discussions in lectures\n- One-size-fits-all teaching ignores individual differences in cognitive processing\n\n**Implication**: Educational policy should consider **matching** teaching methods to learning styles, not universally adopting one method.\n\n**Visualization:**\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](ESRM64103_Lecture10_files/figure-html/unnamed-chunk-5-1.png){width=768}\n:::\n:::\n\n\n#### Example 3: Exercise & Gender\n\n**Research Question**: Does the effect of exercise intensity on weight loss depend on biological sex?\n\n**Factors:**\n\n- Factor A: Exercise Intensity (Low vs. High Intensity)\n- Factor B: Gender (Male vs. Female)\n\n**Observed Pattern (Interaction Present):**\n\n- **Males**: High intensity >> Low intensity (12 kg vs. 6 kg lost)\n- **Females**: High intensity ≈ Low intensity (8 kg vs. 7 kg lost)\n\n**Why the interaction?**\n- Males typically have higher muscle mass and testosterone, enabling better response to high-intensity training\n- Females may have hormonal differences affecting metabolism response to exercise intensity\n- High-intensity exercise may increase cortisol more in females, potentially interfering with weight loss\n- Different fat distribution patterns between sexes respond differently to exercise intensity\n\n**Implication**: Exercise prescriptions should be **sex-specific**, not generic.\n\n**Visualization:**\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](ESRM64103_Lecture10_files/figure-html/unnamed-chunk-6-1.png){width=768}\n:::\n:::\n\n\n#### Example 4: Therapy & Severity\n\n**Research Question**: Does the effectiveness of therapy type depend on depression severity?\n\n**Factors:**\n\n- Factor A: Therapy Type (CBT vs. Medication)\n- Factor B: Depression Severity (Mild vs. Severe)\n\n**Observed Pattern (Interaction Present):**\n\n- **Mild Depression**: CBT >> Medication (75% vs. 60% improvement)\n- **Severe Depression**: Medication >> CBT (80% vs. 55% improvement)\n\n**Why the interaction?**\n\n- Mild depression patients can engage effectively with cognitive strategies in CBT\n- Severe depression patients may lack energy/motivation for CBT homework\n- Severe cases need biological intervention (medication) to restore neurochemical balance\n- CBT requires cognitive capacity that may be impaired in severe depression\n\n**Implication**: Treatment selection should be **severity-matched**, not preference-based alone.\n\n**Visualization:**\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](ESRM64103_Lecture10_files/figure-html/unnamed-chunk-7-1.png){width=768}\n:::\n:::\n\n\n#### Example 5: Study Time & IQ\n\n**Research Question**: Does the effect of study time on exam performance depend on intelligence level?\n\n**Factors:**\n\n- Factor A: Study Time (Low: 2 hrs vs. High: 10 hrs)\n- Factor B: IQ Level (Below Average vs. Above Average)\n\n**Observed Pattern (Interaction Present):**\n\n- **Below Average IQ**: High study time >> Low study time (75 vs. 50 points)\n- **Above Average IQ**: High study time ≈ Low study time (85 vs. 82 points)\n\n**Why the interaction?**\n\n- High IQ students can learn material efficiently with less study time\n- Below average IQ students need more repetition and practice (more study time helps significantly)\n- High IQ students may reach a \"ceiling effect\" - already performing well with minimal study\n- Different cognitive abilities create different learning curves\n\n**Implication**: Educational interventions (increasing study time) may be most beneficial for students who struggle, not top performers.\n\n**Visualization:**\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](ESRM64103_Lecture10_files/figure-html/unnamed-chunk-8-1.png){width=768}\n:::\n:::\n\n\n#### Example 6: Caffeine & Time of Day\n\n**Research Question**: Does caffeine's effect on alertness depend on time of day?\n\n**Factors:**\n\n- Factor A: Caffeine Dose (0 mg vs. 200 mg)\n- Factor B: Time of Day (Morning vs. Evening)\n\n**Observed Pattern (Interaction Present):**\n\n- **Morning**: Small caffeine effect (alertness: 65 vs. 75)\n- **Evening**: Large caffeine effect (alertness: 35 vs. 70)\n\n**Why the interaction?**\n\n- Morning: Natural cortisol levels are already high (circadian rhythm), so caffeine adds less\n- Evening: Cortisol levels drop naturally, so caffeine has a larger stimulating effect\n- Adenosine (sleepiness molecule) accumulates throughout the day - caffeine blocks adenosine receptors\n- Baseline alertness differs dramatically by time of day\n\n**Implication**: Timing caffeine intake strategically (avoiding morning when cortisol is high) may be more effective.\n\n**Visualization:**\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](ESRM64103_Lecture10_files/figure-html/unnamed-chunk-9-1.png){width=768}\n:::\n:::\n\n:::\n\n## Common Themes: Why Interactions Occur\n\n::: callout-note\n### Underlying Mechanisms for Interactions\n\n1. **Biological Differences**: Age, sex, genetics create different physiological responses\n2. **Baseline/Ceiling Effects**: Different starting points or maximum capacities across groups\n3. **Mechanism Differences**: Treatments work through different pathways in different populations\n4. **Resource Allocation**: Limited cognitive/physical resources are used differently across contexts\n5. **Moderating Variables**: Third variables (not measured) that correlate with factors\n6. **Compensatory Strategies**: Different groups adapt differently to interventions\n7. **Dose-Response Variation**: Sensitivity to \"dosage\" varies across groups\n:::\n\n-----------\n\n::: callout-warning\n### Critical Insight\n\n**Ignoring interactions leads to incorrect conclusions!**\n\nIf you only report main effects in these examples, you would conclude:\n\n- \"Drug A works\" (missing that it works mainly for elderly)\n- \"Problem-based learning is better\" (missing that it depends on learning style)\n- \"High intensity exercise is better\" (missing that it mainly benefits males)\n\n**Always test and visualize interactions before interpreting main effects!**\n:::\n\n\n## Model 2: Two-Way ANOVA with Interaction\n\n$$\n\\mathrm{Grade} = U_1(\\mathrm{Tutoring}) + U_2(\\mathrm{School}) + U_3(\\mathrm{TutoringxSchool})\n$$\n\nThere variance components (random effects) included in a full two-way ANOVA with two Factors.\n\n## Model 2: Visualization of Two-Way ANOVA with Interaction\n\n::::: columns\n::: column\n![](images/clipboard-3633655973.png)\n:::\n\n::: column\nIn the graph:\n\n-   There is the **LARGE** effect of Factor A and very small effect of Factor B:\n-   Effect of Factor A: the LARGE distance between two green stars\n-   Effect of Factor B: the very small distance between two red stars\n\nIn the graph, there is an intersection between two lines → This is an interaction effect between two factors!\n\n-   The level of Factor B depends upon the level of Factor A – B1 is higher than B2 for A1, but lower for A2 – B2 is lower than B1 for A1, but higher for A2\n:::\n:::::\n\n# F-statistics\n\n## F-statistics for Two-Way ANOVA\n\n![](images/clipboard-1962342945.png)\n\n## F-statistics for Two-Way ANOVA: R code\n\n::: panel-tabset\n### R Code\n\n```{webr-r}\nsummary(aov(Grades ~ Tutoring + School + Tutoring:School, data = data))\n# or summary(aov(Grades ~ Tutoring*School, data = data))\n```\n\n### Interpretation\n\n| Source | df | MS | F |\n|----|----|----|----|\n| Main Effect of Tutoring | 2 | $2120.1 = 4240 / 2$ | 89.065\\*\\*\\* |\n| Main Effect of School | 2 | $10.8 = 22 / 2$ | 0.636 |\n| Interaction Effect of School x Tutoring | 4 | $46.5 = 186 / 4$ | 0.102 |\n| Residual | 261 | $23.8 = 6213 / 261$ | --- |\n:::\n\n## F-statistics for Two-Way ANOVA: Degree of Freedom\n\n-   IVs:\n    1.  Tutoring Programs: (1) No tutor; (2) Once a week; (3) Daily\n    2.  Types of schools: (1) Public (2) Private-secular (3) Private-religious\n-   Degree of freedom (DF):\n    -   $df_{tutoring}$ = (Number of levels of Tutoring) - 1 = 3 - 1 = 2\n    -   $df_{school}$ = (Number of levels of School) - 1 = 3 - 1 = 2\n    -   $df_{interaction}$ = $df_{tutoring} \\times df_{school}$ = $2 \\times 2$ = 4\n    -   $df_{total}$ = 270 - 1 = 269\n    -   $df_{residual}$ = $df_{total}-df_{tutoring}-df_{school} - df_{interaction}$ = 269 - 2 - 2 - 4= 261\n\n::: callout-note\n### Calculation of p-values\n\nBased on DF and observed F statistics, we can locate observed F-statistic onto the F-distribution can calculate the p-values.\n:::\n\n## F-statistics for Two-Way ANOVA: SS and DF\n\nWhy residual DF is calculated by subtracting the total DFs with effects' DFs?\n\nBecause DF is linked to SS.\n\n| Source | SS | df |\n|----|----|----|\n| Main Effect of Tutoring | 4240 | 2 |\n| Main Effect of School | 22 | 2 |\n| Interaction Effect of School x Tutoring | 186 | 4 |\n| Residual | 6213 | 261 |\n| Total | 4240 + 22 + 186 + 6213 | 2 + 2 + 4 + 261 |\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum((data$Grades - mean(data$Grades))^2) # manually calculate total Sum of squares\nnrow(data) - 1 # nrow() calculate the number of rows / observations\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 10660.77\n[1] 269\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n4240 + 22 + 186 + 6213\n2 + 2 + 4 + 261\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 10661\n[1] 269\n```\n\n\n:::\n:::\n\n\n## Difference between one-way and two-way ANOVA\n\n::::: columns\n::: column\n### One-way ANOVA {.unnumbered}\n\nTotal = Between + Within\n:::\n\n::: column\n### Two-way ANOVA {.unnumbered}\n\nTotal = FactorA + FactorB + A\\*B + Residual\n:::\n:::::\n\n::: rmdnote\n*Within*-factor effects (one-way ANOVA) and *Residuals* (two-way ANOVA) have same meaning, both of which are unexplained part of DV by the model.\n:::\n\n-   In Factor ANOVA Design, the overall between-group variability is divided up into variance terms for each unique source of the factors.\n\n| Source | 2 IVs | 3 IVs | 4 IVs |\n|----|----|----|----|\n| Main effect | A, B | A, B, C | A, B, C, D |\n| Interaction effect | AB | AB, BC, AC, ABC | AB, AC, AD, BC, BD, CD, ABC, ABD, BCD, ACD, ABCD |\n\n::: macwindow\n**Calculate the number of interaction effects** $$\n\\mathrm{N_{interaction}} = \\sum_{j=2}^J C_J^j\n$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\n##Number of interaction for 4 IVs\nchoose(4, 2) + choose(4, 3) + choose(4, 4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 11\n```\n\n\n:::\n:::\n\n:::\n\n## F-statistics for Two-way ANOVA: F values\n\n-   F-observed values:\n\n    -   Main effect of factor A: $F_A = \\frac{SS_A/df_A}{SS_E/df_E} = \\frac{MS_A}{MS_E}$\n        -   $F_{tutoring} = \\frac{MS_{tutoring}}{MS_{residual}} = \\frac{2120.1}{23.8} = 89.065$\n    -   Main effect of factor B: $F_B = \\frac{MS_B}{MS_E}$\n        -   $F_{School} = \\frac{MS_{School}}{MS_{residual}} = \\frac{10.8}{23.8} = 0.453$\n    -   Interaction effect of AxB: $F_{AB} = \\frac{MS_{AB}}{MS_E}$\n        -   $F_{SxT} = \\frac{MS_{SxT}}{MS_{residual}} = \\frac{46.5}{23.8} = 1.953$\n\n-   Degree of freedom:\n\n    -   $df_{tutoring}$ = (Number of levels of Tutoring) - 1\n    -   $df_{school}$ = (Number of levels of School) - 1\n    -   $df_{interaction}$ = $df_{tutoring} \\times df_{school}$\n    -   $df_{total}$ = N - 1\n    -   $df_{residual}$ = $df_{total}-df_{tutoring}-df_{school} - df_{interaction}$\n\n------------------------------------------------------------------------\n\n## Exercise\n\n-   A new samples with N = 300\n    -   Tutoring still has **three** levels,\n    -   School types only have two levels: Public vs. Private.\n\nBased on the SS provide below, calculate DF and F values for three effects.\n\n```{webr-r}\n#| context: \"setup\"\n# Set seed for reproducibility\nset.seed(1234)\n\n# Define sample size per group\nn <- 50  \n\n# Define factor levels\ntutoring <- rep(c(\"No Tutor\", \"Once a Week\", \"Daily\"), each = 2*n)\nschool <- rep(c(\"Public\", \"Private\", \n                \"Public\", \"Private\", \n                \"Public\", \"Private\"), times = n)\n\n# Simulate student grades with assumed effects\ngrades <- c(\n  rnorm(n, mean = 75, sd = 3),  # No tutor, Public\n  rnorm(n, mean = 78, sd = 3),  # No tutor, Private\n  rnorm(n, mean = 80, sd = 3),  # Once a week, Public\n  rnorm(n, mean = 83, sd = 3),  # Once a week, Private\n  rnorm(n, mean = 85, sd = 3),  # Daily, Public\n  rnorm(n, mean = 88, sd = 3)  # Daily, Private\n)\n\n# Create a dataframe\ndata2 <- data.frame(\n  Tutoring = factor(tutoring, levels = c(\"No Tutor\", \"Once a Week\", \"Daily\")),\n  School = factor(school, levels = c(\"Public\", \"Private\")),\n  Grades = grades\n)\n\nfit <- aov(Grades ~ Tutoring*School, data2)\nfit_summary <- summary(fit)\n```\n\n```{webr-r}\n#| context: \"output\"\nfit_summary[[1]][2]\n```\n\n::: panel-tabset\n### You turn\n\n```{webr-r}\n# calculate the F-values give sum of squares\n \ndf_tutoring = ______ # degree of freedom for tutoring\ndf_school = ______ # degree of freedom for school\ndf_ts = ______ # degree of freedom for interaction effects\ndf_res = ______ # degree of freedom for residuals\nF_Tutoring = ( __ / df_tutoring ) / (__ / df_res)\nF_school = (__ / df_school) / (__ / df_res)\nF_ts = ( __ / df_ts)  / (__ / df_res) \nF_Tutoring\nF_school\nF_ts\n```\n\n### Result\n\n```{webr-r}\n#| read-only: true\n\ndf_res = 300 - 1 - 2 - 1 - 2\nF_Tutoring = ( 5978.8 / 2) / (3571.1 / df_res)\nF_school = (5.2 / 1) / (3571.1 / df_res)\nF_ts = ( 3.6 / 2)  / (3571.1 / df_res) \nF_Tutoring\nF_school\nF_ts\n\nfit_summary\n```\n:::\n\n## F-statistics for Two-way ANOVA: Sum of squres\n\n::: callout-note\nIn a old-fashion way, you can calculate Sum of Squares based on marginal means and sample size for each cell.\n:::\n\n::::: columns\n::: column\n![](images/clipboard-3610072829.png)\n:::\n\n::: column\n![](images/clipboard-4236975850.png)\n:::\n:::::\n\n## Interpretation\n\n| Source          | Df  | Sum Sq | Mean Sq | F value | P              |\n|-----------------|-----|--------|---------|---------|----------------|\n| Tutoring        | 2   | 4240   | 2120.1  | 89.065  | \\<2e-16 \\*\\*\\* |\n| School          | 2   | 22     | 10.8    | 0.453   | 0.636          |\n| Tutoring:School | 4   | 186    | 46.5    | 1.953   | 0.102          |\n| Residuals       | 261 | 6213   | 23.8    |         |                |\n\n::: panel-tabset\n### Main Effect A\n\n-   Main Effect A: Ignoring type of school, are there differences in grades across type of tutoring?\n    -   Under alpha=.05 level, because F-observed (F_observed=89.065) exceeds the critical value (p \\< .001), we reject the null that all means are equal across tutoring type (ignoring the effect of school type).\n    -   There is a significant main effect of tutoring type on grade.\n\n### Main Effect B\n\n-   Main Effect B: Ignoring tutoring type, are there differences in grades across type of school?\n    -   Under alpha=.05 level, because F-observed (F_observed=95.40) exceeds the critical value (p = .453), we retain (or fail to reject) the null hypothesis that all means are equal across school type (ignoring the effect of tutoring type).\n    -   There is no evidence suggesting a significant main effect of school type on grade.\n\n### Interaction Effect AB\n\n-   Interaction Effect: Does the effect of tutoring type on grades depend on the type of school?\n    -   Under alpha=.05 level, because F-observed (F_observed=2.21) does not exceed the critical value (p = 0.102), we fail to reject the null that the effect of Factor A depends on Factor B.\n    -   There is not a significant interaction between tutoring type and school type on grades.\n:::\n\n## Assumptions for conducting 2-way ANOVA\n\n-   In order to compare our sample to the null distribution, we need to make sure we are meeting some assumptions for each CELL:\n    1.  Variance of DV in each cell is about equal. → Homogeneity of variance\\\n    2.  DV is normally distributed within each cell. → Normality\n    3.  Observations are independent. → Independence\n-   **Robustness** of assumption violations:\n    1.  Violations of independence assumption: bad news! → Not robust to this!\n    2.  Having a large N and equal cell sizes protects you against violations of the normality assumption → Rough suggestion: have at least 15 participants per cell → If you don’t have large N or equal groups, check cell normality 2 ways: (1) skew/kurtosis values, (2) histograms\n    3.  Use Levene’s test to check homogeneity of cell variance assumption → If can’t assume equal variances, use Welch or Brown-Forsyth. → However, F is somewhat robust to violations of HOV as long as within-cell standard deviations are approximately equal.\n\n## Two-way ANOVA: Calculation based on Grand & Marginal & Cell Means\n\n::: panel-tabset\n### Background\n\nThis research study is an adaptation of Gueguen (2012) described in Andy Field’s text. Specifically, the researchers hypothesized that **people with tattoos and piercings were more likely to engage in riskier behavior than those without tattoos and piercings**. In addition, the researcher wondered whether this difference varied, depending on whether a person was male or female.\n\nQuestion: How many IVs? How many levels for each.\n\nAnswer: [2 IVs: (1) Whether or not having Tattos and Piercings (2) Male of Female. DV: Frequency of risk behaviors]{.mohu}\n\n### Data screening\n\n![](images/clipboard-655219567.png)\n:::\n\n## Step 1: Data importion\n\nEither you can import a CSV file, or manually import the data points (for small samples).\n\nImagine you have a data with N = 16. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ntatto_piercing = rep(c(TRUE, FALSE), each = 8)\ngender = rep(c(\"Male\", \"Female\", \"Male\", \"Female\"), each = 4)\noutcome = c(5.4, 6.7, 1.8, 6.1, 5.9, 4.6, 2.7, 3.8,\n            2.6, 5.8, 1.5, 2.1, .6, .7, .7, 1.8)\n\ndat <- data.frame(\n  tatto_piercing = tatto_piercing,\n  gender = gender,\n  outcome = outcome\n)\ndat\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   tatto_piercing gender outcome\n1            TRUE   Male     5.4\n2            TRUE   Male     6.7\n3            TRUE   Male     1.8\n4            TRUE   Male     6.1\n5            TRUE Female     5.9\n6            TRUE Female     4.6\n7            TRUE Female     2.7\n8            TRUE Female     3.8\n9           FALSE   Male     2.6\n10          FALSE   Male     5.8\n11          FALSE   Male     1.5\n12          FALSE   Male     2.1\n13          FALSE Female     0.6\n14          FALSE Female     0.7\n15          FALSE Female     0.7\n16          FALSE Female     1.8\n```\n\n\n:::\n:::\n\n\n\n## Step 2: Sum of Squares of main effects\n\n$$\nSS_A = \\sum n_a (M_{Aa} - M_T)^2\n$$\n\n-   $M_{Aa}$ marginal mean of main effect A at each level\n-   $n_a$: sample size for factor A at each level\n-   $M_T$: grand mean of outcome\n\n----------------------------\n\n### Obtain sum of square of tatto piercing\n\n\n\n#### Manual way\n\n::: {.cell}\n\n```{.r .cell-code}\nM_A_table <-  dat |> \n  group_by(tatto_piercing) |>  \n  summarise(\n    N = n(),\n    Mean = mean(outcome)\n  ) \nM_T = mean(dat$outcome)\nM_A_table\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 3\n  tatto_piercing     N  Mean\n  <lgl>          <int> <dbl>\n1 FALSE              8  1.98\n2 TRUE               8  4.62\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nM_A_table$N[1] * (M_A_table$Mean[1] - M_T)^2 + \n  M_A_table$N[2] * (M_A_table$Mean[2] - M_T)^2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 28.09\n```\n\n\n:::\n:::\n\n\nor\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum(M_A_table$N * (M_A_table$Mean - M_T)^2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 28.09\n```\n\n\n:::\n:::\n\n\n------------------------------------------------------------------------\n\n### Your turn: Obtain sum of squares of gender\n\n```{webr-r}\n#| context: setup\ntatto_piercing = rep(c(TRUE, FALSE), each = 8)\ngender = rep(c(\"Male\", \"Female\", \"Male\", \"Female\"), each = 4)\noutcome = c(5.4, 6.7, 1.8, 6.1, 5.9, 4.6, 2.7, 3.8,\n            2.6, 5.8, 1.5, 2.1, .6, .7, .7, 1.8)\n\ndat <- data.frame(\n  tatto_piercing = tatto_piercing,\n  gender = gender,\n  outcome = outcome\n)\ndat\n```\n\n::: panel-tabset\n### Exercise\n\n`dat` object has already been loaded into R. Please, calculate the gender's sum of squares:\n\n```{webr-r}\nM_B_table <-  dat |> \n  group_by(____) |>  \n  summarise(\n    N = n(),\n    Mean = mean(___)\n  ) \nM_T = mean(____) ## grand mean\nM_B_table\n\n## Formula for Sum of squares of Gender\n___[1] * (____[1] - ___)^2 + \n  ___[2] * (____[2] - ____)^2\n```\n\n### Answer\n\n```{webr-r}\nM_B_table <-  dat |> \n  group_by(gender) |>  \n  summarise(\n    N = n(),\n    Mean = mean(outcome)\n  ) \nM_T = mean(dat$outcome) ## grand mean\nM_B_table\n\nM_B_table$N[1] * (M_B_table$Mean[1] - M_T)^2 + \n  M_B_table$N[2] * (M_B_table$Mean[2] - M_T)^2\n```\n:::\n\n## Step 3: Sum of Squares of interaction effect\n\n$$\nSS_{AB} = (\\sum n_{ab} (M_{AaBb} - M_T)^2) - SS_A - SS_B\n$$\n\n![](images/clipboard-3610072829.png)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncell_means <- dat |> \n  group_by(tatto_piercing, gender) |> \n  summarise(\n    N = n(),\n    Mean = mean(outcome)\n  )\ncell_means\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 4\n# Groups:   tatto_piercing [2]\n  tatto_piercing gender     N  Mean\n  <lgl>          <chr>  <int> <dbl>\n1 FALSE          Female     4  0.95\n2 FALSE          Male       4  3   \n3 TRUE           Female     4  4.25\n4 TRUE           Male       4  5   \n```\n\n\n:::\n:::\n\n\n------------------------------------------------------------------------\n\n### Your turn\n\nThe data frame --- `cell_means` is already available to you.\n\n```{webr-r}\n#| context: setup\ncell_means <- dat |> \n  group_by(tatto_piercing, gender) |> \n  summarise(\n    N = n(),\n    Mean = mean(outcome)\n  )\n```\n\n::: panel-tabset\n\n### Exercise\n\nNote: Sum of squares of interaction effects is the leftover of total sum of squares after removing SS of gender and SS of tutoring program.\n\n$SS_{total} = \\Sigma (N_{ab} * (M_{ab} - M_T))$\n\nwhere $N_{ab}$ is the cell sample size for a-level of factor A and b-level of factor B.\n\n$M_{ab}$ is the cell means of outcome; $M_T$ is the grand mean of outcome.\n\n```{webr-r}\nSS_gender <- 7.84\nSS_TP <- 28.09\nM_T <- 3.3\nSS_total <- sum(____ * (____ - ___)^2) \nSS_GxTP <- SS_total - ____ - ____\nprint(SS_GxTP)\n```\n\n### Answer\n\n```{webr-r}\nSS_gender <- 7.84\nSS_TP <- 28.09\nM_T <- 3.3\n\nSS_total <- sum(____ * (____ - ___)^2) \nSS_GxTP <- SS_total - ____ - ____\nprint(SS_GxTP)\n\nsum(cell_means$N * (cell_means$Mean - M_T)^2) - SS_gender - SS_TP\n```\n:::\n\n## Step 4: Calculate Degree of freedom and F-statistics\n\n::: panel-tabset\n### Your turn\n\n```{webr-r}\n#| context: setup\n\nSS_gender <- 7.84\nSS_TP <- 28.09\nM_T <- 3.3\nSS_GxTP <- sum(cell_means$N * (cell_means$Mean - M_T)^2) - SS_gender - SS_TP\nSS_total <- sum((dat$outcome - mean(dat$outcome))^2)\nSS_residual = SS_total - SS_gender - SS_TP - SS_GxTP\n```\n\n```{webr-r}\n## Calculate total sum of square and residual SS\nSS_total <- sum((dat$outcome - mean(dat$outcome))^2)\nSS_residual = SS_total - SS_gender - SS_TP - SS_GxTP\n\ndf_gender = ___ # degree of freedom of factor gender\ndf_TP = ___ # degree of freedom of factor tutoring\ndf_GxTP = _____ # degree of freedom of interaction term gender x tutoring\ndf_residual = __ - __ - __ - __ - ___ # degree of freedom of residuals\nF_gender = (___ / df_gender) / (SS_residual / df_residual)\nF_TP = (___ / df_TP) / (SS_residual / df_residual)\nF_GxTP = (___ / df_GxTP) / (SS_residual / df_residual)\nF_gender; F_TP; F_GxTP # print out three F-statistics\n```\n\n### Answer\n\n```{webr-r}\ndf_gender = 1\ndf_TP = 1\ndf_GxTP = 1*1\ndf_residual = 16 - 1 - 1 - 1 - 1*1 \nF_gender = (SS_gender / df_gender) / (SS_residual / df_residual)\nF_TP = (SS_TP / df_TP) / (SS_residual / df_residual)\nF_GxTP = (SS_GxTP / df_GxTP) / (SS_residual / df_residual)\nF_gender; F_TP; F_GxTP # print out three F-statistics\n\n#                       Df Sum Sq Mean Sq F value Pr(>F)   \n# gender                 1   7.84   7.840   2.942  0.112   \n# tatto_piercing         1  28.09  28.090  10.540  0.007 **\n# gender:tatto_piercing  1   1.69   1.690   0.634  0.441   \n# Residuals             12  31.98   2.665                  \n```\n:::\n\n## Interpretation\n\n```         \n#                       Df Sum Sq Mean Sq F value Pr(>F)   \n# gender                 1   7.84   7.840   2.942  0.112   \n# tatto_piercing         1  28.09  28.090  10.540  0.007 **\n# gender:tatto_piercing  1   1.69   1.690   0.634  0.441   \n# Residuals             12  31.98   2.665   \n```\n\n-   Main Effect of Tattoo-Piercing: Reject the null → Ignoring the gender, there is a significant main effect of tattoo on risky behavior.\n\n-   Main Effect of Gender: Retain the null → Ignoring the tattoo, there is NO significant main effect of gender on risky behavior.\n\n-   Interaction: Retain the null → Under alpha=.05 level, because F-observed (F=0.63) does not exceed the critical value (F=4.75), we fail to reject the null that the effect of Factor A depends on Factor B. → “There is NO significant interaction between gender and tattoo on risky behavior.”\n\n## Final discussion\n\nIn this example,\n\n-   The interaction effect shows several issues:\n\n    -   Violation of independency assumption\n    -   Violation of normality assumption in the condition of \"Male\" and \"Tattoo=Yes\"\n\n-   We can guess/think about one possibility that it might be cause by several reasons. (e.g., too small sample sizes, not randomized assignments of the samples, not a significant interaction effect, etc.)\n\n    -   From the two-way ANOVA results, we found that the interaction effect is not significant.\n\n-   Thus, in this case, it is more reasonable to conduct\n\n    1.  one-way ANOVA for \"Group\" variable, and\n    2.  one-way ANOVA for \"Gender\" variable, separately.\n\n    -   For each of one-way ANOVAs, we should check the assumptions, conduct one-way ANOVA, and post-hoc test separately as well.\n\n\n## Type I Sum of Squares\n\n-   Type I / Type II / Type III sum of squares?\n    -   Effect sums of squares ($SS_A$, $SS_B$, $SS_{AB}$) are a decomposition of the total sum of squared deviations from the overall mean (SST).\n    -   How the $SS_T$ is decomposed depends on characteristics of the data as well as the hypotheses of interest to the researcher.\n-   Type I sums of squares (SS) are based on a sequential decomposition.\n    -   For example, if your ANOVA model statement is “MODEL Y = A B A\\*B”, then, the sum of squares are considered in effect order A, B, A\\*B, with each effect adjusted for all preceding effects in the model.\n    -   Thus, any variance that is shared between the various effects will be sub-summed by the variable entered earlier.\n\nPros:\n\n1.  Nice property: balanced or not, SS for all the effects add up to the total SS, a complete decomposition of the predicted sums of squares for the whole model. This is not generally true for any other type of sums of squares.\n\n2.  Preferable when some factors (such as nesting) should be taken out before other factors. For example, with unequal number of male and female, factor \"gender\" should precede \"subject\" in an unbalanced design.\n\nCons: 1. Order matters! 2. Not appropriate for factorial designs, but might be ok for Blocking designs.\n\n## Type II Sum of Squares\n\n-   With Type II SS, each main effect is considered as though it were added after the other main effects but before the interaction.\n    -   Any interaction effects are calculated based on a model already containing the main effects.\n    -   Any variance that is shared between A and B is not considered part of A or B.\n    -   Thus, interaction variance that is shared with A or with B will be counted as part of the main effect, and not as part of the interaction effect.\n\nPros:\n\n1.  appropriate for model building, and natural choice for regression\n2.  most powerful when there is no interaction\n3.  invariant to the order in which effects are entered into the model\n\nCons:\n\n1.  For factorial designs with unequal cell samples, Type II sums of squares test hypotheses that are complex functions of the cell so that ordinarily are not meaningful.\n2.  Not appropriate for factorial designs.\n\n## Type III Sum of Squares\n\n-   Type III SS considers all effects as though they are added last.\n    -   Any shared variance ends up not being counted in any of the effects.\n    -   In ANOVA, when the data are balanced (equal cell sizes) and the factors are orthogonal and all three types of sums of squares are identical.\n    -   Orthogonal, or independent, indicates that there is no variance shared across the various effects, and the separate sums of squares can be added to obtain the model sums of squares.\n\nPros:\n\nNot sample size dependent: effect estimates are not a function of the frequency of observations in any group (i.e., for unbalanced data, where we have unequal numbers of observations in each group).\n\nCons:\n\nNot appropriate for designs with missing cells: for ANOVA designs with missing cells, Type III sums of squares generally do not test hypotheses about least squares means, but instead test hypotheses that are complex functions of the patterns of missing cells in higher-order containing interactions and that are ordinarily not meaningful.\n\n::: rmdnote\nIn general, for the factorial design, we usually report Type III SS, unless you have missing cells in your model.\n:::\n\n\n## Exercise: Two-Way ANOVA with Significant Interaction\n\n::: panel-tabset\n### Background\n\nA researcher is investigating the effect of **learning environment** (Online vs. In-Person) and **feedback type** (Immediate vs. Delayed) on student test scores. The researcher hypothesizes that:\n\n1. Students in in-person classes will perform better than online students\n2. Immediate feedback will lead to better performance than delayed feedback\n3. **The benefit of immediate feedback will be stronger in online environments** (interaction effect)\n\nThe study randomly assigned 20 students to one of four conditions:\n\n  - Online + Immediate Feedback (n=5)\n  - Online + Delayed Feedback (n=5)\n  - In-Person + Immediate Feedback (n=5)\n  - In-Person + Delayed Feedback (n=5)\n\n**Your Task**: Calculate the sum of squares for both main effects and the interaction effect manually, then compute F-statistics.\n\n### View Data Summary\n\n```{webr-r}\n#| context: setup\nset.seed(456)\n\n# Create data with significant interaction\nlearning_env <- rep(c(\"Online\", \"In-Person\"), each = 10)\nfeedback_type <- rep(c(\"Immediate\", \"Delayed\"), times = 10)\n\n# Test scores - designed to show interaction\n# Online + Immediate: high scores (mean ~85)\n# Online + Delayed: low scores (mean ~70)\n# In-Person + Immediate: moderate scores (mean ~78)\n# In-Person + Delayed: moderate-high scores (mean ~82)\ntest_scores <- c(\n  # Online + Immediate\n  87, 83, 88, 86, 81,\n  # Online + Delayed\n  68, 72, 71, 69, 70,\n  # In-Person + Immediate\n  79, 77, 80, 76, 78,\n  # In-Person + Delayed\n  84, 81, 83, 80, 82\n)\n\nexercise_data <- data.frame(\n  Learning_Env = factor(learning_env, levels = c(\"Online\", \"In-Person\")),\n  Feedback = factor(feedback_type, levels = c(\"Immediate\", \"Delayed\")),\n  Score = test_scores\n)\n\n# Display the data\nexercise_data\n```\n\n\n```{webr-r}\n# Cell means\ncell_summary <- exercise_data |>\n  group_by(Learning_Env, Feedback) |>\n  summarise(\n    N = n(),\n    Mean = mean(Score),\n    SD = sd(Score)\n  )\nprint(cell_summary)\n\n# Marginal means for Learning Environment\nmarginal_env <- exercise_data |>\n  group_by(Learning_Env) |>\n  summarise(\n    N = n(),\n    Mean = mean(Score)\n  )\nprint(marginal_env)\n\n# Marginal means for Feedback Type\nmarginal_feedback <- exercise_data |>\n  group_by(Feedback) |>\n  summarise(\n    N = n(),\n    Mean = mean(Score)\n  )\nprint(marginal_feedback)\n\n# Grand mean\ngrand_mean <- mean(exercise_data$Score)\nprint(paste(\"Grand Mean:\", round(grand_mean, 2)))\n```\n\n### Step 1: Calculate SS for Learning Environment\n\n**Formula**: $SS_A = \\sum n_a (M_{Aa} - M_T)^2$\n\nwhere:\n- $M_{Aa}$ = marginal mean of Learning Environment at each level\n- $n_a$ = sample size for each level of Learning Environment\n- $M_T$ = grand mean\n\n```{webr-r}\n# Calculate marginal means for Learning Environment\nM_Env_table <- exercise_data |>\n  group_by(Learning_Env) |>\n  summarise(\n    N = n(),\n    Mean = mean(Score)\n  )\n\nM_T <- mean(exercise_data$Score)  # Grand mean\n\n# Calculate SS for Learning Environment\nSS_Env <- ___[1] * (___[1] - ___)^2 +\n          ___[2] * (___[2] - ___)^2\n\nprint(paste(\"SS for Learning Environment:\", round(SS_Env, 2)))\n```\n\n### Step 2: Calculate SS for Feedback Type\n\n**Formula**: $SS_B = \\sum n_b (M_{Bb} - M_T)^2$\n\n```{webr-r}\n# Calculate marginal means for Feedback Type\nM_Feedback_table <- exercise_data |>\n  group_by(____) |>\n  summarise(\n    N = n(),\n    Mean = mean(____)\n  )\n\nM_T <- mean(____)  # Grand mean\n\n# Calculate SS for Feedback Type\nSS_Feedback <- ____$N[1] * (____$Mean[1] - ____)^2 +\n               ____$N[2] * (____$Mean[2] - ____)^2\n\nprint(paste(\"SS for Feedback Type:\", round(SS_Feedback, 2)))\n```\n\n### Step 3: Calculate SS for Interaction\n\n**Formula**: $SS_{AB} = (\\sum n_{ab} (M_{AaBb} - M_T)^2) - SS_A - SS_B$\n\n```{webr-r}\n# Calculate cell means\ncell_means_table <- exercise_data |>\n  group_by(____, ____) |>\n  summarise(\n    N = n(),\n    Mean = mean(____)\n  )\n\nprint(cell_means_table)\n\n# Calculate total SS from cells\nSS_total_cells <- sum(____$N * (____$Mean - ____)^2)\n\n# Calculate interaction SS\nSS_Interaction <- ____ - ____ - ____\n\nprint(paste(\"SS for Interaction:\", round(SS_Interaction, 2)))\n```\n\n### Step 4: Calculate F-statistics\n\n```{webr-r}\n# Calculate residual SS\nSS_total <- sum((exercise_data$Score - mean(exercise_data$Score))^2)\nSS_residual <- ____ - ____ - ____ - ____\n\n# Calculate degrees of freedom\ndf_Env <- ____  # levels - 1\ndf_Feedback <- ____  # levels - 1\ndf_Interaction <- ____ * ____  # df_Env * df_Feedback\ndf_residual <- 20 - ____ - ____ - ____ - ____\n\n# Calculate F-statistics\nF_Env <- (SS_Env / df_Env) / (____ / ____)\nF_Feedback <- (____ / ____) / (SS_residual / df_residual)\nF_Interaction <- (____ / ____) / (____ / ____)\n\nprint(paste(\"F for Learning Environment:\", round(F_Env, 3)))\nprint(paste(\"F for Feedback Type:\", round(F_Feedback, 3)))\nprint(paste(\"F for Interaction:\", round(F_Interaction, 3)))\n```\n\n### Answer - Step 1\n\n```{webr-r}\n# Calculate marginal means for Learning Environment\nM_Env_table <- exercise_data |>\n  group_by(Learning_Env) |>\n  summarise(\n    N = n(),\n    Mean = mean(Score)\n  )\n\nM_T <- mean(exercise_data$Score)  # Grand mean\n\n# Calculate SS for Learning Environment\nSS_Env <- M_Env_table$N[1] * (M_Env_table$Mean[1] - M_T)^2 +\n          M_Env_table$N[2] * (M_Env_table$Mean[2] - M_T)^2\n\nprint(paste(\"SS for Learning Environment:\", round(SS_Env, 2)))\n```\n\n### Answer - Step 2\n\n```{webr-r}\n# Calculate marginal means for Feedback Type\nM_Feedback_table <- exercise_data |>\n  group_by(Feedback) |>\n  summarise(\n    N = n(),\n    Mean = mean(Score)\n  )\n\nM_T <- mean(exercise_data$Score)  # Grand mean\n\n# Calculate SS for Feedback Type\nSS_Feedback <- M_Feedback_table$N[1] * (M_Feedback_table$Mean[1] - M_T)^2 +\n               M_Feedback_table$N[2] * (M_Feedback_table$Mean[2] - M_T)^2\n\nprint(paste(\"SS for Feedback Type:\", round(SS_Feedback, 2)))\n```\n\n### Answer - Step 3\n\n```{webr-r}\n# Calculate cell means\ncell_means_table <- exercise_data |>\n  group_by(Learning_Env, Feedback) |>\n  summarise(\n    N = n(),\n    Mean = mean(Score)\n  )\n\nprint(cell_means_table)\n\n# Calculate total SS from cells\nSS_total_cells <- sum(cell_means_table$N * (cell_means_table$Mean - M_T)^2)\n\n# Calculate interaction SS\nSS_Interaction <- SS_total_cells - SS_Env - SS_Feedback\n\nprint(paste(\"SS for Interaction:\", round(SS_Interaction, 2)))\n```\n\n### Answer - Step 4\n\n```{webr-r}\n# Calculate residual SS\nSS_total <- sum((exercise_data$Score - mean(exercise_data$Score))^2)\nSS_residual <- SS_total - SS_Env - SS_Feedback - SS_Interaction\n\n# Calculate degrees of freedom\ndf_Env <- 1  # 2 levels - 1\ndf_Feedback <- 1  # 2 levels - 1\ndf_Interaction <- 1 * 1  # df_Env * df_Feedback\ndf_residual <- 20 - 1 - 1 - 1 - 1\n\n# Calculate F-statistics\nF_Env <- (SS_Env / df_Env) / (SS_residual / df_residual)\nF_Feedback <- (SS_Feedback / df_Feedback) / (SS_residual / df_residual)\nF_Interaction <- (SS_Interaction / df_Interaction) / (SS_residual / df_residual)\n\nprint(paste(\"F for Learning Environment:\", round(F_Env, 3)))\nprint(paste(\"F for Feedback Type:\", round(F_Feedback, 3)))\nprint(paste(\"F for Interaction:\", round(F_Interaction, 3)))\n\n# Calculate p-values\np_Env <- pf(F_Env, df_Env, df_residual, lower.tail = FALSE)\np_Feedback <- pf(F_Feedback, df_Feedback, df_residual, lower.tail = FALSE)\np_Interaction <- pf(F_Interaction, df_Interaction, df_residual, lower.tail = FALSE)\n\nprint(paste(\"p-value for Learning Environment:\", round(p_Env, 4)))\nprint(paste(\"p-value for Feedback Type:\", round(p_Feedback, 4)))\nprint(paste(\"p-value for Interaction:\", round(p_Interaction, 4)))\n```\n\n### Verify with R's aov()\n\n```{webr-r}\n# Verify your calculations with R's built-in ANOVA\nfit <- aov(Score ~ Learning_Env * Feedback, data = exercise_data)\nsummary(fit)\n```\n\n### Interpretation\n\n```{webr-r}\n# Visualize the interaction\nlibrary(ggplot2)\n\ninteraction_plot <- exercise_data |>\n  group_by(Learning_Env, Feedback) |>\n  summarise(Mean_Score = mean(Score)) |>\n  ggplot(aes(x = Learning_Env, y = Mean_Score, color = Feedback, group = Feedback)) +\n  geom_point(size = 4) +\n  geom_line(linewidth = 1.2) +\n  labs(title = \"Interaction Plot: Learning Environment × Feedback Type\",\n       x = \"Learning Environment\",\n       y = \"Mean Test Score\",\n       color = \"Feedback Type\") +\n  theme_minimal() +\n  theme(text = element_text(size = 12))\n\nprint(interaction_plot)\n```\n\n**Key Findings:**\n\n1. **Main Effect of Learning Environment**: The effect depends on whether it's significant (check your F-statistic and p-value)\n\n2. **Main Effect of Feedback Type**: The effect depends on whether it's significant (check your F-statistic and p-value)\n\n3. **Interaction Effect**: **This should be significant!** The interaction plot shows that:\n   - In **Online** environments, Immediate feedback leads to MUCH higher scores than Delayed feedback\n   - In **In-Person** environments, the difference between Immediate and Delayed feedback is smaller (and reversed!)\n   - This crossing pattern indicates a strong interaction: the effect of feedback type depends on the learning environment\n\n:::\n\n\n## Lecture Summary: Key Takeaways\n\n\n\n::: callout-tip\n\n### 1. Conceptual Understanding\n\n**Two-way ANOVA allows us to:**\n\n- Examine the effects of **two independent variables** simultaneously\n- Test for **three distinct effects**: Main effect A, Main effect B, and Interaction A×B\n- Investigate whether the effect of one factor **depends on** the level of another factor (interaction)\n- Achieve greater statistical power and efficiency compared to multiple one-way ANOVAs\n\n**Main Effects vs. Interaction:**\n\n- **Main Effect**: The average effect of one factor, ignoring (collapsing across) the other factor\n- **Interaction Effect**: When the effect of one factor changes depending on the level of the other factor\n  - Look for **non-parallel lines** in interaction plots\n  - **Crossing lines** indicate strong interactions\n  - When interaction is significant, main effects may be misleading!\n\n:::\n\n-------------------\n\n::: callout-important\n### 2. Statistical Calculations\n\n**Partitioning Variance in Two-Way ANOVA:**\n\n$$\nSS_{Total} = SS_A + SS_B + SS_{AB} + SS_{Residual}\n$$\n\n**Key Formulas:**\n\n- Main Effect A: $SS_A = \\sum n_a (M_{Aa} - M_T)^2$\n- Main Effect B: $SS_B = \\sum n_b (M_{Bb} - M_T)^2$\n- Interaction: $SS_{AB} = (\\sum n_{ab} (M_{AaBb} - M_T)^2) - SS_A - SS_B$\n\n**F-statistics:**\n\n$$\nF = \\frac{MS_{effect}}{MS_{residual}} = \\frac{SS_{effect}/df_{effect}}{SS_{residual}/df_{residual}}\n$$\n\n**Degrees of Freedom:**\n\n- $df_A = k_A - 1$ (number of levels of Factor A minus 1)\n- $df_B = k_B - 1$ (number of levels of Factor B minus 1)\n- $df_{AB} = df_A \\times df_B$ (interaction df)\n- $df_{residual} = N - 1 - df_A - df_B - df_{AB}$\n\n:::\n\n-------------------\n\n::: callout-note\n### 3. Practical Considerations\n\n**Assumptions for Two-Way ANOVA:**\n\n1. **Independence**: Observations must be independent (most critical!)\n2. **Normality**: DV should be normally distributed within each cell\n3. **Homogeneity of Variance**: Equal variances across all cells (Levene's test)\n\n**Robustness:**\n\n- F-test is fairly robust to normality violations with large N and equal cell sizes\n- Recommend at least **15 participants per cell**\n- Use Welch or Brown-Forsythe tests if variances are unequal\n- **Never** compromise on independence assumption\n\n**Type I, II, III Sum of Squares:**\n\n- **Type I**: Sequential (order matters) - appropriate for nested/blocking designs\n- **Type II**: Each main effect adjusted for other main effects - good for model building\n- **Type III**: Each effect adjusted for all others - **recommended for factorial designs** with balanced data\n- With **balanced designs** (equal cell sizes), all three types give identical results!\n\n:::\n\n-------------------\n\n::: callout-warning\n### 4. Interpretation Guidelines\n\n**When Interaction is Significant:**\n\n- Interpret interaction **first** before discussing main effects\n- Main effects may be misleading or uninterpretable when interaction is present\n- Focus on **simple effects**: the effect of one factor at each level of the other\n- Use interaction plots to visualize and explain the pattern\n\n**When Interaction is NOT Significant:**\n\n- Proceed to interpret main effects\n- If main effect is significant with >2 levels, conduct **post-hoc tests** (e.g., Tukey HSD)\n- Report effect sizes (partial η²) alongside p-values\n\n**Reporting Results:**\n\nInclude in your report:\n\n1. Descriptive statistics (means, SDs) for all cells\n2. ANOVA table with F-values, df, and p-values\n3. Effect sizes\n4. Interaction plot (even if not significant)\n5. Post-hoc tests if needed\n6. Assumption checks\n\n:::\n\n-------------------\n\n::: callout-tip\n### 5. Common Pitfalls to Avoid\n\n1. **Don't ignore significant interactions!** Main effects alone don't tell the whole story\n2. **Don't forget assumption checks** - especially for small samples\n3. **Don't confuse interaction with correlation** - they are different concepts\n4. **Don't over-interpret non-significant results** - absence of evidence ≠ evidence of absence\n5. **Don't use multiple one-way ANOVAs instead of two-way** - you'll miss interactions and inflate Type I error\n6. **Don't forget to report effect sizes** - statistical significance ≠ practical significance\n\n:::\n\n-------------------\n\n::: callout-important\n### 6. Next Steps in Your Learning\n\n**Extending Two-Way ANOVA:**\n\n- **Three-way ANOVA**: Adding a third factor (exponentially more complex!)\n- **Mixed ANOVA**: Combining between-subjects and within-subjects factors\n- **ANCOVA**: Adding continuous covariates to control for confounding variables\n- **MANOVA**: Multiple dependent variables simultaneously\n- **Repeated Measures ANOVA**: Same subjects measured multiple times\n\n**When to Use Two-Way ANOVA:**\n\n✓ Two categorical independent variables (factors)\n✓ One continuous dependent variable\n✓ Independent observations (between-subjects design)\n✓ Interest in both main effects and interaction\n✓ Adequate sample size (≥15 per cell recommended)\n\n**Alternatives to Consider:**\n\n- **Regression with interactions**: More flexible, can handle continuous IVs\n- **Mixed-effects models**: Better for unbalanced designs or nested data\n- **Non-parametric tests**: When assumptions are severely violated (e.g., Aligned Rank Transform ANOVA)\n\n:::\n\n## Fin\n\n**Thank you for your attention!**\n",
    "supporting": [
      "ESRM64103_Lecture10_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}