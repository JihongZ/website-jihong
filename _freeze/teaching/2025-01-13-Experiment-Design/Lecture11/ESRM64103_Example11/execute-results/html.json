{
  "hash": "d717c3ff484d4617845b9e872be8c715",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Example 11: Repeated Measure ANOVA\"\nexecute: \n  message: false\n  warning: false\nformat: html\n---\n\n\n\n\n## Research Scenario\n\n- **Strength Measure**: CrossFit evaluated strength using the **front squat** across three event types:\n  - **RM1**: One-repetition maximum\n  - **RM4**: Four-repetition maximum\n  - **RM21**: Twenty-one-repetition maximum\n\n- **Study Context**:\n  - RM1, RM4, and RM21 were measured for **athletes in the CrossFit Games quarterfinals**\n\n- **DV**: Average pounds for each type of RM trial using the front squat\n- **Within-subject factor**: Repetition maximum (RM) type (RM1, RM4, RM21)\n- **Research question**: Are there differences in average pounds across RM types?\n\n$$\nH_0: \\mu_{RM1} = \\mu_{RM4} = \\mu_{RM21}\n$$\n\n---\n\n## Data Preparation (R code)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nset.seed(123)\n\nlibrary(tidyverse)\n\n# Simulate 54 participants: 27 males, 27 females\nn <- 54\ngender <- rep(c(\"M\", \"F\"), each = n / 2)\n\n# Mean and SDs from the slides (approximate)\nmeans <- list(\n  M = c(RM1 = 403.65, RM4 = 378.04, RM21 = 247.08),\n  F = c(RM1 = 262.32, RM4 = 246.18, RM21 = 162.25)\n)\nsds <- list(\n  M = c(30, 28, 25),\n  F = c(25, 23, 20)\n)\n\n# Simulate repeated measures data per subject\nsimulate_subject <- function(gender, id) {\n  mu <- means[[gender]]\n  sd <- sds[[gender]]\n  data.frame(\n    subject = id,\n    gender = gender,\n    RM1 = rnorm(1, mu[1], sd[1]),\n    RM4 = rnorm(1, mu[2], sd[2]),\n    RM21 = rnorm(1, mu[3], sd[3])\n  )\n}\n\n# Generate the full dataset\nsim_data <- map2_dfr(gender, 1:n, simulate_subject)\n\n# Convert to long format\nsim_data_long <- sim_data %>%\n  pivot_longer(cols = starts_with(\"RM\"),\n               names_to = \"RM_type\",\n               values_to = \"weight\") %>%\n  mutate(\n    subject = factor(subject),\n    gender = factor(gender),\n    RM_type = factor(RM_type, levels = c(\"RM1\", \"RM4\", \"RM21\"))\n  )\n\n# Display head\nhead(sim_data_long)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 4\n  subject gender RM_type weight\n  <fct>   <fct>  <fct>    <dbl>\n1 1       M      RM1       387.\n2 1       M      RM4       372.\n3 1       M      RM21      286.\n4 2       M      RM1       406.\n5 2       M      RM4       382.\n6 2       M      RM21      290.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(rstatix)\n\n# Sample format\ncf_long <- sim_data_long %>%\n  mutate(RM_type = factor(RM_type, levels = c(\"RM1\", \"RM4\", \"RM21\")))\n```\n:::\n\n\n\n\n---\n\n## Assumption Checks\n\n- **Normality**: Robust due to CLT\n- **Independence**: Not required (repeated measures)\n- **Sphericity**: Use Mauchly's test\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Sphericity test\nanova_res <- cf_long %>% anova_test(dv = weight, wid = subject, within = RM_type)\nanova_res$`Mauchly's Test for Sphericity`\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Effect     W     p p<.05\n1 RM_type 0.914 0.095      \n```\n\n\n:::\n:::\n\n\n\n\nSphericity is not violated (W = .914, p = .095). We can use standard F-test.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanova_res$`Sphericity Corrections`\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Effect  GGe      DF[GG]    p[GG] p[GG]<.05   HFe      DF[HF]    p[HF]\n1 RM_type 0.92 1.84, 97.57 7.07e-45         * 0.952 1.9, 100.92 2.51e-46\n  p[HF]<.05\n1         *\n```\n\n\n:::\n:::\n\n\n\n\n- If sphericity violated, use the following instead of F-test:\n  - **`GGe`**: Greenhouse-Geisser correction\n  - **`HFe`**: Huynh-Feldt correction\n  \n---\n\n## ANOVA Results\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nget_anova_table(anova_res)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nANOVA Table (type III tests)\n\n   Effect DFn DFd       F        p p<.05   ges\n1 RM_type   2 106 369.808 1.59e-48     * 0.447\n```\n\n\n:::\n:::\n\n\n\n\nThe `RM Type` has significant effect on outcome.\n\n\n---\n\n## Post-hoc Tests (if needed)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncf_long %>%\n  pairwise_t_test(weight ~ RM_type, paired = TRUE, p.adjust.method = \"bonferroni\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 10\n  .y.   group1 group2    n1    n2 statistic    df        p    p.adj p.adj.signif\n* <chr> <chr>  <chr>  <int> <int>     <dbl> <dbl>    <dbl>    <dbl> <chr>       \n1 weig… RM1    RM4       54    54      5.94    53 2.23e- 7 6.69e- 7 ****        \n2 weig… RM1    RM21      54    54     22.8     53 5   e-29 1.5 e-28 ****        \n3 weig… RM4    RM21      54    54     21.1     53 1.89e-27 5.67e-27 ****        \n```\n\n\n:::\n:::\n\n\n\n\nTo obtain **sum of squares (SS)** for **between-subject** and **within-subject** effects using the `lme4` package in R, you can follow these steps:\n\n---\n\n## Mixed ANOVA: RQ2\n\n- **Between-subjects factor**: Gender\n- **Within-subject factor**: RM type\n- **RQ**: Is there a gender × RM type interaction?\n\n---\n\n## Mixed ANOVA (R code)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmixed_res <- anova_test(\n  data = cf_long, dv = weight, wid = subject,\n  within = RM_type, between = gender\n)\nmixed_res\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nANOVA Table (type II tests)\n\n$ANOVA\n          Effect DFn DFd        F        p p<.05   ges\n1         gender   1  52 1250.938 4.77e-38     * 0.875\n2        RM_type   2 104  487.055 1.54e-53     * 0.869\n3 gender:RM_type   2 104   17.803 2.24e-07     * 0.196\n\n$`Mauchly's Test for Sphericity`\n          Effect     W     p p<.05\n1        RM_type 0.996 0.906      \n2 gender:RM_type 0.996 0.906      \n\n$`Sphericity Corrections`\n          Effect   GGe      DF[GG]    p[GG] p[GG]<.05   HFe       DF[HF]\n1        RM_type 0.996 1.99, 103.6 2.42e-53         * 1.036 2.07, 107.72\n2 gender:RM_type 0.996 1.99, 103.6 2.35e-07         * 1.036 2.07, 107.72\n     p[HF] p[HF]<.05\n1 1.54e-53         *\n2 2.24e-07         *\n```\n\n\n:::\n:::\n\n\n\n\n---\n\n## Follow-up Contrasts\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncf_long %>%\n  group_by(RM_type, gender) %>%\n  summarise(mean = mean(weight), .groups = \"drop\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n  RM_type gender  mean\n  <fct>   <fct>  <dbl>\n1 RM1     F       266.\n2 RM1     M       410.\n3 RM4     F       247.\n4 RM4     M       374.\n5 RM21    F       156.\n6 RM21    M       247.\n```\n\n\n:::\n\n```{.r .cell-code}\ncf_long %>%\n  pairwise_t_test(weight ~ gender, paired = FALSE, \n                  p.adjust.method = \"bonferroni\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 9\n  .y.    group1 group2    n1    n2        p p.signif    p.adj p.adj.signif\n* <chr>  <chr>  <chr>  <int> <int>    <dbl> <chr>       <dbl> <chr>       \n1 weight F      M         81    81 9.34e-24 ****     9.34e-24 ****        \n```\n\n\n:::\n:::\n\n\n\n\n---\n\n## Interpretation Summary\n\n- RM1 > RM4 > RM21\n- Significant main effect of RM type\n- Interaction between RM type and gender significant\n- Males lift significantly more than females across all RM types\n\n---\n\n## Sphericity Explained\n\n- **Assumption**: Variance of the differences between RM levels are equal\n- **Test**: Mauchly's Test\n- **If violated**:\n  - Use **Greenhouse-Geisser** correction (default conservative choice)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanova_res$`Mauchly's Test for Sphericity`\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Effect     W     p p<.05\n1 RM_type 0.914 0.095      \n```\n\n\n:::\n:::\n\n\n\n\n---\n\n## Conclusion\n\n- Repeated measures ANOVA is powerful when assumptions are met or adjusted\n- Mixed ANOVA enables testing interactions with between-subject factors\n- Use corrected tests (e.g., GG) when sphericity is violated\n\n\n### ✅ **Step-by-step Procedure using `lme4`**\n\nWe will assume the data is in **long format** (as simulated previously), with variables:\n- `subject`: participant ID\n- `gender`: between-subjects factor (optional)\n- `RM_type`: within-subject factor (e.g., RM1, RM4, RM21)\n- `weight`: outcome variable\n\n#### **1. Load required packages**\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lme4)\nlibrary(lmerTest)  # for p-values and ANOVA\n```\n:::\n\n\n\n\n---\n\n#### **2. Fit the linear mixed model**\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Main repeated measures model (random intercept for subject)\nmodel <- lmer(weight ~ gender + RM_type + (1 | subject), data = sim_data_long)\nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by REML. t-tests use Satterthwaite's method [\nlmerModLmerTest]\nFormula: weight ~ gender + RM_type + (1 | subject)\n   Data: sim_data_long\n\nREML criterion at convergence: 1491.4\n\nScaled residuals: \n     Min       1Q   Median       3Q      Max \n-2.80588 -0.74290 -0.01438  0.67387  2.64020 \n\nRandom effects:\n Groups   Name        Variance Std.Dev.\n subject  (Intercept)   0.0     0.00   \n Residual             666.5    25.82   \nNumber of obs: 162, groups:  subject, 54\n\nFixed effects:\n            Estimate Std. Error       df t value Pr(>|t|)    \n(Intercept)  277.716      4.057  158.000  68.461  < 2e-16 ***\ngenderM      120.757      4.057  158.000  29.768  < 2e-16 ***\nRM_typeRM4   -27.861      4.968  158.000  -5.608 8.94e-08 ***\nRM_typeRM21 -136.686      4.968  158.000 -27.512  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nCorrelation of Fixed Effects:\n            (Intr) gendrM RM_RM4\ngenderM     -0.500              \nRM_typeRM4  -0.612  0.000       \nRM_typeRM21 -0.612  0.000  0.500\noptimizer (nloptwrap) convergence code: 0 (OK)\nboundary (singular) fit: see help('isSingular')\n```\n\n\n:::\n:::\n\n\n\n\n- `RM_type`: fixed effect (within-subject factor)\n- `(1 | subject)`: random intercept for subjects to account for repeated measures\n\n---\n\n#### **3. Obtain the ANOVA table with Type III SS**\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanova_results <- anova(model, type = 3)\nprint(anova_results)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nType III Analysis of Variance Table with Satterthwaite's method\n        Sum Sq Mean Sq NumDF DenDF F value    Pr(>F)    \ngender  590578  590578     1   158  886.15 < 2.2e-16 ***\nRM_type 563438  281719     2   158  422.71 < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n\nThis will provide:\n- **Sum of Squares** for the within-subject effect (`RM_type`)\n- **Mean Squares**, **F-statistics**, and **p-values**\n\n---\n\n#### **4. Estimate between-subject variability (subject-level random effect)**\n\nThe **between-subjects SS** is not shown directly in the ANOVA table but can be **extracted from the model’s random effects**:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Extract random effects variance (between-subjects variability)\nVarCorr(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Groups   Name        Std.Dev.\n subject  (Intercept)  0.000  \n Residual             25.816  \n```\n\n\n:::\n:::\n\n\n\n\nYou will see something like:\n\n```\n Groups   Name        Variance Std.Dev.\n subject  (Intercept)  XXX      YYY\n Residual              ZZZ      ...\n```\n\n- `subject (Intercept)` reflects the **between-subject variability**\n- `Residual` is the **within-subject (error) variance**\n\nTo calculate the **sum of squares** for these components, you can multiply the variances by their degrees of freedom (or number of units):\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Degrees of freedom\nn_subjects <- length(unique(sim_data_long$subject))\nn_within   <- length(unique(sim_data_long$RM_type))\n\n# Estimated variances\nvar_components <- as.data.frame(VarCorr(model))\nbetween_var <- var_components$vcov[1] # random intercept\nresidual_var <- var_components$vcov[2] # residuals\n\n# Approximate SS\nSS_between <- between_var * (n_subjects - 1)\nSS_within <- residual_var * (n_subjects * (n_within - 1))\nSS_acrossRM <- as.data.frame(anova_results)[[\"Sum Sq\"]]\n\nSS_total <- sum((sim_data_long$weight - mean(sim_data_long$weight))^2)\n\nSS_between + SS_within + SS_acrossRM\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 662555.7 635415.8\n```\n\n\n:::\n\n```{.r .cell-code}\nSS_total\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1259317\n```\n\n\n:::\n:::\n\n\n\n\n---\n\n### ✅ Summary Output\n\n- `anova(model)` gives **SS for fixed effects** (within-subject factor)\n- `VarCorr(model)` provides **random effects variance**\n- Manual calculation gives **approximate SS for between- and within-subject variability**",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}