{
  "hash": "6a7595aaa445d5b6343b09bc5a9545d2",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: How to do Data Cleaning in R\nauthor: Jihong Zhang\ndate: '2018-09-04'\ncategories: \n  - blog\n  - R\n  - tidyverse\ntoc: true\n---\n\n\n\n\n\n\n> This blog is trying to elaborate steps for cleaning the data. Since datasets varied, this blog could not cover all. Depedent on the data you're using, different methods should be used.\n\n## Libraries\n\nI use tidyverse as my main tool to clean the data. Tidyverse is a very useful package created by Hadley. It includes several sub-packages, such as dplyr (data manipulation), tidyr (data transforming), readr (data import), ggplot2 (data visulization) etc. If you haven't installed this package yet, please run `install.packages(\"tidyverse\")` in your R console.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n\n\n\n## Step 1: Import Data\n\nIf your data is csv format, you could use `read.csv()` to import the data into R. Be careful to add `stringsAsFactors = FALSE` argument in the function, or all string variables will automate convert to factor by default. This will lead to some issues when you do further checking. \\# Configuration of Academic \\# Documentation: <https://sourcethemes.com/academic/> \\# \\# This file is formatted using TOML syntax - learn more at <https://learnxinyminutes.com/docs/toml/> \\# Each configuration section is defined by a name in square brackets (e.g. `[outputs]`).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1 <- read.csv(\"nfl_2010-2017.csv\", stringsAsFactors = FALSE)\n```\n:::\n\n\n\n\n## Step 2: Initial Check\n\nPerform some initial check before doing further manipulation. This step is to let you get familiar with you data and have a big picture on what you need to do next.\n\n### Step 2.1: check variables\n\n`str()` is a very useful fuction in R base package which provides you sample sizes, number of variabels, variables names, variabile types and several sample responses. In the sample data, there are 81,525 observations and 23 variables.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(dat1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t81525 obs. of  23 variables:\n $ X           : int  1 2 3 4 5 6 7 8 9 10 ...\n $ name        : chr  \"Duce Staley\" \"Lamar Smith\" \"Tiki Barber\" \"Stephen Davis\" ...\n $ team        : chr  \"PHI\" \"MIA\" \"NYG\" \"WAS\" ...\n $ game_year   : int  2000 2000 2000 2000 2000 2000 2000 2000 2000 2000 ...\n $ game_week   : int  1 1 1 1 1 1 1 1 1 1 ...\n $ rush_att    : int  26 27 13 23 28 27 30 14 15 10 ...\n $ rush_yds    : int  201 145 144 133 124 119 110 109 88 87 ...\n $ rush_avg    : num  7.7 5.4 11.1 5.8 4.4 4.4 3.7 7.8 5.9 8.7 ...\n $ rush_tds    : int  1 1 2 1 1 0 1 0 0 1 ...\n $ rush_fumbles: int  0 1 0 0 1 0 0 0 0 0 ...\n $ rec         : int  4 1 3 4 6 4 6 2 2 NA ...\n $ rec_yds     : int  61 12 25 37 40 32 34 3 20 NA ...\n $ rec_avg     : num  15.3 12 8.3 9.3 6.7 8 5.7 1.5 10 NA ...\n $ rec_tds     : int  0 0 0 0 1 0 1 0 0 NA ...\n $ rec_fumbles : int  0 0 0 0 0 0 0 0 0 NA ...\n $ pass_att    : int  NA NA NA NA NA NA NA NA NA 41 ...\n $ pass_yds    : int  NA NA NA NA NA NA NA NA NA 290 ...\n $ pass_tds    : int  NA NA NA NA NA NA NA NA NA 2 ...\n $ int         : int  NA NA NA NA NA NA NA NA NA 0 ...\n $ sck         : int  NA NA NA NA NA NA NA NA NA 2 ...\n $ pass_fumbles: int  NA NA NA NA NA NA NA NA NA 0 ...\n $ rate        : num  NA NA NA NA NA ...\n $ position    : chr  \"RB\" \"RB\" \"RB\" \"RB\" ...\n```\n\n\n:::\n:::\n\n\n\n\n### step 2.2: check missing values and ranges\n\nMissing values could be checked one by one variables or in case-level. Knowing which one or more variablea have high missing values will help you think about the reasons.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(dat1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       X             name               team             game_year   \n Min.   :    1   Length:81525       Length:81525       Min.   :2000  \n 1st Qu.:20382   Class :character   Class :character   1st Qu.:2004  \n Median :40763   Mode  :character   Mode  :character   Median :2009  \n Mean   :40763                                         Mean   :2009  \n 3rd Qu.:61144                                         3rd Qu.:2013  \n Max.   :81525                                         Max.   :2017  \n                                                                     \n   game_week         rush_att        rush_yds         rush_avg     \n Min.   : 1.000   Min.   : 0.00   Min.   :-34.00   Min.   :-34.00  \n 1st Qu.: 4.000   1st Qu.: 1.00   1st Qu.:  4.00   1st Qu.:  2.00  \n Median : 9.000   Median : 4.00   Median : 15.00   Median :  3.50  \n Mean   : 8.592   Mean   : 6.96   Mean   : 28.91   Mean   :  4.05  \n 3rd Qu.:13.000   3rd Qu.:10.00   3rd Qu.: 42.00   3rd Qu.:  5.30  \n Max.   :16.000   Max.   :43.00   Max.   :296.00   Max.   : 77.00  \n                  NA's   :47710   NA's   :47710    NA's   :47710   \n    rush_tds      rush_fumbles        rec            rec_yds      \n Min.   :0.00    Min.   :0.00    Min.   : 0.000   Min.   :-22.00  \n 1st Qu.:0.00    1st Qu.:0.00    1st Qu.: 1.000   1st Qu.:  8.00  \n Median :0.00    Median :0.00    Median : 2.000   Median : 21.00  \n Mean   :0.21    Mean   :0.08    Mean   : 2.716   Mean   : 31.23  \n 3rd Qu.:0.00    3rd Qu.:0.00    3rd Qu.: 4.000   3rd Qu.: 45.00  \n Max.   :5.00    Max.   :3.00    Max.   :21.000   Max.   :329.00  \n NA's   :47710   NA's   :47710   NA's   :16722    NA's   :16722   \n    rec_avg          rec_tds       rec_fumbles       pass_att    \n Min.   :-22.00   Min.   :0.000   Min.   :0.000   Min.   : 0.00  \n 1st Qu.:  5.10   1st Qu.:0.000   1st Qu.:0.000   1st Qu.:21.00  \n Median :  9.00   Median :0.000   Median :0.000   Median :30.00  \n Mean   : 10.15   Mean   :0.188   Mean   :0.032   Mean   :27.64  \n 3rd Qu.: 13.50   3rd Qu.:0.000   3rd Qu.:0.000   3rd Qu.:37.00  \n Max.   : 99.00   Max.   :4.000   Max.   :2.000   Max.   :68.00  \n NA's   :16722    NA's   :16722   NA's   :16722   NA's   :71044  \n    pass_yds        pass_tds          int             sck       \n Min.   :-11.0   Min.   :0.00    Min.   :0.0     Min.   : 0.00  \n 1st Qu.:126.0   1st Qu.:0.00    1st Qu.:0.0     1st Qu.: 1.00  \n Median :204.0   Median :1.00    Median :1.0     Median : 2.00  \n Mean   :193.1   Mean   :1.16    Mean   :0.8     Mean   : 1.88  \n 3rd Qu.:267.0   3rd Qu.:2.00    3rd Qu.:1.0     3rd Qu.: 3.00  \n Max.   :527.0   Max.   :7.00    Max.   :7.0     Max.   :12.00  \n NA's   :71044   NA's   :71044   NA's   :71044   NA's   :71044  \n  pass_fumbles        rate          position        \n Min.   :0.00    Min.   :  0.00   Length:81525      \n 1st Qu.:0.00    1st Qu.: 60.20   Class :character  \n Median :0.00    Median : 82.10   Mode  :character  \n Mean   :0.15    Mean   : 81.57                     \n 3rd Qu.:0.00    3rd Qu.:103.20                     \n Max.   :3.00    Max.   :158.30                     \n NA's   :71044   NA's   :71044                      \n```\n\n\n:::\n:::\n\n\n\n\nIn this sample, variables **rush_att, rush_yds, rush_avg, rush_tds, rush_fumbles** have 47,710 missing values; variables **rec, rec_yds, rec_avg, rec_tds, rec_fumbles** have 16,722 missing values, variables **pass_att, pass_yds, pass_tds, int, sck, pass_fumbles, rate** have 71,044 missing values.\n\nAlso, look at the range (Min., Max.) of variables in `summary` output, sometimes the responses may exceed expected range. You may have to delete those cases in this situation.\n\n### step 2.3: check first and last cases\n\nSometimes you may find the second row of data including some information you don't want. For example, Qualtrics survey data will put some background log information in row 2. Thus, it's better to check the head and tail of dataset. You can use functions below:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(dat1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  X           name team game_year game_week rush_att rush_yds rush_avg rush_tds\n1 1    Duce Staley  PHI      2000         1       26      201      7.7        1\n2 2    Lamar Smith  MIA      2000         1       27      145      5.4        1\n3 3    Tiki Barber  NYG      2000         1       13      144     11.1        2\n4 4  Stephen Davis  WAS      2000         1       23      133      5.8        1\n5 5 Edgerrin James  IND      2000         1       28      124      4.4        1\n6 6  Priest Holmes  BAL      2000         1       27      119      4.4        0\n  rush_fumbles rec rec_yds rec_avg rec_tds rec_fumbles pass_att pass_yds\n1            0   4      61    15.3       0           0       NA       NA\n2            1   1      12    12.0       0           0       NA       NA\n3            0   3      25     8.3       0           0       NA       NA\n4            0   4      37     9.3       0           0       NA       NA\n5            1   6      40     6.7       1           0       NA       NA\n6            0   4      32     8.0       0           0       NA       NA\n  pass_tds int sck pass_fumbles rate position\n1       NA  NA  NA           NA   NA       RB\n2       NA  NA  NA           NA   NA       RB\n3       NA  NA  NA           NA   NA       RB\n4       NA  NA  NA           NA   NA       RB\n5       NA  NA  NA           NA   NA       RB\n6       NA  NA  NA           NA   NA       RB\n```\n\n\n:::\n\n```{.r .cell-code}\ntail(dat1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          X           name team game_year game_week rush_att rush_yds rush_avg\n81520 81520     Jared Goff   LA      2017        15       NA       NA       NA\n81521 81521    Andy Dalton  CIN      2017        15       NA       NA       NA\n81522 81522 Trevor Siemian  DEN      2017        15       NA       NA       NA\n81523 81523  A.J. McCarron  CIN      2017        15       NA       NA       NA\n81524 81524 Derek Anderson  CAR      2017        16       NA       NA       NA\n81525 81525  Johnny Hekker   LA      2017        16       NA       NA       NA\n      rush_tds rush_fumbles rec rec_yds rec_avg rec_tds rec_fumbles pass_att\n81520       NA           NA  NA      NA      NA      NA          NA       21\n81521       NA           NA  NA      NA      NA      NA          NA       22\n81522       NA           NA  NA      NA      NA      NA          NA        9\n81523       NA           NA  NA      NA      NA      NA          NA        6\n81524       NA           NA  NA      NA      NA      NA          NA        1\n81525       NA           NA  NA      NA      NA      NA          NA        1\n      pass_yds pass_tds int sck pass_fumbles rate position\n81520      120        2   1   2            0 93.4       QB\n81521      113        0   2   3            0 27.3       QB\n81522       67        0   1   2            0 39.8       QB\n81523       19        0   0   0            0 56.9       QB\n81524        0        0   0   0            0 39.6    WR/TE\n81525        0        0   0   0            0 39.6    WR/TE\n```\n\n\n:::\n:::\n\n\n\n\nThe R output provide first 6 cases and last 6 case. You can use `head(dat1, 10)` to output first 10 cases.\n\n## Step 3: Select and rename Variables\n\nAfter initial checks, some basic data cleaning could be done. You may want to select some variables you want and remove others. You can use `select` function to do that:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat2 <- dat1 %>% select(name, team, pass_att)\n```\n:::\n\n\n\n\nI selected 3 variables (name, team, pass_att) from the dat1 and assign 3-variables data to \"dat2\".\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(dat2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            name team pass_att\n1    Duce Staley  PHI       NA\n2    Lamar Smith  MIA       NA\n3    Tiki Barber  NYG       NA\n4  Stephen Davis  WAS       NA\n5 Edgerrin James  IND       NA\n6  Priest Holmes  BAL       NA\n```\n\n\n:::\n:::\n\n\n\n\nTo rename the variables' names, you could use `set_names()` from purrr packages.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat2 %>% purrr::set_names(nm = \"Players\", \"Team\", \"Pass_Attribute\") %>% head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n         Players Team Pass_Attribute\n1    Duce Staley  PHI             NA\n2    Lamar Smith  MIA             NA\n3    Tiki Barber  NYG             NA\n4  Stephen Davis  WAS             NA\n5 Edgerrin James  IND             NA\n6  Priest Holmes  BAL             NA\n```\n\n\n:::\n\n```{.r .cell-code}\ndat2 %>% purrr::set_names(nm = \"V1\", \"V2\", \"V3\") %>% head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n              V1  V2 V3\n1    Duce Staley PHI NA\n2    Lamar Smith MIA NA\n3    Tiki Barber NYG NA\n4  Stephen Davis WAS NA\n5 Edgerrin James IND NA\n6  Priest Holmes BAL NA\n```\n\n\n:::\n:::\n\n\n\n\n## Step 4: Remove missing values\n\nIf you prefer cases with no missing cases at all. You can use the function below.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat_complete_cases <- dat2 %>% \n  filter_all(all_vars(!is.na(.)))\n\nsummary(dat_complete_cases)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     name               team              pass_att    \n Length:10481       Length:10481       Min.   : 0.00  \n Class :character   Class :character   1st Qu.:21.00  \n Mode  :character   Mode  :character   Median :30.00  \n                                       Mean   :27.64  \n                                       3rd Qu.:37.00  \n                                       Max.   :68.00  \n```\n\n\n:::\n:::\n\n\n\n\nOr if you want remove the cases whose **Pass_Attribute** is missing, you can use:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat_partialcomplete_cases <- dat2 %>% \n  filter(!is.na(pass_att))\n\nsummary(dat_complete_cases)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     name               team              pass_att    \n Length:10481       Length:10481       Min.   : 0.00  \n Class :character   Class :character   1st Qu.:21.00  \n Mode  :character   Mode  :character   Median :30.00  \n                                       Mean   :27.64  \n                                       3rd Qu.:37.00  \n                                       Max.   :68.00  \n```\n\n\n:::\n:::\n\n\n\n\nTo be continued...\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}