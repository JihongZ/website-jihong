{
  "hash": "6d0fdc6fbc8383f9c3f392724db47c8d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Health Care Data Analysis with Apple Watch\nauthor: 'Jihong Zhang'\ndate: '2021-07-06'\ndraft: false\nprivate: true\nslug: health-care-data-analysis-with-apple-watch\ncategories:\n  - blog\n  - R\n  - health\nsummary: \"Analyze the health care data from Apple Watch's app\"\nlastmod: '2021-07-06T14:02:09-05:00'\nfeatured: no\n---\n\n\n> The data contained within Health app on iPhone can be saved and exported for other uses. Perhaps you want to export Health app data to use in another health or fitness app, importing it to elsewhere, or maybe you want to use the raw Health data for your own purposes.\n>\n> Exporting Health data from iPhone results in a zip archive that contains the raw data as gathered by Health app in XML format. This exported Health data will include any data stored or gathered by the Health app and any associated devices, including any Medical ID data, the native iPhone step counter and distance tracker, any data from an Apple Watch, and any data gathered from any third party devices that are syncing to Health app, like a smart scale or blood pressure monitor.\n\nYou can find more details about exporting data from [How to Export Health Data form iPhone](https://osxdaily.com/2019/05/20/export-health-data-from-iphone/) and [How to Export, Parse and Explore Your Apple Health Data with Python](http://www.markwk.com/data-analysis-for-apple-health.html).\n\n## Load Required Packages\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrm(list = ls(all = TRUE))\n\nif(!require(XML)) install.packages(\"XML\")\nif(!require(tidyverse)) install.packages(\"tidyverse\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'dplyr' was built under R version 4.2.3\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'stringr' was built under R version 4.2.3\n```\n\n\n:::\n\n```{.r .cell-code}\nif(!require(lubridate)) install.packages(\"lubridate\")\nif(!require(scales)) install.packages(\"scales\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'scales' was built under R version 4.2.3\n```\n\n\n:::\n\n```{.r .cell-code}\nif(!require(ggthemes)) remotes::install_github(c(\"hadley/ggplot2\", \"jrnold/ggthemes\"))\nif(!require(ggridges)) remotes::install_github(\"wilkelab/ggridges\")\nif(!require(rpart)) install.packages(\"rpart\")\nif(!require(kableExtra)) install.packages(\"kableExtra\")\n```\n:::\n\n\n## Read in XML data\n\nThe .xml file could be downloaded and exported directly from iphone's health app. To read in the XML file and transform it into data frame, `XML` R package will help.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nloc<-\"导出.xml\" # enter file path location of export.xml file here #\n\nxml <- xmlParse(loc)\n\nrc <-  data.frame(XML:::xmlAttrsToDataFrame(xml[\"//Record\"]), stringsAsFactors = F)\nsaveRDS(rc, \"export_health_care.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrc <- readRDS(\"export_health_care.rds\")\n\n## Filter useful data\napple_watch <- rc %>% filter(grepl(\"JZ\",sourceName), unit == 'count/min', \n                             type == \"HKQuantityTypeIdentifierRestingHeartRate\")\n\n# Adjusting to Local Timezone\napple_watch_dt <- apple_watch %>%\n  mutate(cdt=as_datetime(creationDate, tz=\"US/Central\"),\n         stm=as_datetime(startDate, tz=\"US/Central\"),\n         etm=as_datetime(endDate, tz=\"US/Central\"),\n         dst=as.numeric(as.character(value))) \n\n# %>%\n#   group_by(creationDate) %>%\n#   mutate(TotalTime=cumsum(value)) %>% # cumulative distance covered #\n#   mutate(hr=hour(stm), min=minute(stm)) %>%\n#   mutate(elt=as.numeric(etm-mntm)) %>% # total elapsed time #\n#   mutate(dtm=as.numeric(etm-lag(etm))) %>%\n#   ungroup()\n```\n:::\n\n\n```{.r .cell-code}\nhead(apple_watch_dt[,-1]) %>% \n  select(sourceName, unit, cdt, stm, etm, dst) %>% \n  kbl() %>% \n  kable_material_dark(full_width = F, html_font = \"Maven Pro\") |> \n  kable_styling(font_size = 10)\n```\n\n`````{=html}\n<table class=\" lightable-material-dark table\" style=\"font-family: Maven Pro; width: auto !important; margin-left: auto; margin-right: auto; font-size: 10px; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> sourceName </th>\n   <th style=\"text-align:left;\"> unit </th>\n   <th style=\"text-align:left;\"> cdt </th>\n   <th style=\"text-align:left;\"> stm </th>\n   <th style=\"text-align:left;\"> etm </th>\n   <th style=\"text-align:right;\"> dst </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> JZ’sApple Watch </td>\n   <td style=\"text-align:left;\"> count/min </td>\n   <td style=\"text-align:left;\"> 2020-07-27 22:42:32 </td>\n   <td style=\"text-align:left;\"> 2020-07-27 08:45:05 </td>\n   <td style=\"text-align:left;\"> 2020-07-27 22:37:26 </td>\n   <td style=\"text-align:right;\"> 60 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> JZ’sApple Watch </td>\n   <td style=\"text-align:left;\"> count/min </td>\n   <td style=\"text-align:left;\"> 2020-07-28 19:43:28 </td>\n   <td style=\"text-align:left;\"> 2020-07-28 00:03:04 </td>\n   <td style=\"text-align:left;\"> 2020-07-28 19:40:28 </td>\n   <td style=\"text-align:right;\"> 59 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> JZ’sApple Watch </td>\n   <td style=\"text-align:left;\"> count/min </td>\n   <td style=\"text-align:left;\"> 2020-07-29 14:22:15 </td>\n   <td style=\"text-align:left;\"> 2020-07-29 08:40:16 </td>\n   <td style=\"text-align:left;\"> 2020-07-29 14:18:28 </td>\n   <td style=\"text-align:right;\"> 54 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> JZ’sApple Watch </td>\n   <td style=\"text-align:left;\"> count/min </td>\n   <td style=\"text-align:left;\"> 2020-07-30 17:44:05 </td>\n   <td style=\"text-align:left;\"> 2020-07-30 09:06:24 </td>\n   <td style=\"text-align:left;\"> 2020-07-30 17:41:27 </td>\n   <td style=\"text-align:right;\"> 54 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> JZ’sApple Watch </td>\n   <td style=\"text-align:left;\"> count/min </td>\n   <td style=\"text-align:left;\"> 2020-07-31 17:36:00 </td>\n   <td style=\"text-align:left;\"> 2020-07-31 08:55:46 </td>\n   <td style=\"text-align:left;\"> 2020-07-31 17:27:30 </td>\n   <td style=\"text-align:right;\"> 52 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> JZ’sApple Watch </td>\n   <td style=\"text-align:left;\"> count/min </td>\n   <td style=\"text-align:left;\"> 2020-08-01 12:17:02 </td>\n   <td style=\"text-align:left;\"> 2020-08-01 00:03:31 </td>\n   <td style=\"text-align:left;\"> 2020-08-01 12:14:41 </td>\n   <td style=\"text-align:right;\"> 60 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n\n\n## Other materials\n\nThere a decent [blog](https://www.inpredictable.com/2021/06/analyzing-your-run-data-with-r.html) illustrating how to handle with apple watch export file.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}